<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Case study: entering a new real estate market</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="03_real_estate_eda_files/libs/clipboard/clipboard.min.js"></script>
<script src="03_real_estate_eda_files/libs/quarto-html/quarto.js"></script>
<script src="03_real_estate_eda_files/libs/quarto-html/popper.min.js"></script>
<script src="03_real_estate_eda_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="03_real_estate_eda_files/libs/quarto-html/anchor.min.js"></script>
<link href="03_real_estate_eda_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="03_real_estate_eda_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="03_real_estate_eda_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="03_real_estate_eda_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="03_real_estate_eda_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Case study: entering a new real estate market</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You work for a real estate company that would like to be more data-driven, and you are the main expert of data analysis in the company, so you are in a very strategic role at the moment.</p>
<p>The CEO needs to decide whether it’s worth entering in a new market or not. In order to do so in a data-informed decision, he asks your help to perform an Exploratory Data Analysis on the listing ads that have been published for a particular city, and provide insights that might be useful to understand how “hot” the market is, what are some characteristics of the market in terms of price and housing characteritics, etc. In this notebook, we will assess a dataset of listings bla bla.</p>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A little bit of Setup</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image <span class="im">as</span> Img</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>dir_data <span class="op">=</span> <span class="st">'../data'</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>dir_assets <span class="op">=</span> <span class="st">'./assets'</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> img_colab(img_path):</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Helper function returning an image to be displayed by Jupyter Notebook / IPython.display module.</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">    path : path to image</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">        The image should be in a child folder "./assets".</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    display(Img(os.path.join(dir_assets, img_path)))</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Within Google Colab (uncomment below)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # mount my Google Drive on the VM</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># from google.colab import drive</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># drive.mount('/gdrive')</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # You should have already created a 'teaching_Python' folder </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # within your Google Drive to persist code and data</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # the following code should then list the files in the data folder</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># dir_python = '/gdrive/MyDrive/teaching_Python'</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># dir_data = os.path.join(dir_python, 'data')</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># os.listdir(dir_data)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="data-loading-and-cleansing" class="level1">
<h1>Data loading and cleansing</h1>
<p>As explained in the assignment description, the dataset contains real estate listings data taken from a particular website for a given province, along with additional tables to enrich the listings table with some extra details. Let’s have a first look at the available features that can be used to give insights on the market.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>listing_data <span class="op">=</span> pd.read_csv(os.path.join(dir_data, <span class="st">'fintech/listings.csv'</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>typology <span class="op">=</span> (pd.read_csv(os.path.join(dir_data,<span class="st">'fintech/ad_typology.csv'</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>              .rename({<span class="st">'name'</span>: <span class="st">'ad_typologyname'</span>}, axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>builttype <span class="op">=</span> (pd.read_csv(os.path.join(dir_data,<span class="st">'fintech/ad_builttype.csv'</span>))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>              .loc[:,[<span class="st">'key'</span>, <span class="st">'value'</span>]]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>              .rename({<span class="st">'key'</span>: <span class="st">'ad_builttype'</span>, <span class="st">'value'</span>: <span class="st">'ad_builttypename'</span>}, axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>listing_data[<span class="st">'ad_builttype'</span>].value_counts().index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>Index([3.0, 2.0, 1.0], dtype='float64', name='ad_builttype')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>typology</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_subtypology</th>
<th data-quarto-table-cell-role="th">ad_typologyname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>NaN</td>
<td>apartment</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>1.0</td>
<td>villa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2</td>
<td>2.0</td>
<td>chalet</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2</td>
<td>3.0</td>
<td>chalet</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2</td>
<td>4.0</td>
<td>independent-house</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2</td>
<td>5.0</td>
<td>independent-house</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>3</td>
<td>NaN</td>
<td>rural-house</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>count_type <span class="op">=</span> listing_data[<span class="st">'ad_builttype'</span>].value_counts()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(count_type)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>count_type.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>Index([3.0, 2.0, 1.0], dtype='float64', name='ad_builttype')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>count_type</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>ad_builttype
3.0    175528
2.0     15636
1.0       611
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>builttype</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_builttype</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>new</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>partially-renovated</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pd.merge(builttype,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>         count_type,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>         left_on<span class="op">=</span><span class="st">'ad_builttype'</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>         right_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_builttype</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>new</td>
<td>611</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>not-renovated</td>
<td>15636</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>partially-renovated</td>
<td>175528</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>builttype</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_builttype</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>new</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>partially-renovated</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>typology</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_subtypology</th>
<th data-quarto-table-cell-role="th">ad_typologyname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>NaN</td>
<td>apartment</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>1.0</td>
<td>villa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2</td>
<td>2.0</td>
<td>chalet</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2</td>
<td>3.0</td>
<td>chalet</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2</td>
<td>4.0</td>
<td>independent-house</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2</td>
<td>5.0</td>
<td>independent-house</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>3</td>
<td>NaN</td>
<td>rural-house</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>It is clearly stated that the focus is on the province town and not the other cities of the province. Maybe business team has already some insights, or the CEO strategy is to focus on capital cities or time is running. In an annex analysis we could use province data to get additional insights (are prices evolutions correlated/anticorrelated, like move from Paris to French mid cities during COVID).</p>
<p>Some quick look at listings data:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>listing_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_state</th>
<th data-quarto-table-cell-role="th">ad_operation</th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_propertytype</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">ad_activationdate</th>
<th data-quarto-table-cell-role="th">ad_deactivationdate</th>
<th data-quarto-table-cell-role="th">ad_modificationdate</th>
<th data-quarto-table-cell-role="th">ad_layerlocation</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">censustract_id</th>
<th data-quarto-table-cell-role="th">censustract_town_id</th>
<th data-quarto-table-cell-role="th">address_certainty</th>
<th data-quarto-table-cell-role="th">cadastral_certainty</th>
<th data-quarto-table-cell-role="th">ad_ParkingIsIncludedInPrice</th>
<th data-quarto-table-cell-role="th">ad_isAuction</th>
<th data-quarto-table-cell-role="th">ad_constructionyear</th>
<th data-quarto-table-cell-role="th">ad_heatingtype</th>
<th data-quarto-table-cell-role="th">last_seen_date</th>
<th data-quarto-table-cell-role="th">country</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>d5e60e53857e8125c90c08707cab3a23</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1030.303030</td>
<td>2020-07-21</td>
<td>NaN</td>
<td>2021-06-29</td>
<td>f2e22538d31e57c6bd670ddab7cc657e</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>1979.0</td>
<td>NaN</td>
<td>2021-09-29</td>
<td>it</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>137f5d98023d5a129bbd339dadc61d59</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1582.608696</td>
<td>2021-03-18</td>
<td>NaN</td>
<td>2021-04-16</td>
<td>96370e95ee45e01690a34213af221c37</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2021-04-21</td>
<td>it</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0e67d9a819e12a948b0fd28bc4a94a1d</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2873.786408</td>
<td>2021-07-22</td>
<td>NaN</td>
<td>2021-10-13</td>
<td>9ba947f71432d235b530d89f94f5f02b</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2021.0</td>
<td>NaN</td>
<td>2021-10-14</td>
<td>it</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7732c42a9441411eaf55f17632c10bb6</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>564.935065</td>
<td>2021-12-09</td>
<td>NaN</td>
<td>2021-12-21</td>
<td>400d09760dfd7c552e444a2c0df30782</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>2022-02-18</td>
<td>it</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>96af3057c851a1b5594bce0c7f7864c2</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>3000.000000</td>
<td>2021-04-12</td>
<td>2021-03-26</td>
<td>2021-04-22</td>
<td>30907c9787a9f0abb95882f115ff1cec</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2021-04-28</td>
<td>it</td>
</tr>
</tbody>
</table>

<p>5 rows × 48 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>listing_data.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_state</th>
<th data-quarto-table-cell-role="th">ad_operation</th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_propertytype</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">ad_postalcode</th>
<th data-quarto-table-cell-role="th">ad_streetnumber</th>
<th data-quarto-table-cell-role="th">ad_addressvisible</th>
<th data-quarto-table-cell-role="th">ad_subtypology</th>
<th data-quarto-table-cell-role="th">ad_area</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">property_builtdate</th>
<th data-quarto-table-cell-role="th">property_area</th>
<th data-quarto-table-cell-role="th">property_use</th>
<th data-quarto-table-cell-role="th">censustract_id</th>
<th data-quarto-table-cell-role="th">censustract_town_id</th>
<th data-quarto-table-cell-role="th">address_certainty</th>
<th data-quarto-table-cell-role="th">cadastral_certainty</th>
<th data-quarto-table-cell-role="th">ad_ParkingIsIncludedInPrice</th>
<th data-quarto-table-cell-role="th">ad_isAuction</th>
<th data-quarto-table-cell-role="th">ad_constructionyear</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>199364.0</td>
<td>199364.0</td>
<td>199364.000000</td>
<td>199364.000000</td>
<td>199364.000000</td>
<td>194301.000000</td>
<td>103240.000000</td>
<td>199364.000000</td>
<td>60574.000000</td>
<td>199364.000000</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>67908.000000</td>
<td>67678.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>3.0</td>
<td>1.0</td>
<td>1.295359</td>
<td>1.003065</td>
<td>1931.715600</td>
<td>82498.820469</td>
<td>120.814568</td>
<td>1.679516</td>
<td>3.257916</td>
<td>292.369024</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.482859</td>
<td>1973.819764</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.0</td>
<td>0.0</td>
<td>0.520194</td>
<td>0.055275</td>
<td>1280.396721</td>
<td>381.047763</td>
<td>3055.309901</td>
<td>0.782625</td>
<td>3.791413</td>
<td>7435.706364</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.499710</td>
<td>71.547183</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>3.0</td>
<td>1.0</td>
<td>1.000000</td>
<td>1.000000</td>
<td>0.020833</td>
<td>42469.000000</td>
<td>0.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>10.000000</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.000000</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>3.0</td>
<td>1.0</td>
<td>1.000000</td>
<td>1.000000</td>
<td>937.500000</td>
<td>82462.000000</td>
<td>0.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>78.000000</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.000000</td>
<td>1960.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>3.0</td>
<td>1.0</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1812.500000</td>
<td>82483.000000</td>
<td>6.000000</td>
<td>1.000000</td>
<td>3.000000</td>
<td>105.000000</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.000000</td>
<td>1980.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>3.0</td>
<td>1.0</td>
<td>2.000000</td>
<td>1.000000</td>
<td>2722.222222</td>
<td>82554.000000</td>
<td>28.000000</td>
<td>2.000000</td>
<td>4.000000</td>
<td>160.000000</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.000000</td>
<td>2009.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>3.0</td>
<td>1.0</td>
<td>3.000000</td>
<td>2.000000</td>
<td>144067.796610</td>
<td>103550.000000</td>
<td>350350.000000</td>
<td>3.000000</td>
<td>19.000000</td>
<td>850000.000000</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.000000</td>
<td>3000.000000</td>
</tr>
</tbody>
</table>

<p>8 rows × 35 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>listing_data.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 199364 entries, 0 to 199363
Data columns (total 48 columns):
 #   Column                         Non-Null Count   Dtype  
---  ------                         --------------   -----  
 0   ad_id                          199364 non-null  object 
 1   ad_state                       199364 non-null  int64  
 2   ad_operation                   199364 non-null  int64  
 3   ad_typology                    199364 non-null  int64  
 4   ad_propertytype                199364 non-null  int64  
 5   ad_unitprice                   199364 non-null  float64
 6   ad_activationdate              199364 non-null  object 
 7   ad_deactivationdate            34559 non-null   object 
 8   ad_modificationdate            199364 non-null  object 
 9   ad_layerlocation               199364 non-null  object 
 10  ad_province                    199364 non-null  object 
 11  ad_town                        199364 non-null  object 
 12  ad_postalcode                  194301 non-null  float64
 13  ad_streettype                  150782 non-null  object 
 14  ad_streetname                  160017 non-null  object 
 15  ad_streetnumber                103240 non-null  float64
 16  ad_floornumber                 130708 non-null  object 
 17  ad_addressvisible              199364 non-null  int64  
 18  ad_subtypology                 60574 non-null   float64
 19  ad_area                        199364 non-null  float64
 20  ad_builttype                   191775 non-null  float64
 21  ad_roomnumber                  199364 non-null  int64  
 22  ad_bathnumber                  199364 non-null  int64  
 23  ad_flatlocation                64780 non-null   float64
 24  ad_haslift                     128946 non-null  float64
 25  ad_hasparkingspace             116817 non-null  float64
 26  ad_hasboxroom                  71714 non-null   float64
 27  ad_hasswimmingpool             71207 non-null   float64
 28  newdevelopment_commercialname  0 non-null       float64
 29  newdevelopment_fromprice       0 non-null       float64
 30  newdevelopment_averageprice    0 non-null       float64
 31  layerlocation_area             199364 non-null  float64
 32  layerlocation_population       199364 non-null  int64  
 33  estate_cadastralroot           0 non-null       float64
 34  property_cadastralreference    0 non-null       float64
 35  property_builtdate             0 non-null       float64
 36  property_area                  0 non-null       float64
 37  property_use                   0 non-null       float64
 38  censustract_id                 0 non-null       float64
 39  censustract_town_id            0 non-null       float64
 40  address_certainty              0 non-null       float64
 41  cadastral_certainty            0 non-null       float64
 42  ad_ParkingIsIncludedInPrice    0 non-null       float64
 43  ad_isAuction                   67908 non-null   float64
 44  ad_constructionyear            67678 non-null   float64
 45  ad_heatingtype                 74942 non-null   object 
 46  last_seen_date                 199364 non-null  object 
 47  country                        199364 non-null  object 
dtypes: float64(27), int64(8), object(13)
memory usage: 73.0+ MB</code></pre>
</div>
</div>
<p>To identify the province town, a first guess is to look at town MD5 with highest unit price and/or # of listings:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>listing_data.groupby(<span class="st">'ad_town'</span>)[<span class="st">'ad_unitprice'</span>].mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>ad_town
7014d0181914fb4722b90a49d53f5471    3021.796456
c17c0ca405acffb7a0f24630cfcb63b0    2802.538342
c1621da67ad7e9e4a8844b779447b3d3    2626.026440
c821b3f4446a71fe2c9b87f7b0c782ad    2435.762589
e94915a14b20d03badb5574057cee606    2358.839408
Name: ad_unitprice, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(listing_data</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'ad_town'</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        number_listings<span class="op">=</span> (<span class="st">'ad_unitprice'</span>, <span class="st">'size'</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        mean_unitprice<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'mean'</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        median_unitprice<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'median'</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        mean_area<span class="op">=</span>(<span class="st">'ad_area'</span>, <span class="st">'mean'</span>))</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    .sort_values(by<span class="op">=</span>[<span class="st">'mean_unitprice'</span>], ascending<span class="op">=</span><span class="va">False</span>)).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">number_listings</th>
<th data-quarto-table-cell-role="th">mean_unitprice</th>
<th data-quarto-table-cell-role="th">median_unitprice</th>
<th data-quarto-table-cell-role="th">mean_area</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ad_town</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">7014d0181914fb4722b90a49d53f5471</td>
<td>61050</td>
<td>3021.796456</td>
<td>3000.000000</td>
<td>170.451990</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c17c0ca405acffb7a0f24630cfcb63b0</td>
<td>4542</td>
<td>2802.538342</td>
<td>2816.091954</td>
<td>172.172391</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c1621da67ad7e9e4a8844b779447b3d3</td>
<td>4358</td>
<td>2626.026440</td>
<td>2600.000000</td>
<td>110.918311</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c821b3f4446a71fe2c9b87f7b0c782ad</td>
<td>2778</td>
<td>2435.762589</td>
<td>2545.454545</td>
<td>168.443485</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">e94915a14b20d03badb5574057cee606</td>
<td>3072</td>
<td>2358.839408</td>
<td>2402.985075</td>
<td>221.483398</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>It also occurs that the town with highest mean/median prices/sqm and number of listings verifies MD5(‘Bologna’)-&gt;‘7014d0181914fb4722b90a49d53f5471’. For more convenience the province town will be named Bologna.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hashlib</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(hashlib.md5(<span class="st">b'Bologna'</span>).hexdigest())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>7014d0181914fb4722b90a49d53f5471</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>listing_bologna <span class="op">=</span> listing_data.loc[listing_data[<span class="st">'ad_town'</span>]<span class="op">==</span><span class="st">'7014d0181914fb4722b90a49d53f5471'</span>]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>listing_bologna</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_state</th>
<th data-quarto-table-cell-role="th">ad_operation</th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_propertytype</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">ad_activationdate</th>
<th data-quarto-table-cell-role="th">ad_deactivationdate</th>
<th data-quarto-table-cell-role="th">ad_modificationdate</th>
<th data-quarto-table-cell-role="th">ad_layerlocation</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">censustract_id</th>
<th data-quarto-table-cell-role="th">censustract_town_id</th>
<th data-quarto-table-cell-role="th">address_certainty</th>
<th data-quarto-table-cell-role="th">cadastral_certainty</th>
<th data-quarto-table-cell-role="th">ad_ParkingIsIncludedInPrice</th>
<th data-quarto-table-cell-role="th">ad_isAuction</th>
<th data-quarto-table-cell-role="th">ad_constructionyear</th>
<th data-quarto-table-cell-role="th">ad_heatingtype</th>
<th data-quarto-table-cell-role="th">last_seen_date</th>
<th data-quarto-table-cell-role="th">country</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>96af3057c851a1b5594bce0c7f7864c2</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>3000.000000</td>
<td>2021-04-12</td>
<td>2021-03-26</td>
<td>2021-04-22</td>
<td>30907c9787a9f0abb95882f115ff1cec</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2021-04-28</td>
<td>it</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>fa2c84344b6c3bbc7484a8150d7efad6</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1385.416667</td>
<td>2021-09-29</td>
<td>NaN</td>
<td>2021-11-30</td>
<td>319ff21efb401d5c564b88917df71817</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>NaN</td>
<td>CENTRAL_OTHER</td>
<td>2022-01-19</td>
<td>it</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>05110a844b8a99e5176aa2dc5e22cc73</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1169.354839</td>
<td>2021-07-22</td>
<td>NaN</td>
<td>2021-08-03</td>
<td>46f3699d96a59f9e2bba52d52b74315f</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2021-08-04</td>
<td>it</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>361611d4e86dabd15909ccf636f6ff1f</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>825.000000</td>
<td>2021-12-07</td>
<td>NaN</td>
<td>2021-12-07</td>
<td>85ea9cbc768010f730bc474da4a253da</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>1980.0</td>
<td>INDIVIDUAL_OTHER</td>
<td>2021-12-08</td>
<td>it</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">23</td>
<td>bebb199b94b68c4b5dd519e3f225caff</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1809.160305</td>
<td>2021-12-04</td>
<td>NaN</td>
<td>2022-01-04</td>
<td>a3c47f8c8202d15ff4aeff6102adc107</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>NaN</td>
<td>CENTRAL_OTHER</td>
<td>2022-01-05</td>
<td>it</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">199352</td>
<td>b77907e201e56cd044b6c4b227ffd393</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>3457.142857</td>
<td>2020-04-21</td>
<td>NaN</td>
<td>2020-11-12</td>
<td>408edd8f9b5a1e0b8110093fbf261780</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2021-03-17</td>
<td>it</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">199358</td>
<td>73dcdc203d9dd95b48ea2d4edd3b2931</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>3475.609756</td>
<td>2021-06-01</td>
<td>NaN</td>
<td>2021-06-28</td>
<td>85ea9cbc768010f730bc474da4a253da</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2021.0</td>
<td>NaN</td>
<td>2021-06-30</td>
<td>it</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">199360</td>
<td>25da55cb019156986fba6816f248e0b8</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>4812.500000</td>
<td>2021-11-15</td>
<td>NaN</td>
<td>2022-03-07</td>
<td>a3c47f8c8202d15ff4aeff6102adc107</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1970.0</td>
<td>CENTRAL_OTHER</td>
<td>2022-03-08</td>
<td>it</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">199361</td>
<td>815a093ac1fabdd9d25a9f415685318d</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>5285.714286</td>
<td>2022-03-07</td>
<td>NaN</td>
<td>2022-03-07</td>
<td>72fba7c6c57ed8519627ff3b45b712be</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>INDIVIDUAL_OTHER</td>
<td>2022-03-08</td>
<td>it</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">199363</td>
<td>aaece7ab67a29c51c9b9e7c42ed4c504</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>3238.095238</td>
<td>2021-11-25</td>
<td>NaN</td>
<td>2022-02-08</td>
<td>3d17a7e664b3bdb02e542e1301e4c5fd</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>2000.0</td>
<td>INDIVIDUAL</td>
<td>2022-03-16</td>
<td>it</td>
</tr>
</tbody>
</table>

<p>61050 rows × 48 columns</p>
</div>
</div>
</div>
<p>The dataset contains missing data and both numerical and categorical/text features. We will have to make assumptions to handle this and eventually iterate if needed.</p>
<p>We have a look at the additional tables provided:</p>
<div class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>typology</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="113">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_subtypology</th>
<th data-quarto-table-cell-role="th">ad_typologyname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>NaN</td>
<td>apartment</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>1.0</td>
<td>villa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2</td>
<td>2.0</td>
<td>chalet</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2</td>
<td>3.0</td>
<td>chalet</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2</td>
<td>4.0</td>
<td>independent-house</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2</td>
<td>5.0</td>
<td>independent-house</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>3</td>
<td>NaN</td>
<td>rural-house</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ul>
<li>Typology classifies listings into understandable categories (eg villa, apartment etc) based on (ad_typology, ad_subtypology) tuples. But categories do not seem to cover all tuples found in listing data: for example some listings have (ad_typology,ad_subtypology) (1,{2,4,6}) while the mapping says only (1,NaN/empty) relates to an apartment. Either I take an assumption (eg NaN/empty is a wildcard and {2,4,6} are very particular types of apartments like duplex/penthouse/loft, but in that case what is the meaning of (2,0)-&gt;NaN) or I discard the uncovered categories / label them as ‘other’ or in real life I ask the guy who has scraped the data for more details. Cardinality and mean characteristics by categories might gave better insights:</li>
</ul>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>(listing_bologna</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">'ad_typology'</span>,<span class="st">'ad_subtypology'</span>],dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        number_listings<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'size'</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        mean_uniprice<span class="op">=</span>(<span class="st">'ad_unitprice'</span>,<span class="st">'mean'</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        mean_area<span class="op">=</span>(<span class="st">'ad_area'</span>,<span class="st">'mean'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">number_listings</th>
<th data-quarto-table-cell-role="th">mean_uniprice</th>
<th data-quarto-table-cell-role="th">mean_area</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_subtypology</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="4" data-quarto-table-cell-role="th" data-valign="top">1</td>
<td data-quarto-table-cell-role="th">2.0</td>
<td>1541</td>
<td>4114.762738</td>
<td>166.876055</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4.0</td>
<td>1318</td>
<td>3326.872003</td>
<td>131.247344</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6.0</td>
<td>127</td>
<td>4296.712346</td>
<td>205.039370</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NaN</td>
<td>54473</td>
<td>2996.468416</td>
<td>152.447469</td>
</tr>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">2</td>
<td data-quarto-table-cell-role="th">0.0</td>
<td>409</td>
<td>2898.555783</td>
<td>439.833741</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1.0</td>
<td>1147</td>
<td>2875.420320</td>
<td>499.532694</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2.0</td>
<td>296</td>
<td>2969.731377</td>
<td>160.195946</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3.0</td>
<td>622</td>
<td>2936.905455</td>
<td>450.157556</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4.0</td>
<td>996</td>
<td>2646.048023</td>
<td>207.450803</td>
</tr>
<tr class="even">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">3</td>
<td data-quarto-table-cell-role="th">0.0</td>
<td>30</td>
<td>1801.446955</td>
<td>687.733333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1.0</td>
<td>12</td>
<td>2212.762054</td>
<td>20704.083333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18.0</td>
<td>79</td>
<td>977.569434</td>
<td>1135.050633</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>For categories (1,{2,4,6}), mean prices/area are roughly in line with those of (1,NaN), except with slight to moderate higher price/sqm and area but they are rarer, we may classify them as ‘apartment-other’ and see further what occurs. It would be good to know if it is higher end apartments penthouse/duplex etc.</p>
<p>For category (2,0) is more ambiguous in terms of price/area/cardinality, so ‘other-house’ might also do the job without any good guess. It seems pricier and bigger than independent-house anyway.</p>
<p>For category (3,NaN), I don’t expect many rural houses in Bologna, especially with 20,000 sqm is more ambiguous in terms of price/area/cardinality, so ‘other-house’ might also do the job without any good guess. It seems pricier and bigger than independent-house anyway. Cardinality is low so I will discard the category, will revert on it and understand what is what if needed in a next step if needed.</p>
<p>At least we know some categories for apartment and houses and can start to tell a story.</p>
<p>Another way would be to let a ML model decide (ie feed (ad_typology,ad_subtypology) as a feature and see what happens).</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>builttype</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_builttype</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>new</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>partially-renovated</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ul>
<li>Builttype classifies listings into three straightforward categories, we would expect all other things being equal new &gt; partially-renovated &gt; not-renovated:</li>
</ul>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(pd.merge(listing_bologna, builttype, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'ad_builttype'</span>])</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">'ad_builttype'</span>,<span class="st">'ad_builttypename'</span>],dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        number_listings<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'size'</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        mean_uniprice<span class="op">=</span>(<span class="st">'ad_unitprice'</span>,<span class="st">'mean'</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        mean_area<span class="op">=</span>(<span class="st">'ad_area'</span>,<span class="st">'mean'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">number_listings</th>
<th data-quarto-table-cell-role="th">mean_uniprice</th>
<th data-quarto-table-cell-role="th">mean_area</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ad_builttype</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1.0</td>
<td data-quarto-table-cell-role="th">new</td>
<td>331</td>
<td>3351.348469</td>
<td>93.371601</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2.0</td>
<td data-quarto-table-cell-role="th">not-renovated</td>
<td>5362</td>
<td>2733.569315</td>
<td>131.063223</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3.0</td>
<td data-quarto-table-cell-role="th">partially-renovated</td>
<td>52566</td>
<td>3027.071232</td>
<td>178.655785</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NaN</td>
<td data-quarto-table-cell-role="th">NaN</td>
<td>2791</td>
<td>3437.102212</td>
<td>100.754927</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This is true even with rough aggregation (no taking into account other characteristics) BUT listings without information on builtype (NaN) seem to quote higher than other categoris. We might need ‘all other things being equal’ analysis or regression analysis to conclude.</p>
<p>We merge the three datasets then cleanse it with assumptions.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>typology</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_subtypology</th>
<th data-quarto-table-cell-role="th">ad_typologyname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>NaN</td>
<td>apartment</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>1.0</td>
<td>villa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2</td>
<td>2.0</td>
<td>chalet</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2</td>
<td>3.0</td>
<td>chalet</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2</td>
<td>4.0</td>
<td>independent-house</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2</td>
<td>5.0</td>
<td>independent-house</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>3</td>
<td>NaN</td>
<td>rural-house</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>builttype</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_builttype</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>new</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>partially-renovated</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>listing_bologna <span class="op">=</span> (pd.merge(listing_bologna, typology, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'ad_typology'</span>, <span class="st">'ad_subtypology'</span>])</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                  .merge(builttype, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span><span class="st">'ad_builttype'</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>listing_bologna.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_state</th>
<th data-quarto-table-cell-role="th">ad_operation</th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_propertytype</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">ad_activationdate</th>
<th data-quarto-table-cell-role="th">ad_deactivationdate</th>
<th data-quarto-table-cell-role="th">ad_modificationdate</th>
<th data-quarto-table-cell-role="th">ad_layerlocation</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">address_certainty</th>
<th data-quarto-table-cell-role="th">cadastral_certainty</th>
<th data-quarto-table-cell-role="th">ad_ParkingIsIncludedInPrice</th>
<th data-quarto-table-cell-role="th">ad_isAuction</th>
<th data-quarto-table-cell-role="th">ad_constructionyear</th>
<th data-quarto-table-cell-role="th">ad_heatingtype</th>
<th data-quarto-table-cell-role="th">last_seen_date</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">ad_typologyname</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>96af3057c851a1b5594bce0c7f7864c2</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>3000.000000</td>
<td>2021-04-12</td>
<td>2021-03-26</td>
<td>2021-04-22</td>
<td>30907c9787a9f0abb95882f115ff1cec</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2021-04-28</td>
<td>it</td>
<td>independent-house</td>
<td>partially-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>fa2c84344b6c3bbc7484a8150d7efad6</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1385.416667</td>
<td>2021-09-29</td>
<td>NaN</td>
<td>2021-11-30</td>
<td>319ff21efb401d5c564b88917df71817</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>NaN</td>
<td>CENTRAL_OTHER</td>
<td>2022-01-19</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>05110a844b8a99e5176aa2dc5e22cc73</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1169.354839</td>
<td>2021-07-22</td>
<td>NaN</td>
<td>2021-08-03</td>
<td>46f3699d96a59f9e2bba52d52b74315f</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2021-08-04</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>361611d4e86dabd15909ccf636f6ff1f</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>825.000000</td>
<td>2021-12-07</td>
<td>NaN</td>
<td>2021-12-07</td>
<td>85ea9cbc768010f730bc474da4a253da</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>1980.0</td>
<td>INDIVIDUAL_OTHER</td>
<td>2021-12-08</td>
<td>it</td>
<td>NaN</td>
<td>partially-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>bebb199b94b68c4b5dd519e3f225caff</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1809.160305</td>
<td>2021-12-04</td>
<td>NaN</td>
<td>2022-01-04</td>
<td>a3c47f8c8202d15ff4aeff6102adc107</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>NaN</td>
<td>CENTRAL_OTHER</td>
<td>2022-01-05</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
</tr>
</tbody>
</table>

<p>5 rows × 50 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>listing_bologna.groupby([<span class="st">'ad_typology'</span>, <span class="st">'ad_subtypology'</span>, <span class="st">'ad_typologyname'</span>])[<span class="st">'ad_typologyname'</span>].size()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>ad_typology  ad_subtypology  ad_typologyname  
2            1.0             villa                1147
             2.0             chalet                296
             3.0             chalet                622
             4.0             independent-house     996
Name: ad_typologyname, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>listing_bologna[<span class="st">'ad_subtypology'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>0         4.0
1         NaN
2         NaN
3        18.0
4         NaN
         ... 
61045     NaN
61046     NaN
61047     NaN
61048     4.0
61049     NaN
Name: ad_subtypology, Length: 61050, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>mask_appartment <span class="op">=</span> (listing_bologna.ad_typology.isin([<span class="dv">1</span>])) <span class="op">&amp;</span> (listing_bologna.ad_subtypology.isin([<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>]))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>listing_bologna.loc[mask_appartment, [<span class="st">'ad_typology'</span>,<span class="st">'ad_subtypology'</span>, <span class="st">'ad_typologyname'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_subtypology</th>
<th data-quarto-table-cell-role="th">ad_typologyname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">79</td>
<td>1</td>
<td>4.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">106</td>
<td>1</td>
<td>4.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">149</td>
<td>1</td>
<td>2.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">164</td>
<td>1</td>
<td>6.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">189</td>
<td>1</td>
<td>2.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>listing_bologna.loc[mask_appartment, <span class="st">'ad_typologyname'</span>] <span class="op">=</span> <span class="st">'apartment-other'</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>listing_bologna.loc[mask_appartment, [<span class="st">'ad_typology'</span>,<span class="st">'ad_subtypology'</span>, <span class="st">'ad_typologyname'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_subtypology</th>
<th data-quarto-table-cell-role="th">ad_typologyname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">79</td>
<td>1</td>
<td>4.0</td>
<td>apartment-other</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">106</td>
<td>1</td>
<td>4.0</td>
<td>apartment-other</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">149</td>
<td>1</td>
<td>2.0</td>
<td>apartment-other</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">164</td>
<td>1</td>
<td>6.0</td>
<td>apartment-other</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">189</td>
<td>1</td>
<td>2.0</td>
<td>apartment-other</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>listing_bologna_cleansed <span class="op">=</span> listing_bologna</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>listing_bologna_cleansed[<span class="st">'ad_typologyname'</span>]<span class="op">=</span>(listing_bologna_cleansed[<span class="st">'ad_typologyname'</span>].</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>where(<span class="op">~</span>(listing_bologna_cleansed.ad_typology.isin([<span class="dv">1</span>]) <span class="op">&amp;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>        listing_bologna_cleansed.ad_subtypology.isin([<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>])), other<span class="op">=</span><span class="st">'apartment-other'</span>))  </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>listing_bologna_cleansed[<span class="st">'ad_typologyname'</span>]<span class="op">=</span>listing_bologna_cleansed[<span class="st">'ad_typologyname'</span>].where(<span class="op">~</span>(listing_bologna_cleansed.ad_typology.isin([<span class="dv">2</span>]) <span class="op">&amp;</span> listing_bologna_cleansed.ad_subtypology.isin([<span class="dv">0</span>])), other<span class="op">=</span><span class="st">'house-other'</span>)  </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>listing_bologna_cleansed<span class="op">=</span>listing_bologna_cleansed[listing_bologna_cleansed[<span class="st">'ad_typology'</span>].isin([<span class="dv">1</span>,<span class="dv">2</span>])]</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>(listing_bologna_cleansed</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">'ad_typology'</span>,<span class="st">'ad_subtypology'</span>,<span class="st">'ad_typologyname'</span>],dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        number_listings<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'size'</span>),</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>        mean_uniprice<span class="op">=</span>(<span class="st">'ad_unitprice'</span>,<span class="st">'mean'</span>),</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        mean_area<span class="op">=</span>(<span class="st">'ad_area'</span>,<span class="st">'mean'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">number_listings</th>
<th data-quarto-table-cell-role="th">mean_uniprice</th>
<th data-quarto-table-cell-role="th">mean_area</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_subtypology</th>
<th data-quarto-table-cell-role="th">ad_typologyname</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="4" data-quarto-table-cell-role="th" data-valign="top">1</td>
<td data-quarto-table-cell-role="th">2.0</td>
<td data-quarto-table-cell-role="th">apartment-other</td>
<td>1541</td>
<td>4114.762738</td>
<td>166.876055</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4.0</td>
<td data-quarto-table-cell-role="th">apartment-other</td>
<td>1318</td>
<td>3326.872003</td>
<td>131.247344</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6.0</td>
<td data-quarto-table-cell-role="th">apartment-other</td>
<td>127</td>
<td>4296.712346</td>
<td>205.039370</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NaN</td>
<td data-quarto-table-cell-role="th">apartment</td>
<td>54473</td>
<td>2996.468416</td>
<td>152.447469</td>
</tr>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">2</td>
<td data-quarto-table-cell-role="th">0.0</td>
<td data-quarto-table-cell-role="th">house-other</td>
<td>409</td>
<td>2898.555783</td>
<td>439.833741</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1.0</td>
<td data-quarto-table-cell-role="th">villa</td>
<td>1147</td>
<td>2875.420320</td>
<td>499.532694</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2.0</td>
<td data-quarto-table-cell-role="th">chalet</td>
<td>296</td>
<td>2969.731377</td>
<td>160.195946</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3.0</td>
<td data-quarto-table-cell-role="th">chalet</td>
<td>622</td>
<td>2936.905455</td>
<td>450.157556</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4.0</td>
<td data-quarto-table-cell-role="th">independent-house</td>
<td>996</td>
<td>2646.048023</td>
<td>207.450803</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>listing_bologna_cleansed.loc[listing_bologna_cleansed.ad_builttype.isna(),<span class="st">'ad_builttypename'</span>]<span class="op">=</span><span class="st">'unknown-builttype'</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>(listing_bologna_cleansed</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">'ad_builttype'</span>,<span class="st">'ad_builttypename'</span>],dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>        number_listings<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'size'</span>),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        mean_uniprice<span class="op">=</span>(<span class="st">'ad_unitprice'</span>,<span class="st">'mean'</span>),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        mean_area<span class="op">=</span>(<span class="st">'ad_area'</span>,<span class="st">'mean'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">number_listings</th>
<th data-quarto-table-cell-role="th">mean_uniprice</th>
<th data-quarto-table-cell-role="th">mean_area</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ad_builttype</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1.0</td>
<td data-quarto-table-cell-role="th">new</td>
<td>331</td>
<td>3351.348469</td>
<td>93.371601</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2.0</td>
<td data-quarto-table-cell-role="th">not-renovated</td>
<td>5298</td>
<td>2755.641980</td>
<td>124.729521</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3.0</td>
<td data-quarto-table-cell-role="th">partially-renovated</td>
<td>52515</td>
<td>3028.525501</td>
<td>172.871199</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NaN</td>
<td data-quarto-table-cell-role="th">unknown-builttype</td>
<td>2785</td>
<td>3436.676784</td>
<td>99.565530</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In this datasets, we have general information regarding the listed houses (number of rooms, number of bedrooms, age of the house). Since these statistics are at the granularity of the district, they corresponds to averages or medians. information regarding the demography (income, population, house occupancy) in the districts, the location of the districts (latitude, longitude), and</p>
<p>Now, let’s have a look to the target to be predicted.</p>
<p>We have seen that listings/unitprices have a validity duration between the first modification date up to the lastseen date. Some listings don’t change, other show price modification and or characteritics modificatiosn. We chose to transform the dataset in order to have a timeseries view of outstanding listings. The idea is to have a daily view of alive listings, that would be usefull to track listing changes (in particular price) over time and build metrics/KPIs. It will also be usefull for modeling/regression purposes.</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>listing_bologna_cleansed.loc[:,<span class="st">'ad_modificationdate'</span>].info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.series.Series'&gt;
Index: 60929 entries, 0 to 61049
Series name: ad_modificationdate
Non-Null Count  Dtype 
--------------  ----- 
60929 non-null  object
dtypes: object(1)
memory usage: 952.0+ KB</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>listing_evo <span class="op">=</span> (listing_bologna_cleansed</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>.assign(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    ad_modificationdate <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'ad_modificationdate'</span>]),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    ad_activationdate <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'ad_activationdate'</span>]),</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    ad_deactivationdate <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'ad_deactivationdate'</span>]),</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    last_seen_date <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'last_seen_date'</span>]),</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    time_to_modify <span class="op">=</span> <span class="kw">lambda</span> x: (x[<span class="st">'ad_modificationdate'</span>] <span class="op">-</span> x[<span class="st">'ad_activationdate'</span>]).dt.days,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    time_to_lastseen <span class="op">=</span> <span class="kw">lambda</span> x: (x[<span class="st">'last_seen_date'</span>] <span class="op">-</span> x[<span class="st">'ad_activationdate'</span>]).dt.days,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    time_to_deactivate <span class="op">=</span><span class="kw">lambda</span> x: (x[<span class="st">'ad_deactivationdate'</span>] <span class="op">-</span> x[<span class="st">'ad_activationdate'</span>]).dt.days,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    price_euro <span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'ad_unitprice'</span>] <span class="op">*</span> x[<span class="st">'ad_area'</span>]</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>listing_evo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_state</th>
<th data-quarto-table-cell-role="th">ad_operation</th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_propertytype</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">ad_activationdate</th>
<th data-quarto-table-cell-role="th">ad_deactivationdate</th>
<th data-quarto-table-cell-role="th">ad_modificationdate</th>
<th data-quarto-table-cell-role="th">ad_layerlocation</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">ad_constructionyear</th>
<th data-quarto-table-cell-role="th">ad_heatingtype</th>
<th data-quarto-table-cell-role="th">last_seen_date</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">ad_typologyname</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
<th data-quarto-table-cell-role="th">time_to_modify</th>
<th data-quarto-table-cell-role="th">time_to_lastseen</th>
<th data-quarto-table-cell-role="th">time_to_deactivate</th>
<th data-quarto-table-cell-role="th">price_euro</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>96af3057c851a1b5594bce0c7f7864c2</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>3000.000000</td>
<td>2021-04-12</td>
<td>2021-03-26</td>
<td>2021-04-22</td>
<td>30907c9787a9f0abb95882f115ff1cec</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>2021-04-28</td>
<td>it</td>
<td>independent-house</td>
<td>partially-renovated</td>
<td>10</td>
<td>16</td>
<td>-17.0</td>
<td>219000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>fa2c84344b6c3bbc7484a8150d7efad6</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1385.416667</td>
<td>2021-09-29</td>
<td>NaT</td>
<td>2021-11-30</td>
<td>319ff21efb401d5c564b88917df71817</td>
<td>...</td>
<td>NaN</td>
<td>CENTRAL_OTHER</td>
<td>2022-01-19</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>62</td>
<td>112</td>
<td>NaN</td>
<td>99750.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>05110a844b8a99e5176aa2dc5e22cc73</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1169.354839</td>
<td>2021-07-22</td>
<td>NaT</td>
<td>2021-08-03</td>
<td>46f3699d96a59f9e2bba52d52b74315f</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>2021-08-04</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>12</td>
<td>13</td>
<td>NaN</td>
<td>108750.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>bebb199b94b68c4b5dd519e3f225caff</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1809.160305</td>
<td>2021-12-04</td>
<td>NaT</td>
<td>2022-01-04</td>
<td>a3c47f8c8202d15ff4aeff6102adc107</td>
<td>...</td>
<td>NaN</td>
<td>CENTRAL_OTHER</td>
<td>2022-01-05</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>31</td>
<td>32</td>
<td>NaN</td>
<td>237000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>b3ca91a1f68caa6dc0d4f93ee2e56011</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1875.000000</td>
<td>2021-11-10</td>
<td>2019-05-31</td>
<td>2021-12-22</td>
<td>408edd8f9b5a1e0b8110093fbf261780</td>
<td>...</td>
<td>NaN</td>
<td>CENTRAL_OTHER</td>
<td>2021-12-23</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>42</td>
<td>43</td>
<td>-894.0</td>
<td>243750.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">61045</td>
<td>b77907e201e56cd044b6c4b227ffd393</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>3457.142857</td>
<td>2020-04-21</td>
<td>NaT</td>
<td>2020-11-12</td>
<td>408edd8f9b5a1e0b8110093fbf261780</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>2021-03-17</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>205</td>
<td>330</td>
<td>NaN</td>
<td>242000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">61046</td>
<td>73dcdc203d9dd95b48ea2d4edd3b2931</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>3475.609756</td>
<td>2021-06-01</td>
<td>NaT</td>
<td>2021-06-28</td>
<td>85ea9cbc768010f730bc474da4a253da</td>
<td>...</td>
<td>2021.0</td>
<td>NaN</td>
<td>2021-06-30</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>27</td>
<td>29</td>
<td>NaN</td>
<td>285000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">61047</td>
<td>25da55cb019156986fba6816f248e0b8</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>4812.500000</td>
<td>2021-11-15</td>
<td>NaT</td>
<td>2022-03-07</td>
<td>a3c47f8c8202d15ff4aeff6102adc107</td>
<td>...</td>
<td>1970.0</td>
<td>CENTRAL_OTHER</td>
<td>2022-03-08</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>112</td>
<td>113</td>
<td>NaN</td>
<td>385000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">61048</td>
<td>815a093ac1fabdd9d25a9f415685318d</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>5285.714286</td>
<td>2022-03-07</td>
<td>NaT</td>
<td>2022-03-07</td>
<td>72fba7c6c57ed8519627ff3b45b712be</td>
<td>...</td>
<td>NaN</td>
<td>INDIVIDUAL_OTHER</td>
<td>2022-03-08</td>
<td>it</td>
<td>independent-house</td>
<td>partially-renovated</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>1850000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">61049</td>
<td>aaece7ab67a29c51c9b9e7c42ed4c504</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>3238.095238</td>
<td>2021-11-25</td>
<td>NaT</td>
<td>2022-02-08</td>
<td>3d17a7e664b3bdb02e542e1301e4c5fd</td>
<td>...</td>
<td>2000.0</td>
<td>INDIVIDUAL</td>
<td>2022-03-16</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>75</td>
<td>111</td>
<td>NaN</td>
<td>340000.0</td>
</tr>
</tbody>
</table>

<p>60929 rows × 54 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>listing_appearance <span class="op">=</span> (listing_evo</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                        .groupby([<span class="st">'ad_id'</span>], as_index<span class="op">=</span><span class="va">False</span>) <span class="co"># add as_index=False</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                        .agg(number_listings<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'size'</span>)))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>listing_appearance.sort_values(<span class="st">'number_listings'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">number_listings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">7967</td>
<td>6f9d0a6762d972ef2462180380804be5</td>
<td>129</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13771</td>
<td>c10bdea477aa0899821a64a063e54821</td>
<td>125</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2485</td>
<td>233c2891e18777a0f769631c279d90bd</td>
<td>119</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10799</td>
<td>96ced9ad42d4613c527d718122957f41</td>
<td>114</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7438</td>
<td>688c95fb367a9e813c631a168998d66f</td>
<td>114</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3377</td>
<td>2fa33e8493ec89dc78ddc7e6fd74823f</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10822</td>
<td>972717afa47e6d57241c393f284a1a2b</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10825</td>
<td>973907542d1310c98dfda122877caaf3</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3373</td>
<td>2f93dc4ad00a81aec5eb9e38d34cc198</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9109</td>
<td>7fc87619db160c121f01e7ba1a01a875</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>18218 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>unique_listings <span class="op">=</span> listing_appearance.loc[listing_appearance.number_listings<span class="op">&lt;</span><span class="dv">2</span>,<span class="st">'ad_id'</span>].to_list()</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(unique_listings))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>repeated_listings <span class="op">=</span> listing_appearance.loc[listing_appearance.number_listings<span class="op">&gt;=</span><span class="dv">2</span>,<span class="st">'ad_id'</span>].to_list()</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(repeated_listings))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>7983
10235</code></pre>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>listing_evo[listing_evo.ad_id<span class="op">==</span><span class="st">'000dda3e1f1f6cff1218cd1e5553fff3'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_state</th>
<th data-quarto-table-cell-role="th">ad_operation</th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_propertytype</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">ad_activationdate</th>
<th data-quarto-table-cell-role="th">ad_deactivationdate</th>
<th data-quarto-table-cell-role="th">ad_modificationdate</th>
<th data-quarto-table-cell-role="th">ad_layerlocation</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">ad_constructionyear</th>
<th data-quarto-table-cell-role="th">ad_heatingtype</th>
<th data-quarto-table-cell-role="th">last_seen_date</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">ad_typologyname</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
<th data-quarto-table-cell-role="th">time_to_modify</th>
<th data-quarto-table-cell-role="th">time_to_lastseen</th>
<th data-quarto-table-cell-role="th">time_to_deactivate</th>
<th data-quarto-table-cell-role="th">price_euro</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">11448</td>
<td>000dda3e1f1f6cff1218cd1e5553fff3</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>4095.744681</td>
<td>2022-03-29</td>
<td>NaT</td>
<td>2022-04-01</td>
<td>72fba7c6c57ed8519627ff3b45b712be</td>
<td>...</td>
<td>1959.0</td>
<td>CENTRAL</td>
<td>2022-04-12</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>3</td>
<td>14</td>
<td>NaN</td>
<td>385000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21381</td>
<td>000dda3e1f1f6cff1218cd1e5553fff3</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>4095.744681</td>
<td>2022-03-29</td>
<td>NaT</td>
<td>2022-05-03</td>
<td>72fba7c6c57ed8519627ff3b45b712be</td>
<td>...</td>
<td>1959.0</td>
<td>CENTRAL</td>
<td>2022-06-12</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>35</td>
<td>75</td>
<td>NaN</td>
<td>385000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31408</td>
<td>000dda3e1f1f6cff1218cd1e5553fff3</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>4095.744681</td>
<td>2022-03-29</td>
<td>NaT</td>
<td>2022-03-31</td>
<td>72fba7c6c57ed8519627ff3b45b712be</td>
<td>...</td>
<td>1959.0</td>
<td>CENTRAL</td>
<td>2022-04-01</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>2</td>
<td>3</td>
<td>NaN</td>
<td>385000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39194</td>
<td>000dda3e1f1f6cff1218cd1e5553fff3</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>4095.744681</td>
<td>2022-03-29</td>
<td>NaT</td>
<td>2022-03-30</td>
<td>72fba7c6c57ed8519627ff3b45b712be</td>
<td>...</td>
<td>1959.0</td>
<td>CENTRAL</td>
<td>2022-03-31</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>1</td>
<td>2</td>
<td>NaN</td>
<td>385000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48013</td>
<td>000dda3e1f1f6cff1218cd1e5553fff3</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>4095.744681</td>
<td>2022-03-29</td>
<td>NaT</td>
<td>2022-04-12</td>
<td>72fba7c6c57ed8519627ff3b45b712be</td>
<td>...</td>
<td>1959.0</td>
<td>CENTRAL</td>
<td>2022-04-26</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>14</td>
<td>28</td>
<td>NaN</td>
<td>385000.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 54 columns</p>
</div>
</div>
</div>
<p>For listings with unique records (ca 8000 unique ids) we check that deactivation_date &lt;= activation_date &lt;= modification_date &lt;= lastseen_date is always True If so, for timeseries / KPI purposes the unitprice will be considered valid for the time window [activation_date,lastseen_date]</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>(listing_evo[listing_evo[<span class="st">'ad_id'</span>].isin(unique_listings)]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>.assign(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    check_activationdate <span class="op">=</span> <span class="kw">lambda</span> x: np.where(x.ad_deactivationdate.isna, <span class="va">True</span>, x.ad_activationdate<span class="op">&gt;=</span>x.ad_deactivationdate),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    check_modificationdate <span class="op">=</span> <span class="kw">lambda</span> x: x.ad_modificationdate<span class="op">&gt;=</span>x.ad_activationdate,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    check_last_seen_date <span class="op">=</span> <span class="kw">lambda</span> x: x.last_seen_date<span class="op">&gt;=</span>x.ad_modificationdate</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>.loc[:,<span class="st">'check_activationdate'</span>:<span class="st">'check_last_seen_date'</span>]</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>.<span class="bu">all</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>check_activationdate      True
check_modificationdate    True
check_last_seen_date      True
dtype: bool</code></pre>
</div>
</div>
<p>For repeated listings, let’s check the frequency of occurences</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>(listing_evo[listing_evo[<span class="st">'ad_id'</span>].isin(repeated_listings)]</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>.groupby([<span class="st">'ad_id'</span>]) </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>.agg(number_listings<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'size'</span>))</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>.plot.hist(bins<span class="op">=</span><span class="dv">100</span>, title<span class="op">=</span><span class="st">'Occurences of repeated listings'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>&lt;Axes: title={'center': 'Occurences of repeated listings'}, ylabel='Frequency'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="03_real_estate_eda_files/figure-html/cell-40-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>(listing_evo[listing_evo[<span class="st">'ad_id'</span>].isin(repeated_listings)]</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>.groupby([<span class="st">'ad_id'</span>]) </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>.agg(number_listings<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'size'</span>))</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>.loc[<span class="kw">lambda</span> x: x.number_listings<span class="op">&lt;</span><span class="dv">30</span>]</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>.plot.hist(bins<span class="op">=</span><span class="dv">100</span>, title<span class="op">=</span><span class="st">'Occurences of repeated listings'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>&lt;Axes: title={'center': 'Occurences of repeated listings'}, ylabel='Frequency'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="03_real_estate_eda_files/figure-html/cell-41-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="pivoting-transforming-data-to-enable-multivariate-time-series-analysis-dataviz" class="level1">
<h1>Pivoting / Transforming data to enable multivariate time series analysis / dataviz</h1>
<p>The idea here is to obtain for each listing (which can be observed times) the range of dates for which it is alive, then transform the data set into a time series or panel.</p>
<p>First for each listing we compute the min/max relevant dates (activation, modification, last seen)</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>range_date <span class="op">=</span> (listing_evo.</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    groupby(<span class="st">'ad_id'</span>).</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    agg(</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>            min_act<span class="op">=</span>(<span class="st">'ad_activationdate'</span>, <span class="st">'min'</span>),</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>            max_act<span class="op">=</span>(<span class="st">'ad_activationdate'</span>, <span class="st">'max'</span>),</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>            n <span class="op">=</span> (<span class="st">'ad_unitprice'</span>, <span class="st">'size'</span>),</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>            ad_firstlistingdate<span class="op">=</span>(<span class="st">'ad_modificationdate'</span>, <span class="st">'min'</span>),</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>            max_mod<span class="op">=</span>(<span class="st">'ad_modificationdate'</span>, <span class="st">'max'</span>),</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>            min_last<span class="op">=</span>(<span class="st">'last_seen_date'</span>, <span class="st">'min'</span>),</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>            max_last<span class="op">=</span>(<span class="st">'last_seen_date'</span>, <span class="st">'max'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>range_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">min_act</th>
<th data-quarto-table-cell-role="th">max_act</th>
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th">ad_firstlistingdate</th>
<th data-quarto-table-cell-role="th">max_mod</th>
<th data-quarto-table-cell-role="th">min_last</th>
<th data-quarto-table-cell-role="th">max_last</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2021-04-20</td>
<td>3</td>
<td>2020-11-20</td>
<td>2021-04-20</td>
<td>2021-01-13</td>
<td>2021-04-21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0004ee3c37ca72184fb63eaaac42ddd3</td>
<td>2020-02-19</td>
<td>2020-02-19</td>
<td>1</td>
<td>2020-02-19</td>
<td>2020-02-19</td>
<td>2021-01-27</td>
<td>2021-01-27</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0006e5a0e99174da7446352ed19dbea4</td>
<td>2022-05-20</td>
<td>2022-05-20</td>
<td>2</td>
<td>2022-05-30</td>
<td>2022-06-05</td>
<td>2022-06-04</td>
<td>2022-06-12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">000c47e07a866762762d2d5022f51006</td>
<td>2021-09-01</td>
<td>2021-09-01</td>
<td>1</td>
<td>2021-09-01</td>
<td>2021-09-01</td>
<td>2021-11-19</td>
<td>2021-11-19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">000dda3e1f1f6cff1218cd1e5553fff3</td>
<td>2022-03-29</td>
<td>2022-03-29</td>
<td>5</td>
<td>2022-03-30</td>
<td>2022-05-03</td>
<td>2022-03-31</td>
<td>2022-06-12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffdfcf945020ad176ae602c2a127d572</td>
<td>2021-05-22</td>
<td>2021-05-22</td>
<td>1</td>
<td>2021-05-22</td>
<td>2021-05-22</td>
<td>2021-06-02</td>
<td>2021-06-02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ffe15762f9cce1efd3cb21803aa12593</td>
<td>2021-09-26</td>
<td>2021-09-26</td>
<td>6</td>
<td>2021-09-26</td>
<td>2021-10-18</td>
<td>2021-09-29</td>
<td>2021-10-25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffe7b55bcf3f85b8ecc3d9f02728d395</td>
<td>2021-02-19</td>
<td>2021-02-19</td>
<td>3</td>
<td>2021-02-19</td>
<td>2021-03-18</td>
<td>2021-02-24</td>
<td>2021-03-24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">fff147f1d7bbd06addb5fcc07e414636</td>
<td>2020-05-07</td>
<td>2020-05-07</td>
<td>1</td>
<td>2020-09-28</td>
<td>2020-09-28</td>
<td>2020-10-28</td>
<td>2020-10-28</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-09</td>
<td>2020-11-21</td>
<td>3</td>
<td>2020-11-10</td>
<td>2020-11-21</td>
<td>2020-11-11</td>
<td>2020-12-23</td>
</tr>
</tbody>
</table>

<p>18218 rows × 7 columns</p>
</div>
</div>
</div>
<p>We will use that the listing is alive between its minimum activation date and its maximum last_seen date. For each listing we produce a column <code>as_ofdate</code> containing a date range (DatetimeIndex) between the two dates, with daily increments:</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>range_date[<span class="st">'ad_asofdate'</span>] <span class="op">=</span> range_date.<span class="bu">apply</span>(<span class="kw">lambda</span> row: pd.date_range(row[<span class="st">'min_act'</span>], row[<span class="st">'max_last'</span>], freq<span class="op">=</span><span class="st">'D'</span>), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>range_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">min_act</th>
<th data-quarto-table-cell-role="th">max_act</th>
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th">ad_firstlistingdate</th>
<th data-quarto-table-cell-role="th">max_mod</th>
<th data-quarto-table-cell-role="th">min_last</th>
<th data-quarto-table-cell-role="th">max_last</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2021-04-20</td>
<td>3</td>
<td>2020-11-20</td>
<td>2021-04-20</td>
<td>2021-01-13</td>
<td>2021-04-21</td>
<td>DatetimeIndex(['2020-11-20', '2020-11-21', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0004ee3c37ca72184fb63eaaac42ddd3</td>
<td>2020-02-19</td>
<td>2020-02-19</td>
<td>1</td>
<td>2020-02-19</td>
<td>2020-02-19</td>
<td>2021-01-27</td>
<td>2021-01-27</td>
<td>DatetimeIndex(['2020-02-19', '2020-02-20', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0006e5a0e99174da7446352ed19dbea4</td>
<td>2022-05-20</td>
<td>2022-05-20</td>
<td>2</td>
<td>2022-05-30</td>
<td>2022-06-05</td>
<td>2022-06-04</td>
<td>2022-06-12</td>
<td>DatetimeIndex(['2022-05-20', '2022-05-21', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">000c47e07a866762762d2d5022f51006</td>
<td>2021-09-01</td>
<td>2021-09-01</td>
<td>1</td>
<td>2021-09-01</td>
<td>2021-09-01</td>
<td>2021-11-19</td>
<td>2021-11-19</td>
<td>DatetimeIndex(['2021-09-01', '2021-09-02', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">000dda3e1f1f6cff1218cd1e5553fff3</td>
<td>2022-03-29</td>
<td>2022-03-29</td>
<td>5</td>
<td>2022-03-30</td>
<td>2022-05-03</td>
<td>2022-03-31</td>
<td>2022-06-12</td>
<td>DatetimeIndex(['2022-03-29', '2022-03-30', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffdfcf945020ad176ae602c2a127d572</td>
<td>2021-05-22</td>
<td>2021-05-22</td>
<td>1</td>
<td>2021-05-22</td>
<td>2021-05-22</td>
<td>2021-06-02</td>
<td>2021-06-02</td>
<td>DatetimeIndex(['2021-05-22', '2021-05-23', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ffe15762f9cce1efd3cb21803aa12593</td>
<td>2021-09-26</td>
<td>2021-09-26</td>
<td>6</td>
<td>2021-09-26</td>
<td>2021-10-18</td>
<td>2021-09-29</td>
<td>2021-10-25</td>
<td>DatetimeIndex(['2021-09-26', '2021-09-27', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffe7b55bcf3f85b8ecc3d9f02728d395</td>
<td>2021-02-19</td>
<td>2021-02-19</td>
<td>3</td>
<td>2021-02-19</td>
<td>2021-03-18</td>
<td>2021-02-24</td>
<td>2021-03-24</td>
<td>DatetimeIndex(['2021-02-19', '2021-02-20', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">fff147f1d7bbd06addb5fcc07e414636</td>
<td>2020-05-07</td>
<td>2020-05-07</td>
<td>1</td>
<td>2020-09-28</td>
<td>2020-09-28</td>
<td>2020-10-28</td>
<td>2020-10-28</td>
<td>DatetimeIndex(['2020-05-07', '2020-05-08', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-09</td>
<td>2020-11-21</td>
<td>3</td>
<td>2020-11-10</td>
<td>2020-11-21</td>
<td>2020-11-11</td>
<td>2020-12-23</td>
<td>DatetimeIndex(['2020-11-09', '2020-11-10', '20...</td>
</tr>
</tbody>
</table>

<p>18218 rows × 8 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>range_date.loc[:,[<span class="st">'min_act'</span>, <span class="st">'max_last'</span>, <span class="st">'ad_asofdate'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">min_act</th>
<th data-quarto-table-cell-role="th">max_last</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2021-04-21</td>
<td>DatetimeIndex(['2020-11-20', '2020-11-21', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0004ee3c37ca72184fb63eaaac42ddd3</td>
<td>2020-02-19</td>
<td>2021-01-27</td>
<td>DatetimeIndex(['2020-02-19', '2020-02-20', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0006e5a0e99174da7446352ed19dbea4</td>
<td>2022-05-20</td>
<td>2022-06-12</td>
<td>DatetimeIndex(['2022-05-20', '2022-05-21', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">000c47e07a866762762d2d5022f51006</td>
<td>2021-09-01</td>
<td>2021-11-19</td>
<td>DatetimeIndex(['2021-09-01', '2021-09-02', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">000dda3e1f1f6cff1218cd1e5553fff3</td>
<td>2022-03-29</td>
<td>2022-06-12</td>
<td>DatetimeIndex(['2022-03-29', '2022-03-30', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffdfcf945020ad176ae602c2a127d572</td>
<td>2021-05-22</td>
<td>2021-06-02</td>
<td>DatetimeIndex(['2021-05-22', '2021-05-23', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ffe15762f9cce1efd3cb21803aa12593</td>
<td>2021-09-26</td>
<td>2021-10-25</td>
<td>DatetimeIndex(['2021-09-26', '2021-09-27', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffe7b55bcf3f85b8ecc3d9f02728d395</td>
<td>2021-02-19</td>
<td>2021-03-24</td>
<td>DatetimeIndex(['2021-02-19', '2021-02-20', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">fff147f1d7bbd06addb5fcc07e414636</td>
<td>2020-05-07</td>
<td>2020-10-28</td>
<td>DatetimeIndex(['2020-05-07', '2020-05-08', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-09</td>
<td>2020-12-23</td>
<td>DatetimeIndex(['2020-11-09', '2020-11-10', '20...</td>
</tr>
</tbody>
</table>

<p>18218 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>range_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">min_act</th>
<th data-quarto-table-cell-role="th">max_act</th>
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th">ad_firstlistingdate</th>
<th data-quarto-table-cell-role="th">max_mod</th>
<th data-quarto-table-cell-role="th">min_last</th>
<th data-quarto-table-cell-role="th">max_last</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2021-04-20</td>
<td>3</td>
<td>2020-11-20</td>
<td>2021-04-20</td>
<td>2021-01-13</td>
<td>2021-04-21</td>
<td>DatetimeIndex(['2020-11-20', '2020-11-21', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0004ee3c37ca72184fb63eaaac42ddd3</td>
<td>2020-02-19</td>
<td>2020-02-19</td>
<td>1</td>
<td>2020-02-19</td>
<td>2020-02-19</td>
<td>2021-01-27</td>
<td>2021-01-27</td>
<td>DatetimeIndex(['2020-02-19', '2020-02-20', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0006e5a0e99174da7446352ed19dbea4</td>
<td>2022-05-20</td>
<td>2022-05-20</td>
<td>2</td>
<td>2022-05-30</td>
<td>2022-06-05</td>
<td>2022-06-04</td>
<td>2022-06-12</td>
<td>DatetimeIndex(['2022-05-20', '2022-05-21', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">000c47e07a866762762d2d5022f51006</td>
<td>2021-09-01</td>
<td>2021-09-01</td>
<td>1</td>
<td>2021-09-01</td>
<td>2021-09-01</td>
<td>2021-11-19</td>
<td>2021-11-19</td>
<td>DatetimeIndex(['2021-09-01', '2021-09-02', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">000dda3e1f1f6cff1218cd1e5553fff3</td>
<td>2022-03-29</td>
<td>2022-03-29</td>
<td>5</td>
<td>2022-03-30</td>
<td>2022-05-03</td>
<td>2022-03-31</td>
<td>2022-06-12</td>
<td>DatetimeIndex(['2022-03-29', '2022-03-30', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffdfcf945020ad176ae602c2a127d572</td>
<td>2021-05-22</td>
<td>2021-05-22</td>
<td>1</td>
<td>2021-05-22</td>
<td>2021-05-22</td>
<td>2021-06-02</td>
<td>2021-06-02</td>
<td>DatetimeIndex(['2021-05-22', '2021-05-23', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ffe15762f9cce1efd3cb21803aa12593</td>
<td>2021-09-26</td>
<td>2021-09-26</td>
<td>6</td>
<td>2021-09-26</td>
<td>2021-10-18</td>
<td>2021-09-29</td>
<td>2021-10-25</td>
<td>DatetimeIndex(['2021-09-26', '2021-09-27', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffe7b55bcf3f85b8ecc3d9f02728d395</td>
<td>2021-02-19</td>
<td>2021-02-19</td>
<td>3</td>
<td>2021-02-19</td>
<td>2021-03-18</td>
<td>2021-02-24</td>
<td>2021-03-24</td>
<td>DatetimeIndex(['2021-02-19', '2021-02-20', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">fff147f1d7bbd06addb5fcc07e414636</td>
<td>2020-05-07</td>
<td>2020-05-07</td>
<td>1</td>
<td>2020-09-28</td>
<td>2020-09-28</td>
<td>2020-10-28</td>
<td>2020-10-28</td>
<td>DatetimeIndex(['2020-05-07', '2020-05-08', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-09</td>
<td>2020-11-21</td>
<td>3</td>
<td>2020-11-10</td>
<td>2020-11-21</td>
<td>2020-11-11</td>
<td>2020-12-23</td>
<td>DatetimeIndex(['2020-11-09', '2020-11-10', '20...</td>
</tr>
</tbody>
</table>

<p>18218 rows × 8 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>range_date.loc[:,[<span class="st">'min_act'</span>, <span class="st">'max_last'</span>, <span class="st">'ad_asofdate'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">min_act</th>
<th data-quarto-table-cell-role="th">max_last</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2021-04-21</td>
<td>DatetimeIndex(['2020-11-20', '2020-11-21', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0004ee3c37ca72184fb63eaaac42ddd3</td>
<td>2020-02-19</td>
<td>2021-01-27</td>
<td>DatetimeIndex(['2020-02-19', '2020-02-20', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0006e5a0e99174da7446352ed19dbea4</td>
<td>2022-05-20</td>
<td>2022-06-12</td>
<td>DatetimeIndex(['2022-05-20', '2022-05-21', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">000c47e07a866762762d2d5022f51006</td>
<td>2021-09-01</td>
<td>2021-11-19</td>
<td>DatetimeIndex(['2021-09-01', '2021-09-02', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">000dda3e1f1f6cff1218cd1e5553fff3</td>
<td>2022-03-29</td>
<td>2022-06-12</td>
<td>DatetimeIndex(['2022-03-29', '2022-03-30', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffdfcf945020ad176ae602c2a127d572</td>
<td>2021-05-22</td>
<td>2021-06-02</td>
<td>DatetimeIndex(['2021-05-22', '2021-05-23', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ffe15762f9cce1efd3cb21803aa12593</td>
<td>2021-09-26</td>
<td>2021-10-25</td>
<td>DatetimeIndex(['2021-09-26', '2021-09-27', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffe7b55bcf3f85b8ecc3d9f02728d395</td>
<td>2021-02-19</td>
<td>2021-03-24</td>
<td>DatetimeIndex(['2021-02-19', '2021-02-20', '20...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">fff147f1d7bbd06addb5fcc07e414636</td>
<td>2020-05-07</td>
<td>2020-10-28</td>
<td>DatetimeIndex(['2020-05-07', '2020-05-08', '20...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-09</td>
<td>2020-12-23</td>
<td>DatetimeIndex(['2020-11-09', '2020-11-10', '20...</td>
</tr>
</tbody>
</table>

<p>18218 rows × 3 columns</p>
</div>
</div>
</div>
<p>pandas <code>explode</code> : Transform each element of a list-like to a row, replicating index values.</p>
<p>We then explode the <code>ad_asofdate</code> column into multiple rows (one for each date for which the listing is alive):</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>range_date <span class="op">=</span> range_date.explode(<span class="st">'ad_asofdate'</span>).reset_index() <span class="op">\</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>        .drop(columns<span class="op">=</span>[<span class="st">'min_act'</span>, <span class="st">'max_act'</span>, <span class="st">'n'</span>, <span class="st">'max_mod'</span>, <span class="st">'min_last'</span>, <span class="st">'max_last'</span>]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>range_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_firstlistingdate</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-21</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1974762</td>
<td>ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-10</td>
<td>2020-12-19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1974763</td>
<td>ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-10</td>
<td>2020-12-20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1974764</td>
<td>ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-10</td>
<td>2020-12-21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1974765</td>
<td>ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-10</td>
<td>2020-12-22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1974766</td>
<td>ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-10</td>
<td>2020-12-23</td>
</tr>
</tbody>
</table>

<p>1974767 rows × 3 columns</p>
</div>
</div>
</div>
<p>Finally we merge this data set containg for each listing rows of asof/alive dates, with the listing data. We use the modification date on the right to merge, so that each time a listing is modified, its data is updated in the time series:</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>time_series_listings<span class="op">=</span>pd.merge(range_date,</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>             listing_evo, left_on<span class="op">=</span>[<span class="st">'ad_asofdate'</span>, <span class="st">'ad_id'</span>],</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>             right_on<span class="op">=</span>[<span class="st">'ad_modificationdate'</span>, <span class="st">'ad_id'</span>],</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>             how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>time_series_listings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_firstlistingdate</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">ad_state</th>
<th data-quarto-table-cell-role="th">ad_operation</th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_propertytype</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">ad_activationdate</th>
<th data-quarto-table-cell-role="th">ad_deactivationdate</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">ad_constructionyear</th>
<th data-quarto-table-cell-role="th">ad_heatingtype</th>
<th data-quarto-table-cell-role="th">last_seen_date</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">ad_typologyname</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
<th data-quarto-table-cell-role="th">time_to_modify</th>
<th data-quarto-table-cell-role="th">time_to_lastseen</th>
<th data-quarto-table-cell-role="th">time_to_deactivate</th>
<th data-quarto-table-cell-role="th">price_euro</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-20</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1810.526316</td>
<td>2020-11-20</td>
<td>NaT</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>2021-01-13</td>
<td>it</td>
<td>apartment-other</td>
<td>partially-renovated</td>
<td>0.0</td>
<td>54.0</td>
<td>NaN</td>
<td>172000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-21</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaT</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-22</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaT</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-23</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaT</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-24</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaT</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1974762</td>
<td>ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-10</td>
<td>2020-12-19</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaT</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1974763</td>
<td>ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-10</td>
<td>2020-12-20</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaT</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1974764</td>
<td>ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-10</td>
<td>2020-12-21</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaT</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1974765</td>
<td>ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-10</td>
<td>2020-12-22</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaT</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1974766</td>
<td>ffffb19c56dc8ca85f372f9a4193eff6</td>
<td>2020-11-10</td>
<td>2020-12-23</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaT</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaT</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>1974767 rows × 56 columns</p>
</div>
</div>
</div>
<p>Between two modifications (or after the first add listing if the listing is unmodified), our data set shows NaN values that we fill using data from the last modification date:</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>time_series_listings<span class="op">=</span>pd.merge(range_date,</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>             listing_evo, left_on<span class="op">=</span>[<span class="st">'ad_asofdate'</span>, <span class="st">'ad_id'</span>],</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>             right_on<span class="op">=</span>[<span class="st">'ad_modificationdate'</span>, <span class="st">'ad_id'</span>],</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>             how<span class="op">=</span><span class="st">'left'</span>).ffill()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="170">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>time_series_listings <span class="op">=</span> time_series_listings[time_series_listings[<span class="st">'ad_unitprice'</span>].notna()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="169">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>time_series_listings[<span class="st">'first_price'</span>] <span class="op">=</span> (</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    time_series_listings.</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    sort_values(by<span class="op">=</span>[<span class="st">'ad_id'</span>, <span class="st">'ad_activationdate'</span>]).</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    groupby(<span class="st">'ad_id'</span>)[<span class="st">'ad_unitprice'</span>].</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    transform(<span class="st">'first'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>time_series_listings.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1974767 entries, 0 to 1974766
Data columns (total 57 columns):
 #   Column                         Dtype         
---  ------                         -----         
 0   ad_id                          object        
 1   ad_firstlistingdate            datetime64[ns]
 2   ad_asofdate                    datetime64[ns]
 3   ad_state                       float64       
 4   ad_operation                   float64       
 5   ad_typology                    float64       
 6   ad_propertytype                float64       
 7   ad_unitprice                   float64       
 8   ad_activationdate              datetime64[ns]
 9   ad_deactivationdate            datetime64[ns]
 10  ad_modificationdate            datetime64[ns]
 11  ad_layerlocation               object        
 12  ad_province                    object        
 13  ad_town                        object        
 14  ad_postalcode                  float64       
 15  ad_streettype                  object        
 16  ad_streetname                  object        
 17  ad_streetnumber                float64       
 18  ad_floornumber                 object        
 19  ad_addressvisible              float64       
 20  ad_subtypology                 float64       
 21  ad_area                        float64       
 22  ad_builttype                   float64       
 23  ad_roomnumber                  float64       
 24  ad_bathnumber                  float64       
 25  ad_flatlocation                float64       
 26  ad_haslift                     float64       
 27  ad_hasparkingspace             float64       
 28  ad_hasboxroom                  float64       
 29  ad_hasswimmingpool             float64       
 30  newdevelopment_commercialname  float64       
 31  newdevelopment_fromprice       float64       
 32  newdevelopment_averageprice    float64       
 33  layerlocation_area             float64       
 34  layerlocation_population       float64       
 35  estate_cadastralroot           float64       
 36  property_cadastralreference    float64       
 37  property_builtdate             float64       
 38  property_area                  float64       
 39  property_use                   float64       
 40  censustract_id                 float64       
 41  censustract_town_id            float64       
 42  address_certainty              float64       
 43  cadastral_certainty            float64       
 44  ad_ParkingIsIncludedInPrice    float64       
 45  ad_isAuction                   float64       
 46  ad_constructionyear            float64       
 47  ad_heatingtype                 object        
 48  last_seen_date                 datetime64[ns]
 49  country                        object        
 50  ad_typologyname                object        
 51  ad_builttypename               object        
 52  time_to_modify                 float64       
 53  time_to_lastseen               float64       
 54  time_to_deactivate             float64       
 55  price_euro                     float64       
 56  first_price                    float64       
dtypes: datetime64[ns](6), float64(40), object(11)
memory usage: 858.8+ MB</code></pre>
</div>
</div>
<p>For better readability, instead of MD5 ‘ad_layerlocation’ representing the town districts we define short names ‘lay_XX’ ordered by number of listings observed in the dataset.</p>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>name_layers<span class="op">=</span>(listing_bologna_cleansed </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>       .groupby([<span class="st">'ad_layerlocation'</span>])</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>       .agg(n_listings<span class="op">=</span>(<span class="st">'ad_id'</span>, <span class="st">'count'</span>))</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>       .reset_index()</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>       .sort_values(by<span class="op">=</span><span class="st">'n_listings'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>       .assign(ad_layerid <span class="op">=</span> <span class="kw">lambda</span> x: <span class="st">'lay_'</span> <span class="op">+</span> x.n_listings.rank(method<span class="op">=</span><span class="st">'first'</span>,ascending<span class="op">=</span><span class="va">False</span>).astype(<span class="bu">int</span>).astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">2</span>))</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>       .loc[:,[<span class="st">'ad_layerlocation'</span>,<span class="st">'ad_layerid'</span>]])</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>name_layers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_layerlocation</th>
<th data-quarto-table-cell-role="th">ad_layerid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>85ea9cbc768010f730bc474da4a253da</td>
<td>lay_01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>46f3699d96a59f9e2bba52d52b74315f</td>
<td>lay_02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>df7ce39f801ce4de8d05cd243dd7f5d7</td>
<td>lay_03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>a3c47f8c8202d15ff4aeff6102adc107</td>
<td>lay_04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>72fba7c6c57ed8519627ff3b45b712be</td>
<td>lay_05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>bed4247ad695180b20040d14b25af551</td>
<td>lay_06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>408edd8f9b5a1e0b8110093fbf261780</td>
<td>lay_07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>5f8908f23709d384f8955c831f6b204e</td>
<td>lay_08</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>319ff21efb401d5c564b88917df71817</td>
<td>lay_09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>52cd50eede0d8d599447eecf578fe2d6</td>
<td>lay_10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>96c63b3a47c2ac51cd191ce61ff32e62</td>
<td>lay_11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>3d17a7e664b3bdb02e542e1301e4c5fd</td>
<td>lay_12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>566970b69cb9ece6ec78ef729a24da67</td>
<td>lay_13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2980880cab17cd30f699235c2a2b74d8</td>
<td>lay_14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>79ae74c58af1dfb4d92181f8574a020f</td>
<td>lay_15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>2b6ad9c422f1dd2cab3c76ea8180a1f0</td>
<td>lay_16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>30907c9787a9f0abb95882f115ff1cec</td>
<td>lay_17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>01325f6317e14398244811321639fb91</td>
<td>lay_18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>c0ff13b213e1e7e1947e52afe9b9d68b</td>
<td>lay_19</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>time_series_listings<span class="op">=</span>time_series_listings.merge(name_layers, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'ad_layerlocation'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Verifying data is ok: for listing 0013b390026491e9f4e7fe0ccfac842b, first modification date was 16-Feb-2021 and last seen date 21-Apr-2021, price droped from 2500 to 2150.</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>time_series_listings.loc[time_series_listings[<span class="st">'ad_id'</span>]<span class="op">==</span><span class="st">'0013b390026491e9f4e7fe0ccfac842b'</span>,[<span class="st">'ad_id'</span>, <span class="st">'ad_asofdate'</span>, <span class="st">'last_seen_date'</span>,<span class="st">'ad_unitprice'</span>,<span class="st">'first_price'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">last_seen_date</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">first_price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">759</td>
<td>0013b390026491e9f4e7fe0ccfac842b</td>
<td>2021-02-16</td>
<td>2021-02-24</td>
<td>2500.0</td>
<td>2500.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">760</td>
<td>0013b390026491e9f4e7fe0ccfac842b</td>
<td>2021-02-17</td>
<td>2021-02-24</td>
<td>2500.0</td>
<td>2500.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">761</td>
<td>0013b390026491e9f4e7fe0ccfac842b</td>
<td>2021-02-18</td>
<td>2021-02-24</td>
<td>2500.0</td>
<td>2500.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">762</td>
<td>0013b390026491e9f4e7fe0ccfac842b</td>
<td>2021-02-19</td>
<td>2021-02-24</td>
<td>2500.0</td>
<td>2500.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">763</td>
<td>0013b390026491e9f4e7fe0ccfac842b</td>
<td>2021-02-20</td>
<td>2021-02-24</td>
<td>2500.0</td>
<td>2500.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">819</td>
<td>0013b390026491e9f4e7fe0ccfac842b</td>
<td>2021-04-17</td>
<td>2021-04-14</td>
<td>2150.0</td>
<td>2500.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">820</td>
<td>0013b390026491e9f4e7fe0ccfac842b</td>
<td>2021-04-18</td>
<td>2021-04-14</td>
<td>2150.0</td>
<td>2500.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">821</td>
<td>0013b390026491e9f4e7fe0ccfac842b</td>
<td>2021-04-19</td>
<td>2021-04-14</td>
<td>2150.0</td>
<td>2500.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">822</td>
<td>0013b390026491e9f4e7fe0ccfac842b</td>
<td>2021-04-20</td>
<td>2021-04-21</td>
<td>2150.0</td>
<td>2500.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">823</td>
<td>0013b390026491e9f4e7fe0ccfac842b</td>
<td>2021-04-21</td>
<td>2021-04-21</td>
<td>2150.0</td>
<td>2500.0</td>
</tr>
</tbody>
</table>

<p>65 rows × 5 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span>[<span class="st">'0003c7f627ceac5928277fcf60d3e762'</span>, <span class="st">'0016fc749d2ba6dd72039ad98dacd955'</span>, <span class="st">'0021702dea1a5689ba57bc2b4787d2e3'</span>, <span class="st">'007cfc33307eed400e4e217aa1c29030'</span>, <span class="st">'007c4bbce03b37f69e16a7afb2ce599c'</span>]</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>(time_series_listings[time_series_listings[<span class="st">'ad_id'</span>].isin(sample)]</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>.loc[:,[<span class="st">'ad_id'</span>, <span class="st">'ad_asofdate'</span>, <span class="st">'last_seen_date'</span>,<span class="st">'ad_unitprice'</span>,<span class="st">'first_price'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">last_seen_date</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">first_price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2021-01-13</td>
<td>1810.526316</td>
<td>1810.526316</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-21</td>
<td>2021-01-13</td>
<td>1810.526316</td>
<td>1810.526316</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-22</td>
<td>2021-01-13</td>
<td>1810.526316</td>
<td>1810.526316</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-23</td>
<td>2021-01-13</td>
<td>1810.526316</td>
<td>1810.526316</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-24</td>
<td>2021-01-13</td>
<td>1810.526316</td>
<td>1810.526316</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4307</td>
<td>007cfc33307eed400e4e217aa1c29030</td>
<td>2021-05-29</td>
<td>2021-06-02</td>
<td>2928.571429</td>
<td>2928.571429</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4308</td>
<td>007cfc33307eed400e4e217aa1c29030</td>
<td>2021-05-30</td>
<td>2021-06-02</td>
<td>2928.571429</td>
<td>2928.571429</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4309</td>
<td>007cfc33307eed400e4e217aa1c29030</td>
<td>2021-05-31</td>
<td>2021-06-02</td>
<td>2928.571429</td>
<td>2928.571429</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4310</td>
<td>007cfc33307eed400e4e217aa1c29030</td>
<td>2021-06-01</td>
<td>2021-06-02</td>
<td>2928.571429</td>
<td>2928.571429</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4311</td>
<td>007cfc33307eed400e4e217aa1c29030</td>
<td>2021-06-02</td>
<td>2021-06-02</td>
<td>2928.571429</td>
<td>2928.571429</td>
</tr>
</tbody>
</table>

<p>408 rows × 5 columns</p>
</div>
</div>
</div>
<p>Show number of alive listings</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>time_series_listings_daily <span class="op">=</span> (time_series_listings</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>                                .assign(ad_asofdate <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'ad_asofdate'</span>]))</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                                .groupby(<span class="st">'ad_asofdate'</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                                .agg(number_alive_listings<span class="op">=</span>(<span class="st">'ad_id'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                                     mean_price<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'mean'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We roughly plot daily number of listings vs average prices. The average price of outstanding listings seem to rise in 2022 while the number of listings continuously decreases. We will have to check if the rise in price is due to change in listings quality and characteristics (different type of listings put on the market), or a pure offer-demand effect denoting a “hot” market.</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> time_series_listings_daily.reset_index()</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(df, x<span class="op">=</span><span class="st">'ad_asofdate'</span>, y<span class="op">=</span><span class="st">'number_alive_listings'</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>fig.add_traces(go.Scatter(x<span class="op">=</span> df.ad_asofdate, y<span class="op">=</span>df.mean_price, mode <span class="op">=</span> <span class="st">'lines'</span>, name<span class="op">=</span><span class="st">'Listing price €/sqm'</span>))</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>fig.layout.xaxis.title<span class="op">=</span><span class="st">"Date"</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>fig.layout.yaxis.title<span class="op">=</span><span class="st">"Number of outstanding listings"</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning: The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
  v = v.dt.to_pydatetime()
/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>Nicer chart focusing on the 2020-2022 period (before that listings are scarse and average price meaningless)</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>time_series_listings_daily.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>DatetimeIndex(['2015-11-09', '2015-11-10', '2015-11-11', '2015-11-12',
               '2015-11-13', '2015-11-14', '2015-11-15', '2015-11-16',
               '2015-11-17', '2015-11-18',
               ...
               '2022-06-03', '2022-06-04', '2022-06-05', '2022-06-06',
               '2022-06-07', '2022-06-08', '2022-06-09', '2022-06-10',
               '2022-06-11', '2022-06-12'],
              dtype='datetime64[ns]', name='ad_asofdate', length=2408, freq=None)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> time_series_listings_daily.loc[<span class="st">'2019-12-31'</span>:<span class="st">'2022-06-30'</span>].reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure with secondary y-axis</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> make_subplots(specs<span class="op">=</span>[[{<span class="st">"secondary_y"</span>: <span class="va">True</span>}]])</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add traces</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co"># fig.add_trace(</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     go.Bar(x=df.ad_asofdate, y=df.number_alive_listings, name="Listings"),</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     secondary_y=False,</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Scatter(</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>df.ad_asofdate, y<span class="op">=</span>df.number_alive_listings, name<span class="op">=</span><span class="st">"Listings"</span>,</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    hoverinfo<span class="op">=</span><span class="st">'x+y'</span>,</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">'lines'</span>,</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(width<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'rgb(131, 90, 241)'</span>),</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>    stackgroup<span class="op">=</span><span class="st">'one'</span>),</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>    secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>    go.Scatter(x<span class="op">=</span>df.ad_asofdate, y<span class="op">=</span>df.mean_price, name<span class="op">=</span><span class="st">"Prices"</span>, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'rgb(111, 231, 219)'</span>)),</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>    secondary_y<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Number of listings and average price evolution"</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Number of outstanding listings"</span>, secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Listing price €/sqm"</span>, secondary_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a><span class="co"># plotly manual axis adjustments</span></span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>,<span class="dv">3000</span>], secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">2500</span>,<span class="dv">3500</span>], secondary_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>Adding the daily share of newly added listings</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> (time_series_listings</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>        .assign(ad_asofdate <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'ad_asofdate'</span>]),</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>                ad_firstlistingdate <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'ad_firstlistingdate'</span>]),</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>                is_newlisting <span class="op">=</span> <span class="kw">lambda</span> x: x.ad_firstlistingdate <span class="op">==</span> x.ad_asofdate)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'ad_asofdate'</span>,<span class="st">'is_newlisting'</span>])</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>        .agg(number_alive_listings<span class="op">=</span>(<span class="st">'ad_id'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>             mean_price<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'mean'</span>))</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>        .loc[<span class="st">'2019-12-31'</span>:<span class="st">'2022-06-30'</span>].</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>        reset_index())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">is_newlisting</th>
<th data-quarto-table-cell-role="th">number_alive_listings</th>
<th data-quarto-table-cell-role="th">mean_price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2019-12-31</td>
<td>False</td>
<td>470</td>
<td>3039.207559</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2020-01-01</td>
<td>False</td>
<td>467</td>
<td>3038.639223</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2020-01-01</td>
<td>True</td>
<td>3</td>
<td>3585.730319</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2020-01-02</td>
<td>False</td>
<td>470</td>
<td>3044.938980</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2020-01-02</td>
<td>True</td>
<td>2</td>
<td>3215.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1710</td>
<td>2022-06-10</td>
<td>False</td>
<td>2187</td>
<td>3341.035184</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1711</td>
<td>2022-06-10</td>
<td>True</td>
<td>48</td>
<td>3536.351554</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1712</td>
<td>2022-06-11</td>
<td>False</td>
<td>2175</td>
<td>3348.865049</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1713</td>
<td>2022-06-11</td>
<td>True</td>
<td>6</td>
<td>3354.531470</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1714</td>
<td>2022-06-12</td>
<td>False</td>
<td>2181</td>
<td>3348.880638</td>
</tr>
</tbody>
</table>

<p>1715 rows × 4 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>(df2</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>.loc[df2.is_newlisting,[<span class="st">'number_alive_listings'</span>]].mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>number_alive_listings    22.053659
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> make_subplots(specs<span class="op">=</span>[[{<span class="st">"secondary_y"</span>: <span class="va">True</span>}]])</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add traces</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Scatter(</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>df2[df2[<span class="st">'is_newlisting'</span>]].ad_asofdate, y<span class="op">=</span>df2[df2[<span class="st">'is_newlisting'</span>]].number_alive_listings, name<span class="op">=</span><span class="st">"New listings"</span>,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    hoverinfo<span class="op">=</span><span class="st">'x+y'</span>,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">'lines'</span>,</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(width<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'rgb(131, 90, 241)'</span>),</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    stackgroup<span class="op">=</span><span class="st">'one'</span>), <span class="co"># define stack group</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>    secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Scatter(</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>df2[<span class="op">~</span>df2[<span class="st">'is_newlisting'</span>]].ad_asofdate, y<span class="op">=</span>df2[<span class="op">~</span>df2[<span class="st">'is_newlisting'</span>]].number_alive_listings, name<span class="op">=</span><span class="st">"Old listings"</span>,</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>    hoverinfo<span class="op">=</span><span class="st">'x+y'</span>,</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">'lines'</span>,</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(width<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'rgb(184, 247, 212)'</span>),</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>    stackgroup<span class="op">=</span><span class="st">'one'</span>), </span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>    secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>    go.Scatter(x<span class="op">=</span>df.ad_asofdate, y<span class="op">=</span>df.mean_price, name<span class="op">=</span><span class="st">"Prices"</span>, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'rgb(111, 231, 219)'</span>)),</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>    secondary_y<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Number of listings and average price evolution"</span></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Number of outstanding listings"</span>, secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Listing price €/sqm"</span>, secondary_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a><span class="co"># plotly manual axis adjustments</span></span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>,<span class="dv">3000</span>], secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">2500</span>,<span class="dv">3500</span>], secondary_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>Showing detail on layers in terms of number of listings and price evolution</p>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> (time_series_listings</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>        .assign(ad_asofdate <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'ad_asofdate'</span>]),</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>                property_value <span class="op">=</span> <span class="kw">lambda</span> x: x.ad_area<span class="op">*</span>x.ad_unitprice)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'ad_asofdate'</span>,<span class="st">'ad_layerid'</span>])</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>        .agg(number_alive_listings<span class="op">=</span>(<span class="st">'ad_id'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>             mean_price<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'mean'</span>),</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>             property_value<span class="op">=</span>(<span class="st">'property_value'</span>, <span class="st">'sum'</span>))</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>        .loc[<span class="st">'2019-12-31'</span>:<span class="st">'2022-06-30'</span>]</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>        .sort_values([<span class="st">'ad_layerid'</span>,<span class="st">'ad_asofdate'</span>])</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.area(df3, x<span class="op">=</span><span class="st">"ad_asofdate"</span>, y<span class="op">=</span><span class="st">"number_alive_listings"</span>, color<span class="op">=</span><span class="st">"ad_layerid"</span>, line_group<span class="op">=</span><span class="st">"ad_layerid"</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Outstanding number of listings by district/layer"</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Number of outstanding listings"</span>)</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.area(df3, x<span class="op">=</span><span class="st">"ad_asofdate"</span>, y<span class="op">=</span><span class="st">"property_value"</span>, color<span class="op">=</span><span class="st">"ad_layerid"</span>, line_group<span class="op">=</span><span class="st">"ad_layerid"</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Outstanding value of listings by district/layer"</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Outstanding market value of listings (€B)"</span>)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(df3, x<span class="op">=</span><span class="st">"ad_asofdate"</span>, y<span class="op">=</span><span class="st">"mean_price"</span>, color<span class="op">=</span><span class="st">"ad_layerid"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Average price by district/layer"</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Price €/sqm"</span>)</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>df3bis <span class="op">=</span> (time_series_listings</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>        .assign(ad_asofdate <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'ad_asofdate'</span>]))</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'ad_asofdate'</span>,<span class="st">'ad_builttypename'</span>])</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>        .agg(number_alive_listings<span class="op">=</span>(<span class="st">'ad_id'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>             mean_price<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'mean'</span>))</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>        .loc[<span class="st">'2019-12-31'</span>:<span class="st">'2022-06-30'</span>]</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>        .sort_values([<span class="st">'ad_builttypename'</span>,<span class="st">'ad_asofdate'</span>]))</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(df3bis, x<span class="op">=</span><span class="st">"ad_asofdate"</span>, y<span class="op">=</span><span class="st">"mean_price"</span>, color<span class="op">=</span><span class="st">"ad_builttypename"</span>)</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Average price by 'builttype' (ie renovation status)"</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Price €/sqm"</span>)</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.area(df3bis, x<span class="op">=</span><span class="st">"ad_asofdate"</span>, y<span class="op">=</span><span class="st">"number_alive_listings"</span>, color<span class="op">=</span><span class="st">"ad_builttypename"</span>, line_group<span class="op">=</span><span class="st">"ad_builttypename"</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Outstanding number of listings by 'builttype' (ie renovation status)"</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Number of outstanding listings"</span>)</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>New/not-renovated/partially-renovated average prices seem consistent. Issue with unknow-builtype (empty) category: difficult to impute the variable, as there seem to beem a switching regime before (few quotes like old buildings) / after (more quotes like new buildings) August 2021. Nonetheless the information on renovation should have importance in a regression model and in terms of business the choice of building renovation status can be crucial. For example a metric on margin/premium of refurbished vs old apartments can be of interest for the CEO.</p>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> classify_construction_period(construction_year):</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">match</span> construction_year:</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> _ <span class="cf">if</span> <span class="dv">2022</span> <span class="op">&lt;</span> construction_year:</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Unknown'</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> _ <span class="cf">if</span> construction_year <span class="op">&lt;</span> <span class="dv">1700</span>:</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"&lt;1700"</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> _ <span class="cf">if</span> construction_year <span class="op">&gt;=</span> <span class="dv">1700</span> <span class="kw">and</span> construction_year <span class="op">&lt;</span> <span class="dv">1900</span>:</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"1700-1900"</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> _ <span class="cf">if</span> construction_year <span class="op">&gt;=</span> <span class="dv">1900</span>:</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">str</span>(<span class="bu">int</span>(construction_year <span class="op">-</span> (construction_year<span class="op">%</span><span class="dv">10</span>)))</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> _:</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Unknown'</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>time_series_listings[<span class="st">'ad_constructionperiod'</span>] <span class="op">=</span> time_series_listings[<span class="st">'ad_constructionyear'</span>].<span class="bu">apply</span>(classify_construction_period)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>df4 <span class="op">=</span> (time_series_listings</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>        .assign(ad_asofdate <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'ad_asofdate'</span>]))</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'ad_asofdate'</span>,<span class="st">'ad_constructionperiod'</span>])</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>        .agg(number_alive_listings<span class="op">=</span>(<span class="st">'ad_id'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>             mean_price<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'mean'</span>))</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>        .loc[<span class="st">'2019-12-31'</span>:<span class="st">'2022-06-30'</span>]</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>        .sort_values([<span class="st">'ad_constructionperiod'</span>,<span class="st">'ad_asofdate'</span>])</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(df4, x<span class="op">=</span><span class="st">"ad_asofdate"</span>, y<span class="op">=</span><span class="st">"mean_price"</span>, color<span class="op">=</span><span class="st">"ad_constructionperiod"</span>)</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Average price by construction period"</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Price €/sqm"</span>)</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>“Modern” apartments (Post WWII up to end of 90’s) seem to quote lower. &gt;2000 apartments quote higher. And there is a premium for “Antiques” and Pre WWII buildings. Pretty similar to Hausmanian effect in Paris.</p>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>df5 <span class="op">=</span> (time_series_listings</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>        .assign(ad_asofdate <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'ad_asofdate'</span>]))</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'ad_asofdate'</span>,<span class="st">'ad_floornumber'</span>])</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>        .agg(number_alive_listings<span class="op">=</span>(<span class="st">'ad_id'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>             mean_price<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'mean'</span>))</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>        .loc[<span class="st">'2019-12-31'</span>:<span class="st">'2022-06-30'</span>]</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>        .sort_values([<span class="st">'ad_floornumber'</span>,<span class="st">'ad_asofdate'</span>])</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(df5, x<span class="op">=</span><span class="st">"ad_asofdate"</span>, y<span class="op">=</span><span class="st">"mean_price"</span>, color<span class="op">=</span><span class="st">"ad_floornumber"</span>)</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Average price by floor/level"</span></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Price €/sqm"</span>)</span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>Resampling time series to months/quarters</p>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>time_series_listings_1m<span class="op">=</span>(time_series_listings</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>.assign(ad_asofdate <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'ad_asofdate'</span>]))</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>.groupby([<span class="st">'ad_asofdate'</span>,<span class="st">'ad_layerid'</span>])</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>.agg(number_alive_listings<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>     mean_price<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'mean'</span>))</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>.reset_index() </span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>.groupby([<span class="st">'ad_layerid'</span>])</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>.resample(<span class="st">'M'</span>, convention<span class="op">=</span><span class="st">'start'</span>, on <span class="op">=</span> <span class="st">'ad_asofdate'</span>)</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>.agg(number_alive_listings<span class="op">=</span>(<span class="st">'number_alive_listings'</span>, <span class="st">'mean'</span>),</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>     mean_price<span class="op">=</span>(<span class="st">'mean_price'</span>, <span class="st">'mean'</span>))</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>.reset_index())</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a><span class="co">#time_series_monthly.first().diff().shift(freq='-1M')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>time_series_listings_1m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_layerid</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">number_alive_listings</th>
<th data-quarto-table-cell-role="th">mean_price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>lay_01</td>
<td>2016-11-30</td>
<td>1.000000</td>
<td>2090.909091</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>lay_01</td>
<td>2016-12-31</td>
<td>1.000000</td>
<td>2090.909091</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>lay_01</td>
<td>2017-01-31</td>
<td>1.000000</td>
<td>2090.909091</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>lay_01</td>
<td>2017-02-28</td>
<td>1.000000</td>
<td>2090.909091</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>lay_01</td>
<td>2017-03-31</td>
<td>1.000000</td>
<td>2090.909091</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1240</td>
<td>lay_19</td>
<td>2022-02-28</td>
<td>32.428571</td>
<td>2570.130553</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1241</td>
<td>lay_19</td>
<td>2022-03-31</td>
<td>48.032258</td>
<td>2730.063624</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1242</td>
<td>lay_19</td>
<td>2022-04-30</td>
<td>48.333333</td>
<td>2732.623782</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1243</td>
<td>lay_19</td>
<td>2022-05-31</td>
<td>41.709677</td>
<td>2758.866441</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1244</td>
<td>lay_19</td>
<td>2022-06-30</td>
<td>38.000000</td>
<td>2778.162122</td>
</tr>
</tbody>
</table>

<p>1245 rows × 4 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(time_series_listings_1m, x<span class="op">=</span><span class="st">"ad_asofdate"</span>, y<span class="op">=</span><span class="st">"mean_price"</span>, color<span class="op">=</span><span class="st">"ad_layerid"</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Monthly average price by district/layer"</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Price €/sqm"</span>)</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>(time_series_listings_1m</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>              .set_index(<span class="st">'ad_asofdate'</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>              .sort_index()</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>              .loc[<span class="st">'2019-12-31'</span>:<span class="st">'2022-06-30'</span>]</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>              .reset_index())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">ad_layerid</th>
<th data-quarto-table-cell-role="th">number_alive_listings</th>
<th data-quarto-table-cell-role="th">mean_price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2019-12-31</td>
<td>lay_18</td>
<td>11.741935</td>
<td>2905.119246</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-12-31</td>
<td>lay_04</td>
<td>34.096774</td>
<td>3795.861990</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2019-12-31</td>
<td>lay_15</td>
<td>12.000000</td>
<td>2214.757704</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2019-12-31</td>
<td>lay_01</td>
<td>32.806452</td>
<td>2523.038426</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2019-12-31</td>
<td>lay_03</td>
<td>42.096774</td>
<td>2401.387040</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">584</td>
<td>2022-06-30</td>
<td>lay_03</td>
<td>173.583333</td>
<td>2616.553782</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">585</td>
<td>2022-06-30</td>
<td>lay_12</td>
<td>74.833333</td>
<td>3290.626250</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">586</td>
<td>2022-06-30</td>
<td>lay_11</td>
<td>82.750000</td>
<td>2667.626467</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">587</td>
<td>2022-06-30</td>
<td>lay_04</td>
<td>113.000000</td>
<td>3810.157687</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">588</td>
<td>2022-06-30</td>
<td>lay_19</td>
<td>38.000000</td>
<td>2778.162122</td>
</tr>
</tbody>
</table>

<p>589 rows × 4 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(time_series_listings_1m</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>              .set_index(<span class="st">'ad_asofdate'</span>)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>              .sort_index()</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>              .loc[<span class="st">'2019-12-31'</span>:<span class="st">'2022-06-30'</span>]</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>              .reset_index(), x<span class="op">=</span><span class="st">"ad_asofdate"</span>, y<span class="op">=</span><span class="st">"mean_price"</span>, color<span class="op">=</span><span class="st">"ad_layerid"</span>)</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Monthly average price by district/layer"</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Price €/sqm"</span>)</span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>Share of flats with decreasing prices / time on market</p>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.datisticsblog.com/2018/08/r2py_pandas/#transform</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="co"># transform() can be used like the group_by() - mutate() combination in R</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/72239394/how-to-transform-columns-with-method-chaining</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>decrease <span class="op">=</span>(time_series_listings</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>            .sort_values([<span class="st">'ad_asofdate'</span>,<span class="st">'ad_id'</span>])</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>            .assign(first_price <span class="op">=</span> <span class="kw">lambda</span> x: x.groupby(<span class="st">'ad_id'</span>)[<span class="st">'ad_unitprice'</span>].transform(<span class="st">'first'</span>),</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>                    first_date <span class="op">=</span> <span class="kw">lambda</span> x: x.groupby(<span class="st">'ad_id'</span>)[<span class="st">'ad_asofdate'</span>].transform(<span class="st">'first'</span>),</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>                    price_variation <span class="op">=</span> <span class="kw">lambda</span> x: x.ad_unitprice <span class="op">/</span> x.first_price <span class="op">-</span><span class="dv">1</span>,</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>                    time_on_market <span class="op">=</span> <span class="kw">lambda</span> x: x.ad_asofdate <span class="op">-</span> x.first_date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>decrease.loc[decrease[<span class="st">'ad_id'</span>] <span class="op">==</span> <span class="st">'0003c7f627ceac5928277fcf60d3e762'</span>,[<span class="st">'ad_id'</span>,<span class="st">'ad_asofdate'</span>,<span class="st">'ad_unitprice'</span>,<span class="st">'first_price'</span>, <span class="st">'price_variation'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">first_price</th>
<th data-quarto-table-cell-role="th">price_variation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>1810.526316</td>
<td>1810.526316</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-21</td>
<td>1810.526316</td>
<td>1810.526316</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-22</td>
<td>1810.526316</td>
<td>1810.526316</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-23</td>
<td>1810.526316</td>
<td>1810.526316</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-24</td>
<td>1810.526316</td>
<td>1810.526316</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">148</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2021-04-17</td>
<td>1736.842105</td>
<td>1810.526316</td>
<td>-0.040698</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">149</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2021-04-18</td>
<td>1736.842105</td>
<td>1810.526316</td>
<td>-0.040698</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">150</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2021-04-19</td>
<td>1736.842105</td>
<td>1810.526316</td>
<td>-0.040698</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">151</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2021-04-20</td>
<td>1736.842105</td>
<td>1810.526316</td>
<td>-0.040698</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">152</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2021-04-21</td>
<td>1736.842105</td>
<td>1810.526316</td>
<td>-0.040698</td>
</tr>
</tbody>
</table>

<p>153 rows × 5 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>decrease.loc[decrease[<span class="st">'price_variation'</span>] <span class="op">&lt;</span> <span class="op">-</span><span class="fl">0.1</span>].sort_values(<span class="st">'price_variation'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_firstlistingdate</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">ad_state</th>
<th data-quarto-table-cell-role="th">ad_operation</th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_propertytype</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">ad_activationdate</th>
<th data-quarto-table-cell-role="th">ad_deactivationdate</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">time_to_modify</th>
<th data-quarto-table-cell-role="th">time_to_lastseen</th>
<th data-quarto-table-cell-role="th">time_to_deactivate</th>
<th data-quarto-table-cell-role="th">price_euro</th>
<th data-quarto-table-cell-role="th">first_price</th>
<th data-quarto-table-cell-role="th">ad_layerid</th>
<th data-quarto-table-cell-role="th">ad_constructionperiod</th>
<th data-quarto-table-cell-role="th">first_date</th>
<th data-quarto-table-cell-role="th">price_variation</th>
<th data-quarto-table-cell-role="th">time_on_market</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1394124</td>
<td>b4939df7c32ed3fbdf0cf1af0d9ee9f7</td>
<td>2021-06-07</td>
<td>2021-07-24</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2021-06-05</td>
<td>2022-02-06</td>
<td>...</td>
<td>42.0</td>
<td>46.0</td>
<td>-1.0</td>
<td>231000.0</td>
<td>4454.545455</td>
<td>lay_01</td>
<td>2020</td>
<td>2021-06-05</td>
<td>-0.999776</td>
<td>49 days</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1394081</td>
<td>b4939df7c32ed3fbdf0cf1af0d9ee9f7</td>
<td>2021-06-07</td>
<td>2021-06-11</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2021-06-05</td>
<td>2022-02-06</td>
<td>...</td>
<td>2.0</td>
<td>4.0</td>
<td>-1.0</td>
<td>231000.0</td>
<td>4454.545455</td>
<td>lay_01</td>
<td>1930</td>
<td>2021-06-05</td>
<td>-0.999776</td>
<td>6 days</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1394103</td>
<td>b4939df7c32ed3fbdf0cf1af0d9ee9f7</td>
<td>2021-06-07</td>
<td>2021-07-03</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2021-06-05</td>
<td>2022-02-06</td>
<td>...</td>
<td>26.0</td>
<td>32.0</td>
<td>-1.0</td>
<td>231000.0</td>
<td>4454.545455</td>
<td>lay_01</td>
<td>2020</td>
<td>2021-06-05</td>
<td>-0.999776</td>
<td>28 days</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1394095</td>
<td>b4939df7c32ed3fbdf0cf1af0d9ee9f7</td>
<td>2021-06-07</td>
<td>2021-06-25</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2021-06-05</td>
<td>2022-02-06</td>
<td>...</td>
<td>18.0</td>
<td>25.0</td>
<td>-1.0</td>
<td>231000.0</td>
<td>4454.545455</td>
<td>lay_01</td>
<td>2020</td>
<td>2021-06-05</td>
<td>-0.999776</td>
<td>20 days</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1394085</td>
<td>b4939df7c32ed3fbdf0cf1af0d9ee9f7</td>
<td>2021-06-07</td>
<td>2021-06-15</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2021-06-05</td>
<td>2022-02-06</td>
<td>...</td>
<td>10.0</td>
<td>11.0</td>
<td>-1.0</td>
<td>231000.0</td>
<td>4454.545455</td>
<td>lay_01</td>
<td>1930</td>
<td>2021-06-05</td>
<td>-0.999776</td>
<td>10 days</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1774064</td>
<td>e53d536c1e326b0c7ce5eb54565b337e</td>
<td>2022-03-15</td>
<td>2022-06-05</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2600.0</td>
<td>2022-03-15</td>
<td>2022-04-27</td>
<td>...</td>
<td>58.0</td>
<td>89.0</td>
<td>-21.0</td>
<td>260000.0</td>
<td>2888.888889</td>
<td>lay_08</td>
<td>1980</td>
<td>2022-03-15</td>
<td>-0.100000</td>
<td>82 days</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1774044</td>
<td>e53d536c1e326b0c7ce5eb54565b337e</td>
<td>2022-03-15</td>
<td>2022-05-16</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2600.0</td>
<td>2022-03-15</td>
<td>2022-04-27</td>
<td>...</td>
<td>58.0</td>
<td>89.0</td>
<td>-21.0</td>
<td>260000.0</td>
<td>2888.888889</td>
<td>lay_08</td>
<td>1980</td>
<td>2022-03-15</td>
<td>-0.100000</td>
<td>62 days</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1774050</td>
<td>e53d536c1e326b0c7ce5eb54565b337e</td>
<td>2022-03-15</td>
<td>2022-05-22</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2600.0</td>
<td>2022-03-15</td>
<td>2022-04-27</td>
<td>...</td>
<td>58.0</td>
<td>89.0</td>
<td>-21.0</td>
<td>260000.0</td>
<td>2888.888889</td>
<td>lay_08</td>
<td>1980</td>
<td>2022-03-15</td>
<td>-0.100000</td>
<td>68 days</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1774040</td>
<td>e53d536c1e326b0c7ce5eb54565b337e</td>
<td>2022-03-15</td>
<td>2022-05-12</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2600.0</td>
<td>2022-03-15</td>
<td>2022-04-27</td>
<td>...</td>
<td>58.0</td>
<td>89.0</td>
<td>-21.0</td>
<td>260000.0</td>
<td>2888.888889</td>
<td>lay_08</td>
<td>1980</td>
<td>2022-03-15</td>
<td>-0.100000</td>
<td>58 days</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1774068</td>
<td>e53d536c1e326b0c7ce5eb54565b337e</td>
<td>2022-03-15</td>
<td>2022-06-09</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2600.0</td>
<td>2022-03-15</td>
<td>2022-04-27</td>
<td>...</td>
<td>58.0</td>
<td>89.0</td>
<td>-21.0</td>
<td>260000.0</td>
<td>2888.888889</td>
<td>lay_08</td>
<td>1980</td>
<td>2022-03-15</td>
<td>-0.100000</td>
<td>86 days</td>
</tr>
</tbody>
</table>

<p>277935 rows × 62 columns</p>
</div>
</div>
</div>
<p>What happens with this one after 29 days? Outlier or listing error? Fire sale?</p>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>decrease.loc[decrease[<span class="st">'ad_id'</span>] <span class="op">==</span> <span class="st">'81c010eb8c51aea4ffd447e980eb3f6b'</span>,[<span class="st">'ad_id'</span>,<span class="st">'ad_asofdate'</span>,<span class="st">'ad_unitprice'</span>,<span class="st">'first_price'</span>, <span class="st">'price_variation'</span>, <span class="st">'time_on_market'</span>, <span class="st">'ad_area'</span>, <span class="st">'ad_builttypename'</span>]]</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="co">#decrease.loc[decrease['ad_id'] == '81c010eb8c51aea4ffd447e980eb3f6b']</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">first_price</th>
<th data-quarto-table-cell-role="th">price_variation</th>
<th data-quarto-table-cell-role="th">time_on_market</th>
<th data-quarto-table-cell-role="th">ad_area</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">999799</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-12</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>0 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999800</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-13</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>1 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999801</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-14</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>2 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999802</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-15</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>3 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999803</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-16</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>4 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999804</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-17</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>5 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999805</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-18</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>6 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999806</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-19</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>7 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999807</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-20</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>8 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999808</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-21</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>9 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999809</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-22</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>10 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999810</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-23</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>11 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999811</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-24</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>12 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999812</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-25</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>13 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999813</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-26</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>14 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999814</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-27</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>15 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999815</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-28</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>16 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999816</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-29</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>17 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999817</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-30</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>18 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999818</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-10-31</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>19 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999819</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-11-01</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>20 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999820</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-11-02</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>21 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999821</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-11-03</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>22 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999822</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-11-04</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>23 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999823</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-11-05</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>24 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999824</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-11-06</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>25 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999825</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-11-07</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>26 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999826</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-11-08</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>27 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999827</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-11-09</td>
<td>4900.0</td>
<td>4900.0</td>
<td>0.000000</td>
<td>28 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999828</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-11-10</td>
<td>2580.0</td>
<td>4900.0</td>
<td>-0.473469</td>
<td>29 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999829</td>
<td>81c010eb8c51aea4ffd447e980eb3f6b</td>
<td>2020-11-11</td>
<td>2580.0</td>
<td>4900.0</td>
<td>-0.473469</td>
<td>30 days</td>
<td>50.0</td>
<td>not-renovated</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>decrease.loc[decrease[<span class="st">'ad_id'</span>] <span class="op">==</span> <span class="st">'0003c7f627ceac5928277fcf60d3e762'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_firstlistingdate</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">ad_state</th>
<th data-quarto-table-cell-role="th">ad_operation</th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_propertytype</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">ad_activationdate</th>
<th data-quarto-table-cell-role="th">ad_deactivationdate</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">time_to_modify</th>
<th data-quarto-table-cell-role="th">time_to_lastseen</th>
<th data-quarto-table-cell-role="th">time_to_deactivate</th>
<th data-quarto-table-cell-role="th">price_euro</th>
<th data-quarto-table-cell-role="th">first_price</th>
<th data-quarto-table-cell-role="th">ad_layerid</th>
<th data-quarto-table-cell-role="th">ad_constructionperiod</th>
<th data-quarto-table-cell-role="th">first_date</th>
<th data-quarto-table-cell-role="th">price_variation</th>
<th data-quarto-table-cell-role="th">time_on_market</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-20</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1810.526316</td>
<td>2020-11-20</td>
<td>NaT</td>
<td>...</td>
<td>0.0</td>
<td>54.0</td>
<td>NaN</td>
<td>172000.0</td>
<td>1810.526316</td>
<td>lay_12</td>
<td>Unknown</td>
<td>2020-11-20</td>
<td>0.000000</td>
<td>0 days</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-21</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1810.526316</td>
<td>2020-11-20</td>
<td>NaT</td>
<td>...</td>
<td>0.0</td>
<td>54.0</td>
<td>NaN</td>
<td>172000.0</td>
<td>1810.526316</td>
<td>lay_12</td>
<td>Unknown</td>
<td>2020-11-20</td>
<td>0.000000</td>
<td>1 days</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-22</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1810.526316</td>
<td>2020-11-20</td>
<td>NaT</td>
<td>...</td>
<td>0.0</td>
<td>54.0</td>
<td>NaN</td>
<td>172000.0</td>
<td>1810.526316</td>
<td>lay_12</td>
<td>Unknown</td>
<td>2020-11-20</td>
<td>0.000000</td>
<td>2 days</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-23</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1810.526316</td>
<td>2020-11-20</td>
<td>NaT</td>
<td>...</td>
<td>0.0</td>
<td>54.0</td>
<td>NaN</td>
<td>172000.0</td>
<td>1810.526316</td>
<td>lay_12</td>
<td>Unknown</td>
<td>2020-11-20</td>
<td>0.000000</td>
<td>3 days</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2020-11-24</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1810.526316</td>
<td>2020-11-20</td>
<td>NaT</td>
<td>...</td>
<td>0.0</td>
<td>54.0</td>
<td>NaN</td>
<td>172000.0</td>
<td>1810.526316</td>
<td>lay_12</td>
<td>Unknown</td>
<td>2020-11-20</td>
<td>0.000000</td>
<td>4 days</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">148</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2021-04-17</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1736.842105</td>
<td>2020-11-20</td>
<td>NaT</td>
<td>...</td>
<td>55.0</td>
<td>103.0</td>
<td>NaN</td>
<td>165000.0</td>
<td>1810.526316</td>
<td>lay_12</td>
<td>Unknown</td>
<td>2020-11-20</td>
<td>-0.040698</td>
<td>148 days</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">149</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2021-04-18</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1736.842105</td>
<td>2020-11-20</td>
<td>NaT</td>
<td>...</td>
<td>55.0</td>
<td>103.0</td>
<td>NaN</td>
<td>165000.0</td>
<td>1810.526316</td>
<td>lay_12</td>
<td>Unknown</td>
<td>2020-11-20</td>
<td>-0.040698</td>
<td>149 days</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">150</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2021-04-19</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1736.842105</td>
<td>2020-11-20</td>
<td>NaT</td>
<td>...</td>
<td>55.0</td>
<td>103.0</td>
<td>NaN</td>
<td>165000.0</td>
<td>1810.526316</td>
<td>lay_12</td>
<td>Unknown</td>
<td>2020-11-20</td>
<td>-0.040698</td>
<td>150 days</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">151</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2021-04-20</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1736.842105</td>
<td>2021-04-20</td>
<td>2021-03-09</td>
<td>...</td>
<td>0.0</td>
<td>1.0</td>
<td>-42.0</td>
<td>165000.0</td>
<td>1810.526316</td>
<td>lay_12</td>
<td>Unknown</td>
<td>2020-11-20</td>
<td>-0.040698</td>
<td>151 days</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">152</td>
<td>0003c7f627ceac5928277fcf60d3e762</td>
<td>2020-11-20</td>
<td>2021-04-21</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1736.842105</td>
<td>2021-04-20</td>
<td>2021-03-09</td>
<td>...</td>
<td>0.0</td>
<td>1.0</td>
<td>-42.0</td>
<td>165000.0</td>
<td>1810.526316</td>
<td>lay_12</td>
<td>Unknown</td>
<td>2020-11-20</td>
<td>-0.040698</td>
<td>152 days</td>
</tr>
</tbody>
</table>

<p>153 rows × 62 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>df6 <span class="op">=</span> (decrease</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>        .assign(n_decrease <span class="op">=</span> <span class="kw">lambda</span> x: x.groupby(<span class="st">'ad_asofdate'</span>)[<span class="st">'price_variation'</span>].transform(<span class="kw">lambda</span> v: v[v<span class="op">&lt;</span> <span class="fl">0.0</span>].count()),</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>                mean_decrease <span class="op">=</span> <span class="kw">lambda</span> x: x.groupby(<span class="st">'ad_asofdate'</span>)[<span class="st">'price_variation'</span>].transform(<span class="kw">lambda</span> v: v[v<span class="op">&lt;</span> <span class="fl">0.0</span>].mean()),</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>                n <span class="op">=</span> <span class="kw">lambda</span> x: x.groupby(<span class="st">'ad_asofdate'</span>)[<span class="st">'price_variation'</span>].transform(<span class="st">'size'</span>),</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>                share_decrease <span class="op">=</span> <span class="kw">lambda</span> x: x.n_decrease<span class="op">/</span>x.n))</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking - OK</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>(df6</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>.query(<span class="st">'20191231 &lt; ad_asofdate &lt; 20220630'</span>) <span class="co"># alternative to reseting index and .loc['2019-12-31':'2022-06-30']</span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>.loc[<span class="kw">lambda</span> x: x.price_variation<span class="op">&lt;</span><span class="dv">0</span>]</span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>.agg(number<span class="op">=</span>(<span class="st">'price_variation'</span>, <span class="st">'size'</span>),</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>     mean<span class="op">=</span>(<span class="st">'price_variation'</span>, <span class="st">'mean'</span>)))</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>(df6</span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>.query(<span class="st">'20191231 &lt; ad_asofdate &lt; 20220630'</span>)</span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>.loc[<span class="kw">lambda</span> x: x.price_variation<span class="op">&lt;</span><span class="dv">0</span>,[<span class="st">'ad_id'</span>, <span class="st">'ad_asofdate'</span>, <span class="st">'price_variation'</span>, <span class="st">'n_decrease'</span>, <span class="st">'mean_decrease'</span>, <span class="st">'n'</span>, <span class="st">'share_decrease'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">price_variation</th>
<th data-quarto-table-cell-role="th">n_decrease</th>
<th data-quarto-table-cell-role="th">mean_decrease</th>
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th">share_decrease</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">163462</td>
<td>1571c59217085e501e311c1beaba1f40</td>
<td>2020-01-01</td>
<td>-0.448844</td>
<td>48</td>
<td>-0.302442</td>
<td>470</td>
<td>0.102128</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">185959</td>
<td>1864523c1820b306be0a125d3235562b</td>
<td>2020-01-01</td>
<td>-0.254087</td>
<td>48</td>
<td>-0.302442</td>
<td>470</td>
<td>0.102128</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">197205</td>
<td>1a123c1988f64f39b3d0fac385d378aa</td>
<td>2020-01-01</td>
<td>-0.453513</td>
<td>48</td>
<td>-0.302442</td>
<td>470</td>
<td>0.102128</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">246538</td>
<td>2167c11606cb56b52a1c52c72a4774d0</td>
<td>2020-01-01</td>
<td>-0.191388</td>
<td>48</td>
<td>-0.302442</td>
<td>470</td>
<td>0.102128</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">248541</td>
<td>219c7c590c48a6d98598872d61e53103</td>
<td>2020-01-01</td>
<td>-0.654837</td>
<td>48</td>
<td>-0.302442</td>
<td>470</td>
<td>0.102128</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1931699</td>
<td>f9d4d45b3d5600e78e16d5c4b37fbc38</td>
<td>2022-06-12</td>
<td>-0.181416</td>
<td>417</td>
<td>-0.133443</td>
<td>2181</td>
<td>0.191197</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1932629</td>
<td>f9ebcad613e0321e656e223533a2b934</td>
<td>2022-06-12</td>
<td>-0.066890</td>
<td>417</td>
<td>-0.133443</td>
<td>2181</td>
<td>0.191197</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1954766</td>
<td>fccec648e7e8858d8921513a186fce0b</td>
<td>2022-06-12</td>
<td>-0.062626</td>
<td>417</td>
<td>-0.133443</td>
<td>2181</td>
<td>0.191197</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1960515</td>
<td>fda870d0fdebb06b7fee610934436b64</td>
<td>2022-06-12</td>
<td>-0.241201</td>
<td>417</td>
<td>-0.133443</td>
<td>2181</td>
<td>0.191197</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1971756</td>
<td>ff8acfe6e9cde7f37992c81bc839b484</td>
<td>2022-06-12</td>
<td>-0.097264</td>
<td>417</td>
<td>-0.133443</td>
<td>2181</td>
<td>0.191197</td>
</tr>
</tbody>
</table>

<p>421896 rows × 7 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>df7 <span class="op">=</span> (decrease</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>        .groupby(<span class="st">'ad_asofdate'</span>)[<span class="st">'price_variation'</span>]</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>        .agg([(<span class="st">'n_decrease'</span>, <span class="kw">lambda</span> x: x[x<span class="op">&lt;</span> <span class="fl">0.0</span>].count()),</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>              (<span class="st">'n'</span>, np.size),</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>              (<span class="st">'mean_decrease'</span>, <span class="kw">lambda</span> x: x[x<span class="op">&lt;</span> <span class="fl">0.0</span>].mean())])</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>      .reset_index()</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>      .assign(share_decrease <span class="op">=</span> <span class="kw">lambda</span> x: x.n_decrease<span class="op">/</span>x.n,</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>              n_stable <span class="op">=</span> <span class="kw">lambda</span> x: x.n<span class="op">-</span>x.n_decrease ))</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>(df7</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>.query(<span class="st">'20191231 &lt; ad_asofdate &lt; 20220630'</span>))</span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>              </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">n_decrease</th>
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th">mean_decrease</th>
<th data-quarto-table-cell-role="th">share_decrease</th>
<th data-quarto-table-cell-role="th">n_stable</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1514</td>
<td>2020-01-01</td>
<td>48</td>
<td>470</td>
<td>-0.302442</td>
<td>0.102128</td>
<td>422</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1515</td>
<td>2020-01-02</td>
<td>49</td>
<td>472</td>
<td>-0.297677</td>
<td>0.103814</td>
<td>423</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1516</td>
<td>2020-01-03</td>
<td>49</td>
<td>472</td>
<td>-0.297677</td>
<td>0.103814</td>
<td>423</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1517</td>
<td>2020-01-04</td>
<td>49</td>
<td>472</td>
<td>-0.297677</td>
<td>0.103814</td>
<td>423</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1518</td>
<td>2020-01-05</td>
<td>49</td>
<td>472</td>
<td>-0.297677</td>
<td>0.103814</td>
<td>423</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2403</td>
<td>2022-06-08</td>
<td>429</td>
<td>2217</td>
<td>-0.134695</td>
<td>0.193505</td>
<td>1788</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2404</td>
<td>2022-06-09</td>
<td>419</td>
<td>2217</td>
<td>-0.135046</td>
<td>0.188994</td>
<td>1798</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2405</td>
<td>2022-06-10</td>
<td>421</td>
<td>2235</td>
<td>-0.133466</td>
<td>0.188367</td>
<td>1814</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2406</td>
<td>2022-06-11</td>
<td>417</td>
<td>2181</td>
<td>-0.133443</td>
<td>0.191197</td>
<td>1764</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2407</td>
<td>2022-06-12</td>
<td>417</td>
<td>2181</td>
<td>-0.133443</td>
<td>0.191197</td>
<td>1764</td>
</tr>
</tbody>
</table>

<p>894 rows × 6 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>df8<span class="op">=</span>df7.query(<span class="st">'20191231 &lt; ad_asofdate &lt; 20220630'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>df8bis <span class="op">=</span> (decrease</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>.assign(time_on_market <span class="op">=</span> <span class="kw">lambda</span> x: x.time_on_market<span class="op">/</span>timedelta(days<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>.groupby(<span class="st">'ad_asofdate'</span>)</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>.agg(time_on_market<span class="op">=</span>(<span class="st">'time_on_market'</span>, <span class="st">'mean'</span>))</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>.reset_index()</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>.query(<span class="st">'20191231 &lt; ad_asofdate &lt; 20220630'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> make_subplots(specs<span class="op">=</span>[[{<span class="st">"secondary_y"</span>: <span class="va">True</span>}]])</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Add traces</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Scatter(</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>df8.ad_asofdate, y<span class="op">=</span>df8.n_decrease, name<span class="op">=</span><span class="st">"Price decreased"</span>,</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>    hoverinfo<span class="op">=</span><span class="st">'x+y'</span>,</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">'lines'</span>,</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(width<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'rgb(131, 90, 241)'</span>),</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>    stackgroup<span class="op">=</span><span class="st">'one'</span>), </span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>    secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Scatter(</span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>df8.ad_asofdate, y<span class="op">=</span>df8.n_stable, name<span class="op">=</span><span class="st">"Price stable (or increased)"</span>,</span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>    hoverinfo<span class="op">=</span><span class="st">'x+y'</span>,</span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">'lines'</span>,</span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(width<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'rgb(184, 247, 212)'</span>),</span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>    stackgroup<span class="op">=</span><span class="st">'one'</span>), </span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a>    secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a>    go.Scatter(x<span class="op">=</span>df8bis.ad_asofdate, y<span class="op">=</span>df8bis.time_on_market, name<span class="op">=</span><span class="st">"Time since first listing"</span>, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'rgb(131, 90, 241)'</span>)),</span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a>    secondary_y<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-24"><a href="#cb130-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb130-25"><a href="#cb130-25" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb130-26"><a href="#cb130-26" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Time on market"</span></span>
<span id="cb130-27"><a href="#cb130-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb130-28"><a href="#cb130-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-29"><a href="#cb130-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb130-30"><a href="#cb130-30" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb130-31"><a href="#cb130-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-32"><a href="#cb130-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb130-33"><a href="#cb130-33" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Number of outstanding listings"</span>, secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb130-34"><a href="#cb130-34" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Average time since first listing (in days)"</span>, secondary_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb130-35"><a href="#cb130-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-36"><a href="#cb130-36" aria-hidden="true" tabindex="-1"></a><span class="co"># plotly manual axis adjustments</span></span>
<span id="cb130-37"><a href="#cb130-37" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>,<span class="dv">3000</span>], secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb130-38"><a href="#cb130-38" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>,<span class="dv">300</span>], secondary_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb130-39"><a href="#cb130-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-40"><a href="#cb130-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-41"><a href="#cb130-41" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>df8tris <span class="op">=</span> (time_series_listings_daily</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>        .query(<span class="st">'20191231 &lt; ad_asofdate &lt; 20220630'</span>))</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> make_subplots(specs<span class="op">=</span>[[{<span class="st">"secondary_y"</span>: <span class="va">True</span>}]])</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add traces</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>    go.Scatter(x<span class="op">=</span>df8tris.ad_asofdate, y<span class="op">=</span>df8tris.mean_price, name<span class="op">=</span><span class="st">"Prices"</span>, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'rgb(111, 231, 219)'</span>)),</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>    secondary_y<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>    go.Scatter(x<span class="op">=</span>df8bis.ad_asofdate, y<span class="op">=</span>df8bis.time_on_market, name<span class="op">=</span><span class="st">"Time since first listing"</span>, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'rgb(131, 90, 241)'</span>)),</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>    secondary_y<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Time on market vs Price"</span></span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Average price (€/sqm)"</span>, secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Average time since first listing (in days)"</span>, secondary_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb133-27"><a href="#cb133-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-28"><a href="#cb133-28" aria-hidden="true" tabindex="-1"></a><span class="co"># plotly manual axis adjustments</span></span>
<span id="cb133-29"><a href="#cb133-29" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">2500</span>,<span class="dv">4000</span>], secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb133-30"><a href="#cb133-30" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>,<span class="dv">260</span>], secondary_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb133-31"><a href="#cb133-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-32"><a href="#cb133-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-33"><a href="#cb133-33" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>df9 <span class="op">=</span> (decrease</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'ad_asofdate'</span>,<span class="st">'ad_layerid'</span>])[<span class="st">'price_variation'</span>]</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>        .agg([(<span class="st">'n_decrease'</span>, <span class="kw">lambda</span> x: x[x<span class="op">&lt;</span> <span class="fl">0.0</span>].count()),</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>              (<span class="st">'n'</span>, np.size),</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>              (<span class="st">'mean_decrease'</span>, <span class="kw">lambda</span> x: x[x<span class="op">&lt;</span> <span class="fl">0.0</span>].mean())])</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>        .assign(share_decrease <span class="op">=</span> <span class="kw">lambda</span> x: x.n_decrease<span class="op">/</span>x.n,</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>              n_stable <span class="op">=</span> <span class="kw">lambda</span> x: x.n<span class="op">-</span>x.n_decrease ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>df10 <span class="op">=</span> (decrease</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'ad_asofdate'</span>,<span class="st">'ad_layerid'</span>])</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>        .agg(mean_price<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'mean'</span>))</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>        .reset_index())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>df9 <span class="op">=</span> (df9.merge(df10, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'ad_asofdate'</span>, <span class="st">'ad_layerid'</span>]))</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>df9</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">ad_layerid</th>
<th data-quarto-table-cell-role="th">n_decrease</th>
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th">mean_decrease</th>
<th data-quarto-table-cell-role="th">share_decrease</th>
<th data-quarto-table-cell-role="th">n_stable</th>
<th data-quarto-table-cell-role="th">mean_price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2015-11-09</td>
<td>lay_18</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>0.000000</td>
<td>1</td>
<td>3055.555556</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2015-11-10</td>
<td>lay_18</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>0.000000</td>
<td>1</td>
<td>3055.555556</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2015-11-11</td>
<td>lay_13</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>0.000000</td>
<td>1</td>
<td>4402.985075</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2015-11-11</td>
<td>lay_14</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>0.000000</td>
<td>1</td>
<td>3974.358974</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2015-11-11</td>
<td>lay_18</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>0.000000</td>
<td>1</td>
<td>3055.555556</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36946</td>
<td>2022-06-12</td>
<td>lay_15</td>
<td>18</td>
<td>95</td>
<td>-0.156824</td>
<td>0.189474</td>
<td>77</td>
<td>2663.431660</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36947</td>
<td>2022-06-12</td>
<td>lay_16</td>
<td>9</td>
<td>46</td>
<td>-0.130463</td>
<td>0.195652</td>
<td>37</td>
<td>4016.725063</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36948</td>
<td>2022-06-12</td>
<td>lay_17</td>
<td>10</td>
<td>59</td>
<td>-0.119208</td>
<td>0.169492</td>
<td>49</td>
<td>3009.996472</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36949</td>
<td>2022-06-12</td>
<td>lay_18</td>
<td>13</td>
<td>53</td>
<td>-0.113768</td>
<td>0.245283</td>
<td>40</td>
<td>2999.203479</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36950</td>
<td>2022-06-12</td>
<td>lay_19</td>
<td>10</td>
<td>44</td>
<td>-0.214134</td>
<td>0.227273</td>
<td>34</td>
<td>2781.865570</td>
</tr>
</tbody>
</table>

<p>36951 rows × 8 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>df9.query(<span class="st">'ad_asofdate == 20220531'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_asofdate</th>
<th data-quarto-table-cell-role="th">ad_layerid</th>
<th data-quarto-table-cell-role="th">n_decrease</th>
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th">mean_decrease</th>
<th data-quarto-table-cell-role="th">share_decrease</th>
<th data-quarto-table-cell-role="th">n_stable</th>
<th data-quarto-table-cell-role="th">mean_price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">36704</td>
<td>2022-05-31</td>
<td>lay_01</td>
<td>32</td>
<td>151</td>
<td>-0.166002</td>
<td>0.211921</td>
<td>119</td>
<td>2981.428220</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36705</td>
<td>2022-05-31</td>
<td>lay_02</td>
<td>19</td>
<td>119</td>
<td>-0.118926</td>
<td>0.159664</td>
<td>100</td>
<td>3038.822701</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36706</td>
<td>2022-05-31</td>
<td>lay_03</td>
<td>48</td>
<td>221</td>
<td>-0.181075</td>
<td>0.217195</td>
<td>173</td>
<td>2621.811968</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36707</td>
<td>2022-05-31</td>
<td>lay_04</td>
<td>26</td>
<td>131</td>
<td>-0.092641</td>
<td>0.198473</td>
<td>105</td>
<td>3823.751870</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36708</td>
<td>2022-05-31</td>
<td>lay_05</td>
<td>29</td>
<td>133</td>
<td>-0.165457</td>
<td>0.218045</td>
<td>104</td>
<td>3510.184832</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36709</td>
<td>2022-05-31</td>
<td>lay_06</td>
<td>34</td>
<td>169</td>
<td>-0.146116</td>
<td>0.201183</td>
<td>135</td>
<td>3132.816193</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36710</td>
<td>2022-05-31</td>
<td>lay_07</td>
<td>30</td>
<td>186</td>
<td>-0.108998</td>
<td>0.161290</td>
<td>156</td>
<td>4238.310866</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36711</td>
<td>2022-05-31</td>
<td>lay_08</td>
<td>30</td>
<td>189</td>
<td>-0.112372</td>
<td>0.158730</td>
<td>159</td>
<td>3183.766058</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36712</td>
<td>2022-05-31</td>
<td>lay_09</td>
<td>30</td>
<td>107</td>
<td>-0.124656</td>
<td>0.280374</td>
<td>77</td>
<td>3675.859231</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36713</td>
<td>2022-05-31</td>
<td>lay_10</td>
<td>22</td>
<td>116</td>
<td>-0.079526</td>
<td>0.189655</td>
<td>94</td>
<td>4519.076553</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36714</td>
<td>2022-05-31</td>
<td>lay_11</td>
<td>20</td>
<td>102</td>
<td>-0.208849</td>
<td>0.196078</td>
<td>82</td>
<td>2650.961946</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36715</td>
<td>2022-05-31</td>
<td>lay_12</td>
<td>25</td>
<td>103</td>
<td>-0.117796</td>
<td>0.242718</td>
<td>78</td>
<td>3306.755861</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36716</td>
<td>2022-05-31</td>
<td>lay_13</td>
<td>12</td>
<td>94</td>
<td>-0.141593</td>
<td>0.127660</td>
<td>82</td>
<td>4170.425487</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36717</td>
<td>2022-05-31</td>
<td>lay_14</td>
<td>22</td>
<td>68</td>
<td>-0.115268</td>
<td>0.323529</td>
<td>46</td>
<td>3068.740717</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36718</td>
<td>2022-05-31</td>
<td>lay_15</td>
<td>18</td>
<td>87</td>
<td>-0.185463</td>
<td>0.206897</td>
<td>69</td>
<td>2796.022062</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36719</td>
<td>2022-05-31</td>
<td>lay_16</td>
<td>10</td>
<td>45</td>
<td>-0.127585</td>
<td>0.222222</td>
<td>35</td>
<td>3698.043535</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36720</td>
<td>2022-05-31</td>
<td>lay_17</td>
<td>9</td>
<td>56</td>
<td>-0.127824</td>
<td>0.160714</td>
<td>47</td>
<td>2994.674111</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36721</td>
<td>2022-05-31</td>
<td>lay_18</td>
<td>12</td>
<td>54</td>
<td>-0.122852</td>
<td>0.222222</td>
<td>42</td>
<td>3017.857596</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36722</td>
<td>2022-05-31</td>
<td>lay_19</td>
<td>10</td>
<td>46</td>
<td>-0.214134</td>
<td>0.217391</td>
<td>36</td>
<td>2781.707376</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>df9bis<span class="op">=</span>df9.query(<span class="st">'ad_asofdate == 20220531'</span>)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>df9bis.style.<span class="bu">format</span>({<span class="st">'mean_price'</span>: <span class="st">"</span><span class="sc">{:.0f}</span><span class="st">"</span>,<span class="st">'mean_decrease'</span>: <span class="st">"</span><span class="sc">{:.2%}</span><span class="st">"</span>})</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> make_subplots(specs<span class="op">=</span>[[{<span class="st">"secondary_y"</span>: <span class="va">True</span>}]])</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add traces</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Bar(</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>df9bis.ad_layerid, y<span class="op">=</span>df9bis.n_decrease, name<span class="op">=</span><span class="st">"Price decreased"</span>,</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#markercolor='rgb(131, 90, 241)'), </span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>    secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Bar(</span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>df9bis.ad_layerid, y<span class="op">=</span>df9bis.n_stable, name<span class="op">=</span><span class="st">"Price stable (or increased)"</span>,</span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#markercolor='rgb(131, 90, 241)'), </span></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>    ),      </span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>    secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>fig.update_layout(barmode<span class="op">=</span><span class="st">'stack'</span>) </span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a>    go.Scatter(x<span class="op">=</span>df9bis.ad_layerid, y<span class="op">=</span>df9bis.mean_price, name<span class="op">=</span><span class="st">"Average price and decrease"</span>, mode<span class="op">=</span><span class="st">'markers+text'</span>, hovertemplate <span class="op">=</span> <span class="st">'Price: &amp;#8364;%</span><span class="sc">{y:.0f}</span><span class="st">&lt;extra&gt;&lt;/extra&gt;'</span>,</span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a>    marker <span class="op">=</span> <span class="bu">dict</span>(line <span class="op">=</span> <span class="bu">dict</span>(color<span class="op">=</span><span class="st">'rgb(131, 90, 241)'</span>, width <span class="op">=</span> <span class="dv">2</span>)), text<span class="op">=</span>df9bis.mean_decrease, textposition<span class="op">=</span><span class="st">"top center"</span>, texttemplate <span class="op">=</span> <span class="st">"%</span><span class="sc">{text:.1%}</span><span class="st">"</span>,),</span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a>    secondary_y<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb140-28"><a href="#cb140-28" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb140-29"><a href="#cb140-29" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"By district/layer: Share of listings with price decrease / Average price decrease / Average price"</span></span>
<span id="cb140-30"><a href="#cb140-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb140-31"><a href="#cb140-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-32"><a href="#cb140-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb140-33"><a href="#cb140-33" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb140-34"><a href="#cb140-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-35"><a href="#cb140-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb140-36"><a href="#cb140-36" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Number of outstanding listings"</span>, secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb140-37"><a href="#cb140-37" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Average price (€/sqm)"</span>, secondary_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb140-38"><a href="#cb140-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-39"><a href="#cb140-39" aria-hidden="true" tabindex="-1"></a><span class="co"># plotly manual axis adjustments</span></span>
<span id="cb140-40"><a href="#cb140-40" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>,<span class="dv">250</span>], secondary_y<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb140-41"><a href="#cb140-41" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">2500</span>,<span class="dv">5000</span>], secondary_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb140-42"><a href="#cb140-42" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.layout.yaxis2.tickformat = ',.0%'</span></span>
<span id="cb140-43"><a href="#cb140-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-44"><a href="#cb140-44" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>eo_may_listings<span class="op">=</span>(time_series_listings</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>.query(<span class="st">'ad_asofdate == 20220531'</span>)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>df11<span class="op">=</span>(eo_may_listings</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>     .groupby(<span class="st">'ad_layerid'</span>)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>     .agg(n_listings<span class="op">=</span>(<span class="st">'ad_id'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>          layer_area<span class="op">=</span>(<span class="st">'layerlocation_area'</span>, <span class="st">'mean'</span>),</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>          layer_population<span class="op">=</span>(<span class="st">'layerlocation_population'</span>, <span class="st">'mean'</span>),</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>          price<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'mean'</span>))</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>     .reset_index())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>df11</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_layerid</th>
<th data-quarto-table-cell-role="th">n_listings</th>
<th data-quarto-table-cell-role="th">layer_area</th>
<th data-quarto-table-cell-role="th">layer_population</th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>lay_01</td>
<td>151</td>
<td>0.051757</td>
<td>0.0</td>
<td>2981.428220</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>lay_02</td>
<td>119</td>
<td>0.060208</td>
<td>0.0</td>
<td>3038.822701</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>lay_03</td>
<td>221</td>
<td>0.273084</td>
<td>0.0</td>
<td>2621.811968</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>lay_04</td>
<td>131</td>
<td>0.011078</td>
<td>0.0</td>
<td>3823.751870</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>lay_05</td>
<td>133</td>
<td>0.028192</td>
<td>0.0</td>
<td>3510.184832</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>lay_06</td>
<td>169</td>
<td>0.036509</td>
<td>0.0</td>
<td>3132.816193</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>lay_07</td>
<td>186</td>
<td>0.014402</td>
<td>0.0</td>
<td>4238.310866</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>lay_08</td>
<td>189</td>
<td>0.061194</td>
<td>0.0</td>
<td>3183.766058</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>lay_09</td>
<td>107</td>
<td>0.112154</td>
<td>0.0</td>
<td>3675.859231</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>lay_10</td>
<td>116</td>
<td>0.011687</td>
<td>0.0</td>
<td>4519.076553</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>lay_11</td>
<td>102</td>
<td>0.161789</td>
<td>0.0</td>
<td>2650.961946</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>lay_12</td>
<td>103</td>
<td>0.020256</td>
<td>0.0</td>
<td>3306.755861</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>lay_13</td>
<td>94</td>
<td>0.009991</td>
<td>0.0</td>
<td>4170.425487</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>lay_14</td>
<td>68</td>
<td>0.027910</td>
<td>0.0</td>
<td>3068.740717</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>lay_15</td>
<td>87</td>
<td>0.103422</td>
<td>0.0</td>
<td>2796.022062</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>lay_16</td>
<td>45</td>
<td>0.262331</td>
<td>0.0</td>
<td>3698.043535</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>lay_17</td>
<td>56</td>
<td>0.116143</td>
<td>0.0</td>
<td>2994.674111</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>lay_18</td>
<td>54</td>
<td>0.034814</td>
<td>0.0</td>
<td>3017.857596</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>lay_19</td>
<td>46</td>
<td>0.077228</td>
<td>0.0</td>
<td>2781.707376</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Bologna anonymized zones (layerlocation) have been renamed and ordered in terms of number of listings, lay_01 is the layer with the higher # of lisitngs etc.</p>
<p>We plot here a visualization of Bologna zones showing the average price of listings as of end of May 2022, the surface representing the surface of the layer, the color the average price (Red being the higher priced listings).</p>
<p>We can guess from this vizualization that some higher-end and tiny districts (in the center?) price higher than bigger residential districts (peripheral?). Although we would need shapefiles and census data (which are missing in the provided data) to confirm and enhance analysis.</p>
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>name_layers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_layerlocation</th>
<th data-quarto-table-cell-role="th">ad_layerid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>85ea9cbc768010f730bc474da4a253da</td>
<td>lay_01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>46f3699d96a59f9e2bba52d52b74315f</td>
<td>lay_02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>df7ce39f801ce4de8d05cd243dd7f5d7</td>
<td>lay_03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>a3c47f8c8202d15ff4aeff6102adc107</td>
<td>lay_04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>72fba7c6c57ed8519627ff3b45b712be</td>
<td>lay_05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>bed4247ad695180b20040d14b25af551</td>
<td>lay_06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>408edd8f9b5a1e0b8110093fbf261780</td>
<td>lay_07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>5f8908f23709d384f8955c831f6b204e</td>
<td>lay_08</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>319ff21efb401d5c564b88917df71817</td>
<td>lay_09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>52cd50eede0d8d599447eecf578fe2d6</td>
<td>lay_10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>96c63b3a47c2ac51cd191ce61ff32e62</td>
<td>lay_11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>3d17a7e664b3bdb02e542e1301e4c5fd</td>
<td>lay_12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>566970b69cb9ece6ec78ef729a24da67</td>
<td>lay_13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2980880cab17cd30f699235c2a2b74d8</td>
<td>lay_14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>79ae74c58af1dfb4d92181f8574a020f</td>
<td>lay_15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>2b6ad9c422f1dd2cab3c76ea8180a1f0</td>
<td>lay_16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>30907c9787a9f0abb95882f115ff1cec</td>
<td>lay_17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>01325f6317e14398244811321639fb91</td>
<td>lay_18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>c0ff13b213e1e7e1947e52afe9b9d68b</td>
<td>lay_19</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Showing a price map per district/layer with size depending on layer area (end of May 2022)</p>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.treemap(df11, path<span class="op">=</span>[px.Constant(<span class="st">"Bologna"</span>), <span class="st">'ad_layerid'</span>], values<span class="op">=</span><span class="st">'layer_area'</span>, hover_data<span class="op">=</span>{<span class="st">'layer_area'</span>:<span class="st">':.2f'</span>,<span class="st">'price'</span>:<span class="st">':.0f'</span>},</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span><span class="st">'price'</span>, <span class="co">#hover_data=['ad_layerid'],</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>                  color_continuous_scale<span class="op">=</span><span class="st">'RdBu_r'</span>,</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>                  color_continuous_midpoint<span class="op">=</span>np.average(df11[<span class="st">'price'</span>], weights<span class="op">=</span>df11[<span class="st">'layer_area'</span>]))</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>fig.update_layout(margin <span class="op">=</span> <span class="bu">dict</span>(t<span class="op">=</span><span class="dv">50</span>, l<span class="op">=</span><span class="dv">25</span>, r<span class="op">=</span><span class="dv">25</span>, b<span class="op">=</span><span class="dv">25</span>))</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>Showing a price map per district/layer-&gt;builttype with size depending on number of listing alive (end of May 2022)</p>
<div class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>df12<span class="op">=</span>(eo_may_listings</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>       .assign(property_value <span class="op">=</span> <span class="kw">lambda</span> x: x.ad_area<span class="op">*</span>x.ad_unitprice)</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>       .groupby([<span class="st">'ad_layerid'</span>,<span class="st">'ad_builttypename'</span>])</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>       .agg(n_listings<span class="op">=</span>(<span class="st">'ad_id'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>            layer_area<span class="op">=</span>(<span class="st">'layerlocation_area'</span>, <span class="st">'mean'</span>),</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>            layer_population<span class="op">=</span>(<span class="st">'layerlocation_population'</span>, <span class="st">'mean'</span>),</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>            price<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'mean'</span>),</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>            property_value<span class="op">=</span>(<span class="st">'property_value'</span>, <span class="st">'sum'</span>))</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>            .reset_index())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.treemap(df12, path<span class="op">=</span>[px.Constant(<span class="st">"Bologna"</span>), <span class="st">'ad_layerid'</span>], values<span class="op">=</span><span class="st">'property_value'</span>, hover_data<span class="op">=</span>{<span class="st">'property_value'</span>:<span class="st">':.2f'</span>,<span class="st">'price'</span>:<span class="st">':.0f'</span>},</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span><span class="st">'price'</span>, <span class="co">#hover_data=['ad_layerid'],</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>                  color_continuous_scale<span class="op">=</span><span class="st">'RdBu_r'</span>,</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>                  color_continuous_midpoint<span class="op">=</span>np.average(df12[<span class="st">'price'</span>], weights<span class="op">=</span>df12[<span class="st">'property_value'</span>]))</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>fig.update_layout(margin <span class="op">=</span> <span class="bu">dict</span>(t<span class="op">=</span><span class="dv">50</span>, l<span class="op">=</span><span class="dv">25</span>, r<span class="op">=</span><span class="dv">25</span>, b<span class="op">=</span><span class="dv">25</span>))</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.treemap(df12, path<span class="op">=</span>[px.Constant(<span class="st">"Bologna"</span>), <span class="st">'ad_layerid'</span>,<span class="st">'ad_builttypename'</span>], values<span class="op">=</span><span class="st">'n_listings'</span>, hover_data<span class="op">=</span>{<span class="st">'n_listings'</span>:<span class="st">':.0f'</span>,<span class="st">'price'</span>:<span class="st">':.0f'</span>},</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span><span class="st">'price'</span>, <span class="co">#hover_data=['ad_layerid'],</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>                  color_continuous_scale<span class="op">=</span><span class="st">'RdBu_r'</span>,</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>                  color_continuous_midpoint<span class="op">=</span>np.average(df11[<span class="st">'price'</span>], weights<span class="op">=</span>df11[<span class="st">'n_listings'</span>]))</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>fig.update_layout(margin <span class="op">=</span> <span class="bu">dict</span>(t<span class="op">=</span><span class="dv">50</span>, l<span class="op">=</span><span class="dv">25</span>, r<span class="op">=</span><span class="dv">25</span>, b<span class="op">=</span><span class="dv">25</span>))</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>TODO: timeseries of average price by area (which have the more upward/downward trend?)</p>
<p>Looking at the dataframe general information, we can see that 79 features are available and that the dataset contains 1460 samples. However, some features contains missing values. Also, the type of data is heterogeneous: both numerical and categorical data are available.</p>
<p>First, we will have a look at the data represented with numbers.</p>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>listing_bologna_cleansed2 <span class="op">=</span> listing_bologna_cleansed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co">#listing_bologna_cleansed = listing_bologna_cleansed2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Floor number</p>
<div class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.box(listing_bologna_cleansed, x <span class="op">=</span> <span class="st">'ad_floornumber'</span>, y <span class="op">=</span><span class="st">'ad_unitprice'</span>)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plotly manual axis adjustments</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>,<span class="dv">10000</span>])</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>CAUTION, all the code below is for information only to show, it is a quick and unstructured translation of what I did with R to solve the case study. It shows a first sketch of a regression analysis coming after the exploratory analysis we just performed.</p>
<p>A proper introduction to <code>scikit-learn</code> API by its developers, together with an introduction to machine learning concepts is available as a MOOC <a href="https://inria.github.io/scikit-learn-mooc/">here</a>.</p>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># listings_bologna &lt;- listings_bologna  %&gt;% </span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(ad_floor = if_else(!is.na(as.integer(ad_floornumber)), str_pad(ad_floornumber, width=2, side="left", pad="0"),ad_floornumber))</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="co"># listings_bologna &lt;- listings_bologna  %&gt;% </span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(ad_floor = case_when(ad_floor %in% c('08', '09', '10') ~ '08-10',</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 as.integer(ad_floornumber) &gt; 10 ~ '11+',</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 TRUE ~ ad_floor))</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a><span class="co"># df.case_when(</span></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a><span class="co">#      ((df.a == 0) &amp; (df.b != 0)) | (df.c == "wait"), df.a,</span></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a><span class="co">#      (df.b == 0) &amp; (df.a == 0), "x",</span></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a><span class="co">#      df.c,</span></span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a><span class="co">#      column_name="ad_floor",</span></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a><span class="co">#floor=listing_bologna_cleansed.assign(ad_floor = lambda x: x.ad_floornumber.apply(lambda y: y if y.astype("Int64").isna() else str(y.astype("Int64")).str.zfill(2)))</span></span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> isfloat(num):</span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">float</span>(num)</span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> janitor</span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a>floor <span class="op">=</span> listing_bologna_cleansed.assign(ad_floor_ <span class="op">=</span> <span class="kw">lambda</span> x: x.ad_floornumber.<span class="bu">apply</span>(<span class="kw">lambda</span> y: <span class="bu">float</span>(y) <span class="cf">if</span> isfloat(y) <span class="cf">else</span> <span class="op">-</span><span class="dv">10</span>)) </span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a>floor <span class="op">=</span> (floor.case_when(</span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a>      (floor.ad_floor_ <span class="op">&gt;=</span> <span class="dv">0</span>) <span class="op">&amp;</span> (floor.ad_floor_ <span class="op">&lt;</span> <span class="dv">8</span>), floor.ad_floor_.astype(<span class="st">"Int64"</span>).astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">2</span>), </span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a>      (floor.ad_floor_ <span class="op">&gt;=</span> <span class="dv">8</span>) <span class="op">&amp;</span> (floor.ad_floor_ <span class="op">&lt;=</span> <span class="dv">10</span>), <span class="st">'08-10'</span>,</span>
<span id="cb157-28"><a href="#cb157-28" aria-hidden="true" tabindex="-1"></a>      floor.ad_floor_<span class="op">&gt;</span><span class="dv">10</span>, <span class="st">"11+"</span>,</span>
<span id="cb157-29"><a href="#cb157-29" aria-hidden="true" tabindex="-1"></a>      floor.ad_floornumber,</span>
<span id="cb157-30"><a href="#cb157-30" aria-hidden="true" tabindex="-1"></a>      column_name<span class="op">=</span><span class="st">"ad_floor"</span>))</span>
<span id="cb157-31"><a href="#cb157-31" aria-hidden="true" tabindex="-1"></a>floor <span class="op">=</span> floor[[<span class="st">'ad_floornumber'</span>,<span class="st">'ad_floor'</span>]].drop_duplicates()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/janitor/utils.py:84: FutureWarning:

PandasArray has been renamed NumpyExtensionArray. Use that instead. This alias will be removed in a future version.
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>listing_bologna_cleansed<span class="op">=</span>(pd.merge(listing_bologna_cleansed, floor, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'ad_floornumber'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.box(listing_bologna_cleansed, x <span class="op">=</span> <span class="st">'ad_floor'</span>, y <span class="op">=</span><span class="st">'ad_unitprice'</span>)</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plotly manual axis adjustments</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>,<span class="dv">10000</span>])</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># floor_decade &lt;- function(value){ return(value - value %% 10) }</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="co"># floor_decade_v &lt;- Vectorize(floor_decade)</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="co"># floor_century &lt;- function(value){ return(value - value %% 100) }</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="co"># floor_century_v &lt;- Vectorize(floor_century)</span></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # [0-1700) / [1700-1900) relatively high prices then decrease along 1900 then pick up since 90s (bear in mind 64% of NAs)</span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="co"># listings_bologna &lt;- listings_bologna %&gt;%</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(ad_constructionperiod = as.factor(case_when(ad_constructionyear &gt;  2022 | is.na(ad_constructionyear) ~ NA_character_,</span></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                        ad_constructionyear &lt;  1700 ~ "&lt;1700",</span></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                        ad_constructionyear &lt;  1900 &amp; ad_constructionyear &gt;= 1700 ~ "1700-1900",</span></span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                        ad_constructionyear &gt;=  1900 ~ as.character(floor_decade(ad_constructionyear)))))</span></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>listing_bologna_cleansed <span class="op">=</span> (listing_bologna_cleansed.assign(ad_constructionperiod<span class="op">=</span> <span class="kw">lambda</span> x: pd.cut(x[<span class="st">'ad_constructionyear'</span>], right <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>                                              bins<span class="op">=</span>[<span class="op">-</span>np.inf, <span class="dv">1700</span>, <span class="dv">1900</span>, <span class="dv">1910</span>, <span class="dv">1920</span>, <span class="dv">1930</span>, <span class="dv">1940</span>, <span class="dv">1950</span>, <span class="dv">1960</span>, <span class="dv">1970</span>, <span class="dv">1980</span>, <span class="dv">1990</span>, <span class="dv">2000</span>, <span class="dv">2010</span>, <span class="dv">2020</span>, np.inf],</span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>                                              labels<span class="op">=</span>[<span class="st">"&lt;1700"</span>, <span class="st">"1700-1900"</span>, <span class="st">"1900"</span>, <span class="st">"1910"</span>, <span class="st">"1920"</span>, <span class="st">"1930"</span>, <span class="st">"1940"</span>, <span class="st">"1950"</span>, <span class="st">"1960"</span>, <span class="st">"1970"</span>, <span class="st">"1980"</span>, <span class="st">"1990"</span>, <span class="st">"2000"</span>, <span class="st">"2010"</span>, <span class="st">"2020+"</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.box(listing_bologna_cleansed, x <span class="op">=</span> <span class="st">'ad_constructionperiod'</span>, y <span class="op">=</span><span class="st">'ad_unitprice'</span>)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plotly manual axis adjustments</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>,<span class="dv">10000</span>])</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>listing_bologna_cleansed.loc[listing_bologna_cleansed[<span class="st">'ad_constructionyear'</span>]<span class="op">==</span><span class="dv">1951</span>,[<span class="st">'ad_constructionyear'</span>,<span class="st">'ad_constructionperiod'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_constructionyear</th>
<th data-quarto-table-cell-role="th">ad_constructionperiod</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">561</td>
<td>1951.0</td>
<td>1950</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1270</td>
<td>1951.0</td>
<td>1950</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1616</td>
<td>1951.0</td>
<td>1950</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2176</td>
<td>1951.0</td>
<td>1950</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2293</td>
<td>1951.0</td>
<td>1950</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56219</td>
<td>1951.0</td>
<td>1950</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">58140</td>
<td>1951.0</td>
<td>1950</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">58718</td>
<td>1951.0</td>
<td>1950</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">59607</td>
<td>1951.0</td>
<td>1950</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">60887</td>
<td>1951.0</td>
<td>1950</td>
</tr>
</tbody>
</table>

<p>85 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>listing_bologna_cleansed <span class="op">=</span> (listing_bologna_cleansed.assign(ad_areagroup<span class="op">=</span> <span class="kw">lambda</span> x: pd.cut(x[<span class="st">'ad_area'</span>], </span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>                                              bins<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>, <span class="dv">150</span>, np.inf],</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>                                              labels<span class="op">=</span>[<span class="st">"0-25"</span>, <span class="st">"25-50"</span>, <span class="st">"50-75"</span>, <span class="st">"75-100"</span>, <span class="st">"100-150"</span>, <span class="st">"150+"</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.box(listing_bologna_cleansed, x <span class="op">=</span> <span class="st">'ad_areagroup'</span>, y <span class="op">=</span><span class="st">'ad_unitprice'</span>)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plotly manual axis adjustments</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>,<span class="dv">10000</span>])</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>df15<span class="op">=</span>(time_series_listings</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>.query(<span class="st">'20191231 &lt; ad_asofdate &lt; 20220630'</span>)</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>.assign(ad_areagroup<span class="op">=</span> <span class="kw">lambda</span> x: pd.cut(x[<span class="st">'ad_area'</span>], </span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>                                       bins<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>, <span class="dv">150</span>, np.inf],</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>                                       labels<span class="op">=</span>[<span class="st">"0-25"</span>, <span class="st">"25-50"</span>, <span class="st">"50-75"</span>, <span class="st">"75-100"</span>, <span class="st">"100-150"</span>, <span class="st">"150+"</span>]))</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>.groupby([<span class="st">'ad_asofdate'</span>,<span class="st">'ad_areagroup'</span>])</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>.agg(number_alive_listings<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>     mean_price<span class="op">=</span>(<span class="st">'ad_unitprice'</span>, <span class="st">'mean'</span>))</span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>.reset_index()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/qb/99v_gzds7j7725jspcz_ch9w0000gn/T/ipykernel_18736/2423735559.py:6: FutureWarning:

The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(df15, x<span class="op">=</span><span class="st">"ad_asofdate"</span>, y<span class="op">=</span><span class="st">"mean_price"</span>, color<span class="op">=</span><span class="st">"ad_areagroup"</span>)</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Add figure title</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Average price by type of surface"</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis title</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Date"</span>)</span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set y-axes titles</span></span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Price €/sqm"</span>)</span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plotly manual axis adjustments</span></span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">2500</span>,<span class="dv">6000</span>])</span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/plotly/express/_core.py:2044: FutureWarning:

The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.

/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/_plotly_utils/basevalidators.py:105: FutureWarning:

The behavior of DatetimeProperties.to_pydatetime is deprecated, in a future version this will return a Series containing python datetime objects instead of an ndarray. To retain the old behavior, call `np.array` on the result
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>name_postal_codes<span class="op">=</span>(listing_bologna_cleansed </span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>       .groupby([<span class="st">'ad_postalcode'</span>])</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>       .agg(n_listings<span class="op">=</span>(<span class="st">'ad_id'</span>, <span class="st">'count'</span>)) </span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>       .reset_index()</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>       .sort_values(by<span class="op">=</span><span class="st">'n_listings'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>       .assign(ad_postalcodeid <span class="op">=</span> <span class="kw">lambda</span> x: <span class="st">'pc_'</span> <span class="op">+</span> x.n_listings.rank(method<span class="op">=</span><span class="st">'first'</span>,ascending<span class="op">=</span><span class="va">False</span>).astype(<span class="bu">int</span>).astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">2</span>))</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>       .loc[:,[<span class="st">'ad_postalcode'</span>,<span class="st">'ad_postalcodeid'</span>]])</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>na_pc <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">'ad_postalcode'</span>,<span class="st">'ad_postalcodeid'</span>], data<span class="op">=</span>[[np.nan,<span class="st">"pc_na"</span>]])</span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>name_postal_codes <span class="op">=</span> pd.concat([name_postal_codes,na_pc])</span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a>name_postal_codes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_postalcode</th>
<th data-quarto-table-cell-role="th">ad_postalcodeid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">37</td>
<td>82568.0</td>
<td>pc_01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>82557.0</td>
<td>pc_02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>82562.0</td>
<td>pc_03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36</td>
<td>82567.0</td>
<td>pc_04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>82561.0</td>
<td>pc_05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>82566.0</td>
<td>pc_06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">29</td>
<td>82560.0</td>
<td>pc_07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>82570.0</td>
<td>pc_08</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>82555.0</td>
<td>pc_09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>82556.0</td>
<td>pc_10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>82550.0</td>
<td>pc_11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>82551.0</td>
<td>pc_12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>82558.0</td>
<td>pc_13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">34</td>
<td>82565.0</td>
<td>pc_14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>82563.0</td>
<td>pc_15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>82554.0</td>
<td>pc_16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>82529.0</td>
<td>pc_17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22</td>
<td>82552.0</td>
<td>pc_18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">23</td>
<td>82553.0</td>
<td>pc_19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>82564.0</td>
<td>pc_20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>82497.0</td>
<td>pc_21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>82462.0</td>
<td>pc_22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>82441.0</td>
<td>pc_23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>98446.0</td>
<td>pc_24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>82442.0</td>
<td>pc_25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>80462.0</td>
<td>pc_26</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>82484.0</td>
<td>pc_27</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>82549.0</td>
<td>pc_28</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>63280.0</td>
<td>pc_29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>42469.0</td>
<td>pc_30</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>82452.0</td>
<td>pc_31</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>82480.0</td>
<td>pc_32</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>82447.0</td>
<td>pc_33</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>61467.0</td>
<td>pc_34</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>45461.0</td>
<td>pc_35</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>82585.0</td>
<td>pc_36</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>42590.0</td>
<td>pc_37</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>82444.0</td>
<td>pc_38</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>82443.0</td>
<td>pc_39</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>68442.0</td>
<td>pc_40</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>84550.0</td>
<td>pc_41</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>42614.0</td>
<td>pc_42</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>99529.0</td>
<td>pc_43</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>pc_na</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>name_layers<span class="op">=</span>(listing_bologna_cleansed </span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>       .groupby([<span class="st">'ad_layerlocation'</span>])</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>       .agg(n_listings<span class="op">=</span>(<span class="st">'ad_id'</span>, <span class="st">'count'</span>))</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>       .reset_index()</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>       .sort_values(by<span class="op">=</span><span class="st">'n_listings'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>       .assign(ad_layerid <span class="op">=</span> <span class="kw">lambda</span> x: <span class="st">'lay_'</span> <span class="op">+</span> x.n_listings.rank(method<span class="op">=</span><span class="st">'first'</span>,ascending<span class="op">=</span><span class="va">False</span>).astype(<span class="bu">int</span>).astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">2</span>))</span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>       .loc[:,[<span class="st">'ad_layerlocation'</span>,<span class="st">'ad_layerid'</span>]])</span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>name_layers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_layerlocation</th>
<th data-quarto-table-cell-role="th">ad_layerid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>85ea9cbc768010f730bc474da4a253da</td>
<td>lay_01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>46f3699d96a59f9e2bba52d52b74315f</td>
<td>lay_02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>df7ce39f801ce4de8d05cd243dd7f5d7</td>
<td>lay_03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>a3c47f8c8202d15ff4aeff6102adc107</td>
<td>lay_04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>72fba7c6c57ed8519627ff3b45b712be</td>
<td>lay_05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>bed4247ad695180b20040d14b25af551</td>
<td>lay_06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>408edd8f9b5a1e0b8110093fbf261780</td>
<td>lay_07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>5f8908f23709d384f8955c831f6b204e</td>
<td>lay_08</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>319ff21efb401d5c564b88917df71817</td>
<td>lay_09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>52cd50eede0d8d599447eecf578fe2d6</td>
<td>lay_10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>96c63b3a47c2ac51cd191ce61ff32e62</td>
<td>lay_11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>3d17a7e664b3bdb02e542e1301e4c5fd</td>
<td>lay_12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>566970b69cb9ece6ec78ef729a24da67</td>
<td>lay_13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2980880cab17cd30f699235c2a2b74d8</td>
<td>lay_14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>79ae74c58af1dfb4d92181f8574a020f</td>
<td>lay_15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>2b6ad9c422f1dd2cab3c76ea8180a1f0</td>
<td>lay_16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>30907c9787a9f0abb95882f115ff1cec</td>
<td>lay_17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>01325f6317e14398244811321639fb91</td>
<td>lay_18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>c0ff13b213e1e7e1947e52afe9b9d68b</td>
<td>lay_19</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>listing_bologna_cleansed<span class="op">=</span>(pd.merge(listing_bologna_cleansed, name_postal_codes, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'ad_postalcode'</span>])</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>                  .merge(name_layers, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span><span class="st">'ad_layerlocation'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>numerical_data <span class="op">=</span> listing_bologna_cleansed.select_dtypes(<span class="st">"number"</span>)</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>numerical_data.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 60929 entries, 0 to 60928
Data columns (total 35 columns):
 #   Column                         Non-Null Count  Dtype  
---  ------                         --------------  -----  
 0   ad_state                       60929 non-null  int64  
 1   ad_operation                   60929 non-null  int64  
 2   ad_typology                    60929 non-null  int64  
 3   ad_propertytype                60929 non-null  int64  
 4   ad_unitprice                   60929 non-null  float64
 5   ad_postalcode                  58152 non-null  float64
 6   ad_streetnumber                32983 non-null  float64
 7   ad_addressvisible              60929 non-null  int64  
 8   ad_subtypology                 6456 non-null   float64
 9   ad_area                        60929 non-null  float64
 10  ad_builttype                   58144 non-null  float64
 11  ad_roomnumber                  60929 non-null  int64  
 12  ad_bathnumber                  60929 non-null  int64  
 13  ad_flatlocation                6141 non-null   float64
 14  ad_haslift                     53132 non-null  float64
 15  ad_hasparkingspace             34750 non-null  float64
 16  ad_hasboxroom                  29992 non-null  float64
 17  ad_hasswimmingpool             19026 non-null  float64
 18  newdevelopment_commercialname  0 non-null      float64
 19  newdevelopment_fromprice       0 non-null      float64
 20  newdevelopment_averageprice    0 non-null      float64
 21  layerlocation_area             60929 non-null  float64
 22  layerlocation_population       60929 non-null  int64  
 23  estate_cadastralroot           0 non-null      float64
 24  property_cadastralreference    0 non-null      float64
 25  property_builtdate             0 non-null      float64
 26  property_area                  0 non-null      float64
 27  property_use                   0 non-null      float64
 28  censustract_id                 0 non-null      float64
 29  censustract_town_id            0 non-null      float64
 30  address_certainty              0 non-null      float64
 31  cadastral_certainty            0 non-null      float64
 32  ad_ParkingIsIncludedInPrice    0 non-null      float64
 33  ad_isAuction                   20358 non-null  float64
 34  ad_constructionyear            21614 non-null  float64
dtypes: float64(27), int64(8)
memory usage: 16.3 MB</code></pre>
</div>
</div>
<div class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>numerical_data.hist(bins<span class="op">=</span><span class="dv">20</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">22</span>), edgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>                    layout<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">4</span>))</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(hspace<span class="op">=</span><span class="fl">0.8</span>, wspace<span class="op">=</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03_real_estate_eda_files/figure-html/cell-123-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Most of the preceding variables are categorical and should be encoded this way. Some other are empty or have constant value so we drop them. Very few are numerical:</p>
<div class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>drop_features <span class="op">=</span> [</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 100% empty</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="st">"newdevelopment_commercialname"</span>, </span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="st">"newdevelopment_fromprice"</span>,      </span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="st">"newdevelopment_averageprice"</span>,   </span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a><span class="st">"estate_cadastralroot"</span>,          </span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="st">"property_cadastralreference"</span>,   </span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a><span class="st">"property_builtdate"</span>,            </span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a><span class="st">"property_area"</span>,                 </span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a><span class="st">"property_use"</span>,                  </span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a><span class="st">"censustract_id"</span>,                </span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a><span class="st">"censustract_town_id"</span>,           </span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a><span class="st">"address_certainty"</span>,             </span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a><span class="st">"cadastral_certainty"</span>,           </span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_ParkingIsIncludedInPrice"</span>,</span>
<span id="cb180-16"><a href="#cb180-16" aria-hidden="true" tabindex="-1"></a><span class="co"># constant value</span></span>
<span id="cb180-17"><a href="#cb180-17" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_state"</span>,                       </span>
<span id="cb180-18"><a href="#cb180-18" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_operation"</span>,</span>
<span id="cb180-19"><a href="#cb180-19" aria-hidden="true" tabindex="-1"></a><span class="st">"layerlocation_population"</span>,</span>
<span id="cb180-20"><a href="#cb180-20" aria-hidden="true" tabindex="-1"></a><span class="st">"country"</span>,</span>
<span id="cb180-21"><a href="#cb180-21" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_town"</span>,</span>
<span id="cb180-22"><a href="#cb180-22" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_province"</span>,</span>
<span id="cb180-23"><a href="#cb180-23" aria-hidden="true" tabindex="-1"></a><span class="co"># already transformed</span></span>
<span id="cb180-24"><a href="#cb180-24" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_typology"</span>,</span>
<span id="cb180-25"><a href="#cb180-25" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_subtypology"</span>,</span>
<span id="cb180-26"><a href="#cb180-26" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_builttype"</span>,</span>
<span id="cb180-27"><a href="#cb180-27" aria-hidden="true" tabindex="-1"></a><span class="co">#"ad_area",</span></span>
<span id="cb180-28"><a href="#cb180-28" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_floornumber"</span></span>
<span id="cb180-29"><a href="#cb180-29" aria-hidden="true" tabindex="-1"></a><span class="co">#"ad_constructionyear"</span></span>
<span id="cb180-30"><a href="#cb180-30" aria-hidden="true" tabindex="-1"></a><span class="co">#"ad_layerlocation"</span></span>
<span id="cb180-31"><a href="#cb180-31" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>target_variable <span class="op">=</span> <span class="st">"ad_unitprice"</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>numerical_features <span class="op">=</span> [</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ad_area"</span>,</span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ad_roomnumber"</span>,</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ad_bathnumber"</span>,</span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>    target_variable,</span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> listing_bologna_cleansed.drop(drop_features, axis <span class="op">=</span> <span class="dv">1</span>).columns.difference(numerical_features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>categorical_features</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="135">
<pre><code>Index(['ad_activationdate', 'ad_addressvisible', 'ad_areagroup',
       'ad_builttypename', 'ad_constructionperiod', 'ad_constructionyear',
       'ad_deactivationdate', 'ad_flatlocation', 'ad_floor', 'ad_hasboxroom',
       'ad_haslift', 'ad_hasparkingspace', 'ad_hasswimmingpool',
       'ad_heatingtype', 'ad_id', 'ad_isAuction', 'ad_layerid',
       'ad_layerlocation', 'ad_modificationdate', 'ad_postalcode',
       'ad_postalcodeid', 'ad_propertytype', 'ad_streetname',
       'ad_streetnumber', 'ad_streettype', 'ad_typologyname', 'last_seen_date',
       'layerlocation_area'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> [</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_activationdate', temporal features in another analysis</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_addressvisible',</span></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_areagroup'</span>,</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_builttypename'</span>,</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_constructionperiod'</span>, </span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_deactivationdate',</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_flatlocation'</span>, </span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_floor'</span>, </span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_hasboxroom'</span>, </span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_haslift'</span>,</span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_hasparkingspace'</span>, </span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_hasswimmingpool'</span>, </span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_heatingtype'</span>, </span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_id', usefull to build time series, decrease and time on market indicator</span></span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_isAuction'</span>, </span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_modificationdate',</span></span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_postalcode', layer showed better boxplot, drop in a first step</span></span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_propertytype'</span>, </span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_streetname', &gt;1300 street name, would be usefull if it allowed to join census or shapefile data</span></span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_streetnumber',</span></span>
<span id="cb184-22"><a href="#cb184-22" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_streettype'</span>, </span>
<span id="cb184-23"><a href="#cb184-23" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_typologyname'</span>, </span>
<span id="cb184-24"><a href="#cb184-24" aria-hidden="true" tabindex="-1"></a><span class="co">#'last_seen_date', temporal features in another analysis</span></span>
<span id="cb184-25"><a href="#cb184-25" aria-hidden="true" tabindex="-1"></a><span class="co">#'layerlocation_area' 1 by layer</span></span>
<span id="cb184-26"><a href="#cb184-26" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>string_data <span class="op">=</span> listing_bologna_cleansed.select_dtypes(<span class="bu">object</span>)</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>string_data.info()</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>string_data.shape[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 60929 entries, 0 to 60928
Data columns (total 18 columns):
 #   Column               Non-Null Count  Dtype 
---  ------               --------------  ----- 
 0   ad_id                60929 non-null  object
 1   ad_activationdate    60929 non-null  object
 2   ad_deactivationdate  8732 non-null   object
 3   ad_modificationdate  60929 non-null  object
 4   ad_layerlocation     60929 non-null  object
 5   ad_province          60929 non-null  object
 6   ad_town              60929 non-null  object
 7   ad_streettype        48371 non-null  object
 8   ad_streetname        50584 non-null  object
 9   ad_floornumber       50962 non-null  object
 10  ad_heatingtype       23647 non-null  object
 11  last_seen_date       60929 non-null  object
 12  country              60929 non-null  object
 13  ad_typologyname      60929 non-null  object
 14  ad_builttypename     60929 non-null  object
 15  ad_floor             50962 non-null  object
 16  ad_postalcodeid      60929 non-null  object
 17  ad_layerid           60929 non-null  object
dtypes: object(18)
memory usage: 8.4+ MB</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="137">
<pre><code>18</code></pre>
</div>
</div>
<p>Inspired from: https://www.kaggle.com/code/tracyporter/ames-house-prices-catboost?scriptVersionId=48029722 Split listings train and test datasets (test will be all ‘ad_id’ which did not appear before 2022-03-31)</p>
<div class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis <span class="op">=</span> listing_bologna_cleansed</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis [<span class="st">'ad_flatlocation'</span>] <span class="op">=</span> listing_bologna_analysis [<span class="st">'ad_flatlocation'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis [<span class="st">'ad_haslift'</span>] <span class="op">=</span> listing_bologna_analysis [<span class="st">'ad_haslift'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis [<span class="st">'ad_flatlocation'</span>] <span class="op">=</span> listing_bologna_analysis [<span class="st">'ad_flatlocation'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis [<span class="st">'ad_hasparkingspace'</span>] <span class="op">=</span> listing_bologna_analysis [<span class="st">'ad_hasparkingspace'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis [<span class="st">'ad_hasboxroom'</span>] <span class="op">=</span> listing_bologna_analysis [<span class="st">'ad_hasboxroom'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis [<span class="st">'ad_hasswimmingpool'</span>] <span class="op">=</span> listing_bologna_analysis [<span class="st">'ad_hasswimmingpool'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis [<span class="st">'ad_isAuction'</span>] <span class="op">=</span> listing_bologna_analysis [<span class="st">'ad_isAuction'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis [<span class="st">'ad_propertytype'</span>] <span class="op">=</span> listing_bologna_analysis [<span class="st">'ad_propertytype'</span>].astype(<span class="bu">str</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 60929 entries, 0 to 60928
Data columns (total 55 columns):
 #   Column                         Non-Null Count  Dtype   
---  ------                         --------------  -----   
 0   ad_id                          60929 non-null  object  
 1   ad_state                       60929 non-null  int64   
 2   ad_operation                   60929 non-null  int64   
 3   ad_typology                    60929 non-null  int64   
 4   ad_propertytype                60929 non-null  object  
 5   ad_unitprice                   60929 non-null  float64 
 6   ad_activationdate              60929 non-null  object  
 7   ad_deactivationdate            8732 non-null   object  
 8   ad_modificationdate            60929 non-null  object  
 9   ad_layerlocation               60929 non-null  object  
 10  ad_province                    60929 non-null  object  
 11  ad_town                        60929 non-null  object  
 12  ad_postalcode                  58152 non-null  float64 
 13  ad_streettype                  48371 non-null  object  
 14  ad_streetname                  50584 non-null  object  
 15  ad_streetnumber                32983 non-null  float64 
 16  ad_floornumber                 50962 non-null  object  
 17  ad_addressvisible              60929 non-null  int64   
 18  ad_subtypology                 6456 non-null   float64 
 19  ad_area                        60929 non-null  float64 
 20  ad_builttype                   58144 non-null  float64 
 21  ad_roomnumber                  60929 non-null  int64   
 22  ad_bathnumber                  60929 non-null  int64   
 23  ad_flatlocation                60929 non-null  object  
 24  ad_haslift                     60929 non-null  object  
 25  ad_hasparkingspace             60929 non-null  object  
 26  ad_hasboxroom                  60929 non-null  object  
 27  ad_hasswimmingpool             60929 non-null  object  
 28  newdevelopment_commercialname  0 non-null      float64 
 29  newdevelopment_fromprice       0 non-null      float64 
 30  newdevelopment_averageprice    0 non-null      float64 
 31  layerlocation_area             60929 non-null  float64 
 32  layerlocation_population       60929 non-null  int64   
 33  estate_cadastralroot           0 non-null      float64 
 34  property_cadastralreference    0 non-null      float64 
 35  property_builtdate             0 non-null      float64 
 36  property_area                  0 non-null      float64 
 37  property_use                   0 non-null      float64 
 38  censustract_id                 0 non-null      float64 
 39  censustract_town_id            0 non-null      float64 
 40  address_certainty              0 non-null      float64 
 41  cadastral_certainty            0 non-null      float64 
 42  ad_ParkingIsIncludedInPrice    0 non-null      float64 
 43  ad_isAuction                   60929 non-null  object  
 44  ad_constructionyear            21614 non-null  float64 
 45  ad_heatingtype                 23647 non-null  object  
 46  last_seen_date                 60929 non-null  object  
 47  country                        60929 non-null  object  
 48  ad_typologyname                60929 non-null  object  
 49  ad_builttypename               60929 non-null  object  
 50  ad_floor                       50962 non-null  object  
 51  ad_constructionperiod          21614 non-null  category
 52  ad_areagroup                   60929 non-null  category
 53  ad_postalcodeid                60929 non-null  object  
 54  ad_layerid                     60929 non-null  object  
dtypes: category(2), float64(21), int64(7), object(25)
memory usage: 24.8+ MB</code></pre>
</div>
</div>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis_test_id <span class="op">=</span> (listing_bologna_analysis </span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>.assign(ad_modificationdate <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'ad_modificationdate'</span>]))</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>.groupby(<span class="st">'ad_id'</span>)</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>.agg(min_date<span class="op">=</span>(<span class="st">'ad_modificationdate'</span>,<span class="st">'mean'</span>))</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>.reset_index()</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>.query(<span class="st">'20220331 &lt; min_date &lt; 20220630'</span>))</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis_test_id</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="140">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">min_date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0006e5a0e99174da7446352ed19dbea4</td>
<td>2022-06-02 00:00:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>000dda3e1f1f6cff1218cd1e5553fff3</td>
<td>2022-04-09 00:00:00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>0022355af80c2fb3a3b2d00527ba26d3</td>
<td>2022-04-21 00:00:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>00376ac49f16cdc1628554caa196f2c1</td>
<td>2022-04-30 12:00:00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>0040aeadaf6a9acb601b43e8e2001c4a</td>
<td>2022-05-14 00:00:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18166</td>
<td>ff28dc268e42a1d61fa35e557509d991</td>
<td>2022-05-18 00:00:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18176</td>
<td>ff55e174ffa9785a459b4a21cfe1a314</td>
<td>2022-04-23 20:00:00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18189</td>
<td>ff8acfe6e9cde7f37992c81bc839b484</td>
<td>2022-05-16 00:00:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18204</td>
<td>ffb48ff82bf4744675e3f82a6b54f76a</td>
<td>2022-05-04 00:00:00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18212</td>
<td>ffdb89931d96121bf3403cc1cae04f7d</td>
<td>2022-04-12 12:00:00</td>
</tr>
</tbody>
</table>

<p>2015 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis_test<span class="op">=</span>listing_bologna_analysis.loc[listing_bologna_analysis[<span class="st">'ad_id'</span>].isin(listing_bologna_analysis_test_id[<span class="st">'ad_id'</span>])]</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="141">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_state</th>
<th data-quarto-table-cell-role="th">ad_operation</th>
<th data-quarto-table-cell-role="th">ad_typology</th>
<th data-quarto-table-cell-role="th">ad_propertytype</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">ad_activationdate</th>
<th data-quarto-table-cell-role="th">ad_deactivationdate</th>
<th data-quarto-table-cell-role="th">ad_modificationdate</th>
<th data-quarto-table-cell-role="th">ad_layerlocation</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">ad_heatingtype</th>
<th data-quarto-table-cell-role="th">last_seen_date</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">ad_typologyname</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
<th data-quarto-table-cell-role="th">ad_floor</th>
<th data-quarto-table-cell-role="th">ad_constructionperiod</th>
<th data-quarto-table-cell-role="th">ad_areagroup</th>
<th data-quarto-table-cell-role="th">ad_postalcodeid</th>
<th data-quarto-table-cell-role="th">ad_layerid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>f705446dfa9855cc222262672c72e533</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>3833.333333</td>
<td>2022-03-21</td>
<td>NaN</td>
<td>2022-03-24</td>
<td>72fba7c6c57ed8519627ff3b45b712be</td>
<td>...</td>
<td>CENTRAL_OTHER</td>
<td>2022-03-28</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>03</td>
<td>NaN</td>
<td>100-150</td>
<td>pc_06</td>
<td>lay_05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">105</td>
<td>0db2072a611469e9abd78733d01e52e3</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>3545.454545</td>
<td>2022-03-25</td>
<td>NaN</td>
<td>2022-03-25</td>
<td>bed4247ad695180b20040d14b25af551</td>
<td>...</td>
<td>INDIVIDUAL_AIR_CONDITIONING_HEAT_PUMP</td>
<td>2022-03-30</td>
<td>it</td>
<td>apartment-other</td>
<td>partially-renovated</td>
<td>en</td>
<td>1950</td>
<td>50-75</td>
<td>pc_04</td>
<td>lay_06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">128</td>
<td>ceb91e91a79ecada1ad06b8fdfed2c32</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2622.377622</td>
<td>2022-03-24</td>
<td>NaN</td>
<td>2022-03-24</td>
<td>46f3699d96a59f9e2bba52d52b74315f</td>
<td>...</td>
<td>INDIVIDUAL</td>
<td>2022-03-28</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>07</td>
<td>1970</td>
<td>100-150</td>
<td>pc_01</td>
<td>lay_02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">132</td>
<td>083cdef7722a6a5430d8f37e96cb0b23</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>4444.444444</td>
<td>2022-04-11</td>
<td>NaN</td>
<td>2022-04-19</td>
<td>319ff21efb401d5c564b88917df71817</td>
<td>...</td>
<td>CENTRAL</td>
<td>2022-04-20</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>04</td>
<td>NaN</td>
<td>100-150</td>
<td>pc_20</td>
<td>lay_09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">136</td>
<td>be48686b5c374ed5c2594f8536a46283</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2857.142857</td>
<td>2022-04-11</td>
<td>NaN</td>
<td>2022-04-12</td>
<td>3d17a7e664b3bdb02e542e1301e4c5fd</td>
<td>...</td>
<td>INDIVIDUAL_OTHER</td>
<td>2022-05-11</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>01</td>
<td>NaN</td>
<td>75-100</td>
<td>pc_03</td>
<td>lay_12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">60836</td>
<td>425de5345cb304c7c47154e904dae777</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>3266.666667</td>
<td>2022-04-01</td>
<td>NaN</td>
<td>2022-04-01</td>
<td>5f8908f23709d384f8955c831f6b204e</td>
<td>...</td>
<td>INDIVIDUAL</td>
<td>2022-04-26</td>
<td>it</td>
<td>chalet</td>
<td>partially-renovated</td>
<td>01</td>
<td>1970</td>
<td>150+</td>
<td>pc_08</td>
<td>lay_08</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">60838</td>
<td>e09de716ad5571d4e00f15e6a0c4de97</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>5000.000000</td>
<td>2022-04-29</td>
<td>NaN</td>
<td>2022-04-29</td>
<td>52cd50eede0d8d599447eecf578fe2d6</td>
<td>...</td>
<td>INDIVIDUAL</td>
<td>2022-05-13</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>bj</td>
<td>1960</td>
<td>75-100</td>
<td>pc_16</td>
<td>lay_10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">60840</td>
<td>18ff0ecf100772c60a289812f27268c0</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>4618.750000</td>
<td>2022-03-22</td>
<td>NaN</td>
<td>2022-04-15</td>
<td>408edd8f9b5a1e0b8110093fbf261780</td>
<td>...</td>
<td>CENTRAL_OTHER</td>
<td>2022-06-01</td>
<td>it</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>01</td>
<td>NaN</td>
<td>150+</td>
<td>pc_17</td>
<td>lay_07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">60879</td>
<td>8c799f282fb154a5a0f7e66ca2d56475</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>3260.869565</td>
<td>2022-04-20</td>
<td>NaN</td>
<td>2022-05-26</td>
<td>30907c9787a9f0abb95882f115ff1cec</td>
<td>...</td>
<td>CENTRAL</td>
<td>2022-06-12</td>
<td>it</td>
<td>apartment</td>
<td>unknown-builttype</td>
<td>02</td>
<td>2020+</td>
<td>100-150</td>
<td>pc_07</td>
<td>lay_17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">60927</td>
<td>815a093ac1fabdd9d25a9f415685318d</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>5285.714286</td>
<td>2022-03-07</td>
<td>NaN</td>
<td>2022-03-07</td>
<td>72fba7c6c57ed8519627ff3b45b712be</td>
<td>...</td>
<td>INDIVIDUAL_OTHER</td>
<td>2022-03-08</td>
<td>it</td>
<td>independent-house</td>
<td>partially-renovated</td>
<td>NaN</td>
<td>NaN</td>
<td>150+</td>
<td>pc_06</td>
<td>lay_05</td>
</tr>
</tbody>
</table>

<p>4788 rows × 55 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>listing_bologna_analysis_train<span class="op">=</span>listing_bologna_analysis.loc[<span class="op">~</span>listing_bologna_analysis[<span class="st">'ad_id'</span>].isin(listing_bologna_analysis_test_id[<span class="st">'ad_id'</span>])]</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>(listing_bologna_analysis_train</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>.assign(ad_modificationdate <span class="op">=</span> <span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">'ad_modificationdate'</span>]))</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>.groupby(<span class="st">'ad_id'</span>)</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>.agg(min_date<span class="op">=</span>(<span class="st">'ad_modificationdate'</span>,<span class="st">'mean'</span>))</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>.reset_index()</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>.query(<span class="st">'20220331 &lt; min_date &lt; 20220630'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="142">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">min_date</th>
</tr>
</thead>
<tbody>
</tbody>
</table>

</div>
</div>
</div>
<p>Define X, y and X_test variables</p>
<div class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> listing_bologna_analysis_train.drop(drop_features, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> listing_bologna_analysis_test.drop(drop_features, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>train.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 56141 entries, 0 to 60928
Data columns (total 32 columns):
 #   Column                 Non-Null Count  Dtype   
---  ------                 --------------  -----   
 0   ad_id                  56141 non-null  object  
 1   ad_propertytype        56141 non-null  object  
 2   ad_unitprice           56141 non-null  float64 
 3   ad_activationdate      56141 non-null  object  
 4   ad_deactivationdate    8371 non-null   object  
 5   ad_modificationdate    56141 non-null  object  
 6   ad_layerlocation       56141 non-null  object  
 7   ad_postalcode          53681 non-null  float64 
 8   ad_streettype          44357 non-null  object  
 9   ad_streetname          46378 non-null  object  
 10  ad_streetnumber        29989 non-null  float64 
 11  ad_addressvisible      56141 non-null  int64   
 12  ad_area                56141 non-null  float64 
 13  ad_roomnumber          56141 non-null  int64   
 14  ad_bathnumber          56141 non-null  int64   
 15  ad_flatlocation        56141 non-null  object  
 16  ad_haslift             56141 non-null  object  
 17  ad_hasparkingspace     56141 non-null  object  
 18  ad_hasboxroom          56141 non-null  object  
 19  ad_hasswimmingpool     56141 non-null  object  
 20  layerlocation_area     56141 non-null  float64 
 21  ad_isAuction           56141 non-null  object  
 22  ad_constructionyear    18209 non-null  float64 
 23  ad_heatingtype         19476 non-null  object  
 24  last_seen_date         56141 non-null  object  
 25  ad_typologyname        56141 non-null  object  
 26  ad_builttypename       56141 non-null  object  
 27  ad_floor               46693 non-null  object  
 28  ad_constructionperiod  18209 non-null  category
 29  ad_areagroup           56141 non-null  category
 30  ad_postalcodeid        56141 non-null  object  
 31  ad_layerid             56141 non-null  object  
dtypes: category(2), float64(6), int64(3), object(21)
memory usage: 13.4+ MB</code></pre>
</div>
</div>
<div class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> train.ad_unitprice</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> test.ad_unitprice</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> train.drop([<span class="st">'ad_unitprice'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> test.drop([<span class="st">'ad_unitprice'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>X.loc[:,<span class="st">'ad_area'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="146">
<pre><code>0         73.0
1         72.0
2         93.0
3        131.0
4        130.0
         ...  
60923     70.0
60924     70.0
60925     82.0
60926     80.0
60928    105.0
Name: ad_area, Length: 56141, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>train.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="147">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ad_id</th>
<th data-quarto-table-cell-role="th">ad_propertytype</th>
<th data-quarto-table-cell-role="th">ad_unitprice</th>
<th data-quarto-table-cell-role="th">ad_activationdate</th>
<th data-quarto-table-cell-role="th">ad_deactivationdate</th>
<th data-quarto-table-cell-role="th">ad_modificationdate</th>
<th data-quarto-table-cell-role="th">ad_layerlocation</th>
<th data-quarto-table-cell-role="th">ad_postalcode</th>
<th data-quarto-table-cell-role="th">ad_streettype</th>
<th data-quarto-table-cell-role="th">ad_streetname</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">ad_constructionyear</th>
<th data-quarto-table-cell-role="th">ad_heatingtype</th>
<th data-quarto-table-cell-role="th">last_seen_date</th>
<th data-quarto-table-cell-role="th">ad_typologyname</th>
<th data-quarto-table-cell-role="th">ad_builttypename</th>
<th data-quarto-table-cell-role="th">ad_floor</th>
<th data-quarto-table-cell-role="th">ad_constructionperiod</th>
<th data-quarto-table-cell-role="th">ad_areagroup</th>
<th data-quarto-table-cell-role="th">ad_postalcodeid</th>
<th data-quarto-table-cell-role="th">ad_layerid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>96af3057c851a1b5594bce0c7f7864c2</td>
<td>1</td>
<td>3000.000000</td>
<td>2021-04-12</td>
<td>2021-03-26</td>
<td>2021-04-22</td>
<td>30907c9787a9f0abb95882f115ff1cec</td>
<td>82560.0</td>
<td>CL</td>
<td>27833c81c237928d9fb0ba1250879249</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>2021-04-28</td>
<td>independent-house</td>
<td>partially-renovated</td>
<td>NaN</td>
<td>NaN</td>
<td>50-75</td>
<td>pc_07</td>
<td>lay_17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>fa2c84344b6c3bbc7484a8150d7efad6</td>
<td>1</td>
<td>1385.416667</td>
<td>2021-09-29</td>
<td>NaN</td>
<td>2021-11-30</td>
<td>319ff21efb401d5c564b88917df71817</td>
<td>82563.0</td>
<td>CL</td>
<td>31d4dc3ff2e5ed57044b58ae5a1b0911</td>
<td>...</td>
<td>NaN</td>
<td>CENTRAL_OTHER</td>
<td>2022-01-19</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>03</td>
<td>NaN</td>
<td>50-75</td>
<td>pc_15</td>
<td>lay_09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>05110a844b8a99e5176aa2dc5e22cc73</td>
<td>1</td>
<td>1169.354839</td>
<td>2021-07-22</td>
<td>NaN</td>
<td>2021-08-03</td>
<td>46f3699d96a59f9e2bba52d52b74315f</td>
<td>82568.0</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>2021-08-04</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>04</td>
<td>NaN</td>
<td>75-100</td>
<td>pc_01</td>
<td>lay_02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>bebb199b94b68c4b5dd519e3f225caff</td>
<td>1</td>
<td>1809.160305</td>
<td>2021-12-04</td>
<td>NaN</td>
<td>2022-01-04</td>
<td>a3c47f8c8202d15ff4aeff6102adc107</td>
<td>82550.0</td>
<td>CL</td>
<td>1dca9edce4282837a17c9493fd45469f</td>
<td>...</td>
<td>NaN</td>
<td>CENTRAL_OTHER</td>
<td>2022-01-05</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>05</td>
<td>NaN</td>
<td>100-150</td>
<td>pc_11</td>
<td>lay_04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>b3ca91a1f68caa6dc0d4f93ee2e56011</td>
<td>1</td>
<td>1875.000000</td>
<td>2021-11-10</td>
<td>2019-05-31</td>
<td>2021-12-22</td>
<td>408edd8f9b5a1e0b8110093fbf261780</td>
<td>82555.0</td>
<td>CL</td>
<td>8803a437a0dfc71e71d43b8e2c63bb97</td>
<td>...</td>
<td>NaN</td>
<td>CENTRAL_OTHER</td>
<td>2021-12-23</td>
<td>apartment</td>
<td>partially-renovated</td>
<td>NaN</td>
<td>NaN</td>
<td>100-150</td>
<td>pc_09</td>
<td>lay_07</td>
</tr>
</tbody>
</table>

<p>5 rows × 32 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> [</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_activationdate', temporal features in another analysis</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_addressvisible',</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_layerid'</span>,</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_areagroup'</span>,</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_builttypename'</span>,</span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_constructionperiod'</span>, </span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_deactivationdate',</span></span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_flatlocation'</span>, </span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_floor'</span>, </span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_hasboxroom'</span>, </span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_haslift'</span>,</span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_hasparkingspace'</span>, </span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_hasswimmingpool'</span>, </span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_heatingtype'</span>, </span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_id', usefull to build time series, decrease and time on market indicator</span></span>
<span id="cb201-17"><a href="#cb201-17" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_isAuction'</span>, </span>
<span id="cb201-18"><a href="#cb201-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_modificationdate',</span></span>
<span id="cb201-19"><a href="#cb201-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_postalcode', layer showed better boxplot, drop in a first step</span></span>
<span id="cb201-20"><a href="#cb201-20" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_propertytype'</span>, </span>
<span id="cb201-21"><a href="#cb201-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_streetname', &gt;1300 street name, would be usefull if it allowed to join census or shapefile data</span></span>
<span id="cb201-22"><a href="#cb201-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_streetnumber',</span></span>
<span id="cb201-23"><a href="#cb201-23" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_streettype'</span>, </span>
<span id="cb201-24"><a href="#cb201-24" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_typologyname'</span>, </span>
<span id="cb201-25"><a href="#cb201-25" aria-hidden="true" tabindex="-1"></a><span class="co">#'last_seen_date', temporal features in another analysis</span></span>
<span id="cb201-26"><a href="#cb201-26" aria-hidden="true" tabindex="-1"></a><span class="co">#'layerlocation_area' 1 by layer</span></span>
<span id="cb201-27"><a href="#cb201-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 'ad_deactivationdate',</span></span>
<span id="cb201-28"><a href="#cb201-28" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb201-29"><a href="#cb201-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-30"><a href="#cb201-30" aria-hidden="true" tabindex="-1"></a>drop_features <span class="op">=</span> [</span>
<span id="cb201-31"><a href="#cb201-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 100% empty</span></span>
<span id="cb201-32"><a href="#cb201-32" aria-hidden="true" tabindex="-1"></a><span class="st">"newdevelopment_commercialname"</span>, </span>
<span id="cb201-33"><a href="#cb201-33" aria-hidden="true" tabindex="-1"></a><span class="st">"newdevelopment_fromprice"</span>,      </span>
<span id="cb201-34"><a href="#cb201-34" aria-hidden="true" tabindex="-1"></a><span class="st">"newdevelopment_averageprice"</span>,   </span>
<span id="cb201-35"><a href="#cb201-35" aria-hidden="true" tabindex="-1"></a><span class="st">"estate_cadastralroot"</span>,          </span>
<span id="cb201-36"><a href="#cb201-36" aria-hidden="true" tabindex="-1"></a><span class="st">"property_cadastralreference"</span>,   </span>
<span id="cb201-37"><a href="#cb201-37" aria-hidden="true" tabindex="-1"></a><span class="st">"property_builtdate"</span>,            </span>
<span id="cb201-38"><a href="#cb201-38" aria-hidden="true" tabindex="-1"></a><span class="st">"property_area"</span>,                 </span>
<span id="cb201-39"><a href="#cb201-39" aria-hidden="true" tabindex="-1"></a><span class="st">"property_use"</span>,                  </span>
<span id="cb201-40"><a href="#cb201-40" aria-hidden="true" tabindex="-1"></a><span class="st">"censustract_id"</span>,                </span>
<span id="cb201-41"><a href="#cb201-41" aria-hidden="true" tabindex="-1"></a><span class="st">"censustract_town_id"</span>,           </span>
<span id="cb201-42"><a href="#cb201-42" aria-hidden="true" tabindex="-1"></a><span class="st">"address_certainty"</span>,             </span>
<span id="cb201-43"><a href="#cb201-43" aria-hidden="true" tabindex="-1"></a><span class="st">"cadastral_certainty"</span>,           </span>
<span id="cb201-44"><a href="#cb201-44" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_ParkingIsIncludedInPrice"</span>,</span>
<span id="cb201-45"><a href="#cb201-45" aria-hidden="true" tabindex="-1"></a><span class="co"># constant value</span></span>
<span id="cb201-46"><a href="#cb201-46" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_state"</span>,                       </span>
<span id="cb201-47"><a href="#cb201-47" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_operation"</span>,</span>
<span id="cb201-48"><a href="#cb201-48" aria-hidden="true" tabindex="-1"></a><span class="st">"layerlocation_population"</span>,</span>
<span id="cb201-49"><a href="#cb201-49" aria-hidden="true" tabindex="-1"></a><span class="st">"country"</span>,</span>
<span id="cb201-50"><a href="#cb201-50" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_town"</span>,</span>
<span id="cb201-51"><a href="#cb201-51" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_province"</span>,</span>
<span id="cb201-52"><a href="#cb201-52" aria-hidden="true" tabindex="-1"></a><span class="co"># already transformed</span></span>
<span id="cb201-53"><a href="#cb201-53" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_typology"</span>,</span>
<span id="cb201-54"><a href="#cb201-54" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_subtypology"</span>,</span>
<span id="cb201-55"><a href="#cb201-55" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_builttype"</span>,</span>
<span id="cb201-56"><a href="#cb201-56" aria-hidden="true" tabindex="-1"></a><span class="co">#"ad_area",</span></span>
<span id="cb201-57"><a href="#cb201-57" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_floornumber"</span>,</span>
<span id="cb201-58"><a href="#cb201-58" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_constructionyear"</span>,</span>
<span id="cb201-59"><a href="#cb201-59" aria-hidden="true" tabindex="-1"></a><span class="st">"ad_layerlocation"</span>,</span>
<span id="cb201-60"><a href="#cb201-60" aria-hidden="true" tabindex="-1"></a><span class="co"># removed in a first step</span></span>
<span id="cb201-61"><a href="#cb201-61" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_activationdate'</span>, <span class="co">#temporal features in another analysis</span></span>
<span id="cb201-62"><a href="#cb201-62" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_addressvisible'</span>,</span>
<span id="cb201-63"><a href="#cb201-63" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_id'</span>, <span class="co">#usefull to build time series, decrease and time on market indicato</span></span>
<span id="cb201-64"><a href="#cb201-64" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_modificationdate'</span>,</span>
<span id="cb201-65"><a href="#cb201-65" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_postalcode'</span>, <span class="co">#layer showed better boxplot, drop in a first step</span></span>
<span id="cb201-66"><a href="#cb201-66" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_streetname'</span>, <span class="co">#&gt;1300 street name, would be usefull if it allowed to join census or shapefile data</span></span>
<span id="cb201-67"><a href="#cb201-67" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_streetnumber'</span>,</span>
<span id="cb201-68"><a href="#cb201-68" aria-hidden="true" tabindex="-1"></a><span class="st">'last_seen_date'</span>, <span class="co">#temporal features in another analysis</span></span>
<span id="cb201-69"><a href="#cb201-69" aria-hidden="true" tabindex="-1"></a><span class="st">'layerlocation_area'</span>, <span class="co">#1 by layer</span></span>
<span id="cb201-70"><a href="#cb201-70" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_deactivationdate'</span>,</span>
<span id="cb201-71"><a href="#cb201-71" aria-hidden="true" tabindex="-1"></a><span class="st">'ad_postalcodeid'</span> <span class="co">#layer showed better boxplot, drop in a first step</span></span>
<span id="cb201-72"><a href="#cb201-72" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb201-73"><a href="#cb201-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-74"><a href="#cb201-74" aria-hidden="true" tabindex="-1"></a>numerical_features <span class="op">=</span> [</span>
<span id="cb201-75"><a href="#cb201-75" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ad_area"</span>,</span>
<span id="cb201-76"><a href="#cb201-76" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ad_roomnumber"</span>,</span>
<span id="cb201-77"><a href="#cb201-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ad_bathnumber"</span>]</span>
<span id="cb201-78"><a href="#cb201-78" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> fetch_openml</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, OneHotEncoder</span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="co">#explicitly require this experimental feature</span></span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.experimental <span class="im">import</span> enable_iterative_imputer  <span class="co"># noqa</span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a><span class="co"># now you can import normally from sklearn.impute</span></span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> IterativeImputer, SimpleImputer</span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>numeric_features <span class="op">=</span> numerical_features</span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a>numeric_transformer <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'imputer'</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">"mean"</span>)),</span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'scaler'</span>, StandardScaler())])</span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> categorical_features</span>
<span id="cb202-15"><a href="#cb202-15" aria-hidden="true" tabindex="-1"></a>categorical_transformer <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'imputer'</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">'constant'</span>, fill_value<span class="op">=</span><span class="st">'missing'</span>)),</span>
<span id="cb202-16"><a href="#cb202-16" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'onehot'</span>, OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>))])</span>
<span id="cb202-17"><a href="#cb202-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-18"><a href="#cb202-18" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(transformers<span class="op">=</span>[</span>
<span id="cb202-19"><a href="#cb202-19" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'num'</span>, numeric_transformer, numeric_features),</span>
<span id="cb202-20"><a href="#cb202-20" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'cat'</span>, categorical_transformer, categorical_features)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Split train dataset for training (train/val) As it is in a time series context we should have been more cautious with the split of train/val dataset (avoid including future dates from val in train dataset). THings have been don properly for the test dataset.</p>
<div class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Split into validation and training data</span></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>X_train, X_val, y_train, y_val <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.1</span>, random_state<span class="op">=</span><span class="dv">1</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>X_train.shape, X_val.shape, y_train.shape,y_val.shape, X_test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="150">
<pre><code>((50526, 31), (5615, 31), (50526,), (5615,), (4788, 31))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline, Pipeline</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> catboost <span class="im">import</span> CatBoostRegressor</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>                      (<span class="st">'regressor'</span>, CatBoostRegressor(iterations<span class="op">=</span><span class="dv">1000</span>, learning_rate<span class="op">=</span><span class="fl">.1</span>, depth<span class="op">=</span><span class="dv">5</span>))])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="152">
<style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer()),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['ad_area', 'ad_roomnumber',
                                                   'ad_bathnumber']),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  ['ad_layerid', 'ad_areagroup',
                                                   'ad_builttypename',
                                                   'ad_constructionperiod',
                                                   'ad_flatlocation',
                                                   'ad_floor', 'ad_hasboxroom',
                                                   'ad_haslift',
                                                   'ad_hasparkingspace',
                                                   'ad_hasswimmingpool',
                                                   'ad_heatingtype',
                                                   'ad_isAuction',
                                                   'ad_propertytype',
                                                   'ad_streettype',
                                                   'ad_typologyname'])])),
                ('regressor',
                 &lt;catboost.core.CatBoostRegressor object at 0x30f662b60&gt;)])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox"><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer()),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['ad_area', 'ad_roomnumber',
                                                   'ad_bathnumber']),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  ['ad_layerid', 'ad_areagroup',
                                                   'ad_builttypename',
                                                   'ad_constructionperiod',
                                                   'ad_flatlocation',
                                                   'ad_floor', 'ad_hasboxroom',
                                                   'ad_haslift',
                                                   'ad_hasparkingspace',
                                                   'ad_hasswimmingpool',
                                                   'ad_heatingtype',
                                                   'ad_isAuction',
                                                   'ad_propertytype',
                                                   'ad_streettype',
                                                   'ad_typologyname'])])),
                ('regressor',
                 &lt;catboost.core.CatBoostRegressor object at 0x30f662b60&gt;)])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox"><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer', SimpleImputer()),
                                                 ('scaler', StandardScaler())]),
                                 ['ad_area', 'ad_roomnumber', 'ad_bathnumber']),
                                ('cat',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehot',
                                                  OneHotEncoder(handle_unknown='ignore'))]),
                                 ['ad_layerid', 'ad_areagroup',
                                  'ad_builttypename', 'ad_constructionperiod',
                                  'ad_flatlocation', 'ad_floor',
                                  'ad_hasboxroom', 'ad_haslift',
                                  'ad_hasparkingspace', 'ad_hasswimmingpool',
                                  'ad_heatingtype', 'ad_isAuction',
                                  'ad_propertytype', 'ad_streettype',
                                  'ad_typologyname'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox"><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">num</label><div class="sk-toggleable__content"><pre>['ad_area', 'ad_roomnumber', 'ad_bathnumber']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox"><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox"><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox"><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">cat</label><div class="sk-toggleable__content"><pre>['ad_layerid', 'ad_areagroup', 'ad_builttypename', 'ad_constructionperiod', 'ad_flatlocation', 'ad_floor', 'ad_hasboxroom', 'ad_haslift', 'ad_hasparkingspace', 'ad_hasswimmingpool', 'ad_heatingtype', 'ad_isAuction', 'ad_propertytype', 'ad_streettype', 'ad_typologyname']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox"><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox"><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox"><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">CatBoostRegressor</label><div class="sk-toggleable__content"><pre>&lt;catboost.core.CatBoostRegressor object at 0x30f662b60&gt;</pre></div></div></div></div></div></div></div>
</div>
</div>
<div class="cell" data-execution_count="153">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>X_train.head()</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>X_train.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 50526 entries, 26670 to 35937
Data columns (total 31 columns):
 #   Column                 Non-Null Count  Dtype   
---  ------                 --------------  -----   
 0   ad_id                  50526 non-null  object  
 1   ad_propertytype        50526 non-null  object  
 2   ad_activationdate      50526 non-null  object  
 3   ad_deactivationdate    7526 non-null   object  
 4   ad_modificationdate    50526 non-null  object  
 5   ad_layerlocation       50526 non-null  object  
 6   ad_postalcode          48308 non-null  float64 
 7   ad_streettype          39879 non-null  object  
 8   ad_streetname          41701 non-null  object  
 9   ad_streetnumber        26983 non-null  float64 
 10  ad_addressvisible      50526 non-null  int64   
 11  ad_area                50526 non-null  float64 
 12  ad_roomnumber          50526 non-null  int64   
 13  ad_bathnumber          50526 non-null  int64   
 14  ad_flatlocation        50526 non-null  object  
 15  ad_haslift             50526 non-null  object  
 16  ad_hasparkingspace     50526 non-null  object  
 17  ad_hasboxroom          50526 non-null  object  
 18  ad_hasswimmingpool     50526 non-null  object  
 19  layerlocation_area     50526 non-null  float64 
 20  ad_isAuction           50526 non-null  object  
 21  ad_constructionyear    16356 non-null  float64 
 22  ad_heatingtype         17501 non-null  object  
 23  last_seen_date         50526 non-null  object  
 24  ad_typologyname        50526 non-null  object  
 25  ad_builttypename       50526 non-null  object  
 26  ad_floor               41997 non-null  object  
 27  ad_constructionperiod  16356 non-null  category
 28  ad_areagroup           50526 non-null  category
 29  ad_postalcodeid        50526 non-null  object  
 30  ad_layerid             50526 non-null  object  
dtypes: category(2), float64(5), int64(3), object(21)
memory usage: 11.7+ MB</code></pre>
</div>
</div>
<div class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.score(X_train, y_train))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0:  learn: 1079.3637946 total: 58.1ms   remaining: 58.1s
1:  learn: 1051.8279919 total: 61.3ms   remaining: 30.6s
2:  learn: 1026.3953093 total: 64ms remaining: 21.3s
3:  learn: 1005.3905859 total: 66.4ms   remaining: 16.5s
4:  learn: 987.8636756  total: 68.9ms   remaining: 13.7s
5:  learn: 971.1731357  total: 71.3ms   remaining: 11.8s
6:  learn: 958.0835590  total: 73.5ms   remaining: 10.4s
7:  learn: 945.9585481  total: 75.8ms   remaining: 9.4s
8:  learn: 934.8563272  total: 78.6ms   remaining: 8.66s
9:  learn: 924.1002735  total: 80.7ms   remaining: 7.99s
10: learn: 915.8566954  total: 82.9ms   remaining: 7.45s
11: learn: 907.3849539  total: 85ms remaining: 7s
12: learn: 900.5863706  total: 87.3ms   remaining: 6.63s
13: learn: 893.3592573  total: 89.5ms   remaining: 6.3s
14: learn: 886.6506942  total: 91.7ms   remaining: 6.02s
15: learn: 879.1607335  total: 94.2ms   remaining: 5.79s
16: learn: 873.8242732  total: 97ms remaining: 5.61s
17: learn: 868.9087895  total: 99.8ms   remaining: 5.44s
18: learn: 862.0241790  total: 102ms    remaining: 5.26s
19: learn: 856.1795636  total: 104ms    remaining: 5.11s
20: learn: 851.5850531  total: 107ms    remaining: 4.97s
21: learn: 845.4753198  total: 109ms    remaining: 4.85s
22: learn: 840.8853727  total: 112ms    remaining: 4.78s
23: learn: 837.1597664  total: 114ms    remaining: 4.65s
24: learn: 833.3451667  total: 117ms    remaining: 4.56s
25: learn: 829.8831868  total: 119ms    remaining: 4.45s
26: learn: 825.7257416  total: 121ms    remaining: 4.35s
27: learn: 821.4507782  total: 123ms    remaining: 4.27s
28: learn: 818.2315584  total: 125ms    remaining: 4.19s
29: learn: 814.0368997  total: 127ms    remaining: 4.12s
30: learn: 809.9997549  total: 130ms    remaining: 4.05s
31: learn: 806.7085559  total: 132ms    remaining: 3.98s
32: learn: 804.0684322  total: 134ms    remaining: 3.92s
33: learn: 801.2995979  total: 136ms    remaining: 3.86s
34: learn: 798.4142560  total: 138ms    remaining: 3.81s
35: learn: 795.0720201  total: 141ms    remaining: 3.76s
36: learn: 791.9280333  total: 143ms    remaining: 3.72s
37: learn: 789.5772260  total: 145ms    remaining: 3.67s
38: learn: 787.1618765  total: 147ms    remaining: 3.63s
39: learn: 784.9784505  total: 149ms    remaining: 3.58s
40: learn: 781.9356233  total: 151ms    remaining: 3.54s
41: learn: 779.5089102  total: 154ms    remaining: 3.5s
42: learn: 777.1676189  total: 156ms    remaining: 3.47s
43: learn: 775.1553231  total: 158ms    remaining: 3.43s
44: learn: 772.8783836  total: 160ms    remaining: 3.39s
45: learn: 770.9166857  total: 162ms    remaining: 3.36s
46: learn: 768.9989203  total: 164ms    remaining: 3.33s
47: learn: 766.7504936  total: 167ms    remaining: 3.3s
48: learn: 764.7370523  total: 169ms    remaining: 3.27s
49: learn: 762.8178821  total: 171ms    remaining: 3.25s
50: learn: 761.2127654  total: 173ms    remaining: 3.22s
51: learn: 759.0840105  total: 175ms    remaining: 3.19s
52: learn: 757.7689543  total: 177ms    remaining: 3.16s
53: learn: 756.1516715  total: 179ms    remaining: 3.13s
54: learn: 754.4178201  total: 181ms    remaining: 3.11s
55: learn: 752.5497956  total: 183ms    remaining: 3.09s
56: learn: 750.8739642  total: 185ms    remaining: 3.07s
57: learn: 749.3555381  total: 187ms    remaining: 3.04s
58: learn: 747.8267971  total: 190ms    remaining: 3.03s
59: learn: 746.1142716  total: 192ms    remaining: 3.01s
60: learn: 744.8302649  total: 195ms    remaining: 3s
61: learn: 743.0025443  total: 197ms    remaining: 2.98s
62: learn: 741.6464306  total: 199ms    remaining: 2.96s
63: learn: 740.1620481  total: 201ms    remaining: 2.95s
64: learn: 738.8442972  total: 204ms    remaining: 2.93s
65: learn: 737.1222735  total: 206ms    remaining: 2.91s
66: learn: 735.9286328  total: 208ms    remaining: 2.9s
67: learn: 734.8170957  total: 210ms    remaining: 2.88s
68: learn: 733.2389797  total: 212ms    remaining: 2.86s
69: learn: 732.0562477  total: 214ms    remaining: 2.84s
70: learn: 731.1556645  total: 216ms    remaining: 2.83s
71: learn: 729.5685160  total: 219ms    remaining: 2.82s
72: learn: 728.3111744  total: 221ms    remaining: 2.8s
73: learn: 727.1363443  total: 223ms    remaining: 2.79s
74: learn: 726.3400235  total: 225ms    remaining: 2.77s
75: learn: 725.4131281  total: 227ms    remaining: 2.76s
76: learn: 724.4182533  total: 230ms    remaining: 2.75s
77: learn: 723.2054556  total: 232ms    remaining: 2.74s
78: learn: 721.7925337  total: 234ms    remaining: 2.73s
79: learn: 720.2877329  total: 236ms    remaining: 2.72s
80: learn: 719.2935853  total: 239ms    remaining: 2.71s
81: learn: 718.3083096  total: 241ms    remaining: 2.7s
82: learn: 717.3031135  total: 244ms    remaining: 2.69s
83: learn: 716.4400105  total: 246ms    remaining: 2.68s
84: learn: 715.1991264  total: 248ms    remaining: 2.67s
85: learn: 714.4484381  total: 251ms    remaining: 2.66s
86: learn: 713.5770914  total: 253ms    remaining: 2.65s
87: learn: 712.8998465  total: 256ms    remaining: 2.65s
88: learn: 711.9948749  total: 258ms    remaining: 2.64s
89: learn: 711.1580540  total: 260ms    remaining: 2.62s
90: learn: 709.6130499  total: 262ms    remaining: 2.61s
91: learn: 708.4268119  total: 264ms    remaining: 2.6s
92: learn: 707.5520856  total: 266ms    remaining: 2.59s
93: learn: 706.4543568  total: 268ms    remaining: 2.58s
94: learn: 705.7153004  total: 270ms    remaining: 2.57s
95: learn: 704.7270712  total: 273ms    remaining: 2.57s
96: learn: 703.7809507  total: 276ms    remaining: 2.57s
97: learn: 703.1153099  total: 278ms    remaining: 2.56s
98: learn: 701.9567493  total: 281ms    remaining: 2.56s
99: learn: 701.2999519  total: 283ms    remaining: 2.55s
100:    learn: 700.4969016  total: 285ms    remaining: 2.54s
101:    learn: 699.5863061  total: 287ms    remaining: 2.53s
102:    learn: 698.9653085  total: 290ms    remaining: 2.52s
103:    learn: 697.9520035  total: 292ms    remaining: 2.51s
104:    learn: 696.7483697  total: 294ms    remaining: 2.51s
105:    learn: 695.8349291  total: 296ms    remaining: 2.5s
106:    learn: 695.0532564  total: 298ms    remaining: 2.49s
107:    learn: 694.4217834  total: 301ms    remaining: 2.48s
108:    learn: 693.5183789  total: 303ms    remaining: 2.47s
109:    learn: 692.8855529  total: 305ms    remaining: 2.46s
110:    learn: 692.0235570  total: 307ms    remaining: 2.46s
111:    learn: 691.0361731  total: 309ms    remaining: 2.45s
112:    learn: 690.3929060  total: 312ms    remaining: 2.44s
113:    learn: 689.3760740  total: 314ms    remaining: 2.44s
114:    learn: 688.7404816  total: 316ms    remaining: 2.43s
115:    learn: 687.8645783  total: 318ms    remaining: 2.43s
116:    learn: 686.9522445  total: 321ms    remaining: 2.42s
117:    learn: 685.9143119  total: 323ms    remaining: 2.42s
118:    learn: 685.1585554  total: 326ms    remaining: 2.41s
119:    learn: 684.2260708  total: 328ms    remaining: 2.4s
120:    learn: 683.3309585  total: 331ms    remaining: 2.4s
121:    learn: 682.6518541  total: 333ms    remaining: 2.4s
122:    learn: 682.1174649  total: 335ms    remaining: 2.39s
123:    learn: 681.5427846  total: 339ms    remaining: 2.39s
124:    learn: 680.7084054  total: 341ms    remaining: 2.39s
125:    learn: 679.7136278  total: 343ms    remaining: 2.38s
126:    learn: 678.9812497  total: 346ms    remaining: 2.38s
127:    learn: 678.1769549  total: 348ms    remaining: 2.37s
128:    learn: 677.5157809  total: 350ms    remaining: 2.36s
129:    learn: 676.8580546  total: 352ms    remaining: 2.36s
130:    learn: 676.3826906  total: 355ms    remaining: 2.35s
131:    learn: 675.8549396  total: 357ms    remaining: 2.35s
132:    learn: 674.7702455  total: 359ms    remaining: 2.34s
133:    learn: 673.9557717  total: 362ms    remaining: 2.34s
134:    learn: 673.3182947  total: 364ms    remaining: 2.33s
135:    learn: 672.7947678  total: 367ms    remaining: 2.33s
136:    learn: 672.0605005  total: 369ms    remaining: 2.32s
137:    learn: 671.3004564  total: 371ms    remaining: 2.32s
138:    learn: 670.4060440  total: 374ms    remaining: 2.31s
139:    learn: 669.6803539  total: 376ms    remaining: 2.31s
140:    learn: 669.0413724  total: 379ms    remaining: 2.31s
141:    learn: 668.4428001  total: 382ms    remaining: 2.31s
142:    learn: 667.9218481  total: 384ms    remaining: 2.3s
143:    learn: 667.2533832  total: 387ms    remaining: 2.3s
144:    learn: 666.4988619  total: 389ms    remaining: 2.29s
145:    learn: 665.9005483  total: 392ms    remaining: 2.29s
146:    learn: 665.0054205  total: 394ms    remaining: 2.29s
147:    learn: 664.1407669  total: 397ms    remaining: 2.28s
148:    learn: 663.2591194  total: 399ms    remaining: 2.28s
149:    learn: 662.7627756  total: 402ms    remaining: 2.27s
150:    learn: 662.0631584  total: 404ms    remaining: 2.27s
151:    learn: 661.4624230  total: 406ms    remaining: 2.27s
152:    learn: 660.9527872  total: 409ms    remaining: 2.26s
153:    learn: 660.4016148  total: 412ms    remaining: 2.26s
154:    learn: 659.8546176  total: 414ms    remaining: 2.26s
155:    learn: 659.2889479  total: 416ms    remaining: 2.25s
156:    learn: 658.8749600  total: 419ms    remaining: 2.25s
157:    learn: 658.3945980  total: 421ms    remaining: 2.24s
158:    learn: 657.8106113  total: 424ms    remaining: 2.24s
159:    learn: 657.3351542  total: 426ms    remaining: 2.23s
160:    learn: 656.1256759  total: 428ms    remaining: 2.23s
161:    learn: 655.6291282  total: 431ms    remaining: 2.23s
162:    learn: 655.2943982  total: 433ms    remaining: 2.22s
163:    learn: 654.6661242  total: 435ms    remaining: 2.22s
164:    learn: 653.9850010  total: 438ms    remaining: 2.21s
165:    learn: 653.5519618  total: 440ms    remaining: 2.21s
166:    learn: 653.1814309  total: 442ms    remaining: 2.21s
167:    learn: 652.5702668  total: 445ms    remaining: 2.2s
168:    learn: 652.0294983  total: 447ms    remaining: 2.2s
169:    learn: 651.5483943  total: 449ms    remaining: 2.19s
170:    learn: 650.9948942  total: 452ms    remaining: 2.19s
171:    learn: 650.4901225  total: 454ms    remaining: 2.19s
172:    learn: 649.9105889  total: 457ms    remaining: 2.19s
173:    learn: 649.4170094  total: 460ms    remaining: 2.18s
174:    learn: 648.9417142  total: 462ms    remaining: 2.18s
175:    learn: 648.4201233  total: 464ms    remaining: 2.17s
176:    learn: 648.0231129  total: 466ms    remaining: 2.17s
177:    learn: 647.5650836  total: 468ms    remaining: 2.16s
178:    learn: 646.9432597  total: 470ms    remaining: 2.15s
179:    learn: 646.3181863  total: 473ms    remaining: 2.15s
180:    learn: 645.5368826  total: 475ms    remaining: 2.15s
181:    learn: 645.1991564  total: 477ms    remaining: 2.14s
182:    learn: 644.6228320  total: 480ms    remaining: 2.14s
183:    learn: 644.1911010  total: 482ms    remaining: 2.14s
184:    learn: 643.6214250  total: 485ms    remaining: 2.13s
185:    learn: 643.0496701  total: 487ms    remaining: 2.13s
186:    learn: 642.7192672  total: 489ms    remaining: 2.13s
187:    learn: 642.2490802  total: 491ms    remaining: 2.12s
188:    learn: 641.9044393  total: 493ms    remaining: 2.12s
189:    learn: 641.4705562  total: 496ms    remaining: 2.11s
190:    learn: 641.0068705  total: 498ms    remaining: 2.11s
191:    learn: 640.3924464  total: 500ms    remaining: 2.1s
192:    learn: 639.9525661  total: 502ms    remaining: 2.1s
193:    learn: 639.1993329  total: 505ms    remaining: 2.1s
194:    learn: 638.6919104  total: 507ms    remaining: 2.09s
195:    learn: 638.2814827  total: 509ms    remaining: 2.09s
196:    learn: 637.9019438  total: 511ms    remaining: 2.08s
197:    learn: 637.2646653  total: 513ms    remaining: 2.08s
198:    learn: 636.7847664  total: 515ms    remaining: 2.07s
199:    learn: 636.3757910  total: 517ms    remaining: 2.07s
200:    learn: 635.9748014  total: 519ms    remaining: 2.06s
201:    learn: 635.4277023  total: 522ms    remaining: 2.06s
202:    learn: 634.9176635  total: 524ms    remaining: 2.06s
203:    learn: 634.2404002  total: 526ms    remaining: 2.05s
204:    learn: 633.8787479  total: 528ms    remaining: 2.05s
205:    learn: 633.5814154  total: 530ms    remaining: 2.04s
206:    learn: 633.2737620  total: 533ms    remaining: 2.04s
207:    learn: 632.8698828  total: 535ms    remaining: 2.04s
208:    learn: 632.4481469  total: 537ms    remaining: 2.03s
209:    learn: 632.0177058  total: 539ms    remaining: 2.03s
210:    learn: 631.5881920  total: 541ms    remaining: 2.02s
211:    learn: 631.1650599  total: 544ms    remaining: 2.02s
212:    learn: 630.8503525  total: 546ms    remaining: 2.02s
213:    learn: 630.4408384  total: 548ms    remaining: 2.01s
214:    learn: 630.0601234  total: 551ms    remaining: 2.01s
215:    learn: 629.5968278  total: 553ms    remaining: 2.01s
216:    learn: 629.3320087  total: 555ms    remaining: 2s
217:    learn: 628.9239965  total: 558ms    remaining: 2s
218:    learn: 628.6460464  total: 560ms    remaining: 2s
219:    learn: 628.2228976  total: 563ms    remaining: 1.99s
220:    learn: 627.7368288  total: 566ms    remaining: 1.99s
221:    learn: 627.4939602  total: 568ms    remaining: 1.99s
222:    learn: 627.1061782  total: 570ms    remaining: 1.99s
223:    learn: 626.6670423  total: 572ms    remaining: 1.98s
224:    learn: 626.3127076  total: 575ms    remaining: 1.98s
225:    learn: 625.7591464  total: 577ms    remaining: 1.98s
226:    learn: 625.3334350  total: 580ms    remaining: 1.97s
227:    learn: 625.0114411  total: 582ms    remaining: 1.97s
228:    learn: 624.6869657  total: 584ms    remaining: 1.97s
229:    learn: 624.2101082  total: 586ms    remaining: 1.96s
230:    learn: 623.6524286  total: 588ms    remaining: 1.96s
231:    learn: 623.3646972  total: 590ms    remaining: 1.95s
232:    learn: 622.8436172  total: 592ms    remaining: 1.95s
233:    learn: 622.4932673  total: 595ms    remaining: 1.95s
234:    learn: 622.2310662  total: 598ms    remaining: 1.95s
235:    learn: 621.6274747  total: 600ms    remaining: 1.94s
236:    learn: 621.2704891  total: 602ms    remaining: 1.94s
237:    learn: 620.9158061  total: 605ms    remaining: 1.94s
238:    learn: 620.4949722  total: 607ms    remaining: 1.93s
239:    learn: 620.1008168  total: 609ms    remaining: 1.93s
240:    learn: 619.7336394  total: 611ms    remaining: 1.93s
241:    learn: 619.2165364  total: 614ms    remaining: 1.92s
242:    learn: 618.8841488  total: 616ms    remaining: 1.92s
243:    learn: 618.5245477  total: 618ms    remaining: 1.91s
244:    learn: 617.9500955  total: 620ms    remaining: 1.91s
245:    learn: 617.6768871  total: 623ms    remaining: 1.91s
246:    learn: 617.4136339  total: 625ms    remaining: 1.9s
247:    learn: 616.9571018  total: 627ms    remaining: 1.9s
248:    learn: 616.7209680  total: 629ms    remaining: 1.9s
249:    learn: 616.4079431  total: 632ms    remaining: 1.89s
250:    learn: 615.7970203  total: 634ms    remaining: 1.89s
251:    learn: 615.3944312  total: 636ms    remaining: 1.89s
252:    learn: 614.9881378  total: 638ms    remaining: 1.88s
253:    learn: 614.5229915  total: 640ms    remaining: 1.88s
254:    learn: 613.9611533  total: 643ms    remaining: 1.88s
255:    learn: 613.6011894  total: 645ms    remaining: 1.88s
256:    learn: 613.2911489  total: 648ms    remaining: 1.87s
257:    learn: 612.9029785  total: 650ms    remaining: 1.87s
258:    learn: 612.5639459  total: 653ms    remaining: 1.87s
259:    learn: 612.3859645  total: 655ms    remaining: 1.86s
260:    learn: 611.9938026  total: 658ms    remaining: 1.86s
261:    learn: 611.5092449  total: 660ms    remaining: 1.86s
262:    learn: 611.0873130  total: 662ms    remaining: 1.86s
263:    learn: 610.6178067  total: 665ms    remaining: 1.85s
264:    learn: 610.1509407  total: 667ms    remaining: 1.85s
265:    learn: 609.7827193  total: 669ms    remaining: 1.85s
266:    learn: 609.6361776  total: 672ms    remaining: 1.84s
267:    learn: 609.4642162  total: 674ms    remaining: 1.84s
268:    learn: 609.2380920  total: 677ms    remaining: 1.84s
269:    learn: 609.0034722  total: 680ms    remaining: 1.84s
270:    learn: 608.6882083  total: 682ms    remaining: 1.83s
271:    learn: 608.3444496  total: 685ms    remaining: 1.83s
272:    learn: 607.8909666  total: 687ms    remaining: 1.83s
273:    learn: 607.4269664  total: 689ms    remaining: 1.83s
274:    learn: 607.0945608  total: 692ms    remaining: 1.82s
275:    learn: 606.8399123  total: 694ms    remaining: 1.82s
276:    learn: 606.5359015  total: 696ms    remaining: 1.82s
277:    learn: 606.1527448  total: 698ms    remaining: 1.81s
278:    learn: 605.7185981  total: 701ms    remaining: 1.81s
279:    learn: 605.2140619  total: 704ms    remaining: 1.81s
280:    learn: 604.9124300  total: 706ms    remaining: 1.8s
281:    learn: 604.5859398  total: 708ms    remaining: 1.8s
282:    learn: 604.2578387  total: 710ms    remaining: 1.8s
283:    learn: 603.8697414  total: 713ms    remaining: 1.8s
284:    learn: 603.5671261  total: 715ms    remaining: 1.79s
285:    learn: 603.1134389  total: 717ms    remaining: 1.79s
286:    learn: 602.7875038  total: 719ms    remaining: 1.79s
287:    learn: 602.4814995  total: 721ms    remaining: 1.78s
288:    learn: 602.2133900  total: 724ms    remaining: 1.78s
289:    learn: 601.9071306  total: 726ms    remaining: 1.78s
290:    learn: 601.7395543  total: 728ms    remaining: 1.77s
291:    learn: 601.2555070  total: 730ms    remaining: 1.77s
292:    learn: 600.9653501  total: 733ms    remaining: 1.77s
293:    learn: 600.7699734  total: 735ms    remaining: 1.76s
294:    learn: 600.2520912  total: 737ms    remaining: 1.76s
295:    learn: 599.7556062  total: 739ms    remaining: 1.76s
296:    learn: 599.5277482  total: 742ms    remaining: 1.75s
297:    learn: 599.3490372  total: 744ms    remaining: 1.75s
298:    learn: 599.0590155  total: 747ms    remaining: 1.75s
299:    learn: 598.8404283  total: 749ms    remaining: 1.75s
300:    learn: 598.5336436  total: 752ms    remaining: 1.75s
301:    learn: 598.2533142  total: 754ms    remaining: 1.74s
302:    learn: 598.0331051  total: 756ms    remaining: 1.74s
303:    learn: 597.5227312  total: 758ms    remaining: 1.74s
304:    learn: 597.3357855  total: 760ms    remaining: 1.73s
305:    learn: 597.1385064  total: 763ms    remaining: 1.73s
306:    learn: 596.8962993  total: 765ms    remaining: 1.73s
307:    learn: 596.6121345  total: 768ms    remaining: 1.72s
308:    learn: 596.2841753  total: 770ms    remaining: 1.72s
309:    learn: 596.0194358  total: 772ms    remaining: 1.72s
310:    learn: 595.6961695  total: 774ms    remaining: 1.72s
311:    learn: 595.4089003  total: 777ms    remaining: 1.71s
312:    learn: 595.1130210  total: 779ms    remaining: 1.71s
313:    learn: 594.9272646  total: 781ms    remaining: 1.71s
314:    learn: 594.6665084  total: 784ms    remaining: 1.7s
315:    learn: 594.5117160  total: 786ms    remaining: 1.7s
316:    learn: 594.3255810  total: 788ms    remaining: 1.7s
317:    learn: 593.5621551  total: 790ms    remaining: 1.69s
318:    learn: 593.1918449  total: 793ms    remaining: 1.69s
319:    learn: 592.9695124  total: 795ms    remaining: 1.69s
320:    learn: 592.7091291  total: 798ms    remaining: 1.69s
321:    learn: 592.5230891  total: 800ms    remaining: 1.69s
322:    learn: 592.2990267  total: 802ms    remaining: 1.68s
323:    learn: 591.5398781  total: 804ms    remaining: 1.68s
324:    learn: 591.1819411  total: 807ms    remaining: 1.68s
325:    learn: 590.9128096  total: 809ms    remaining: 1.67s
326:    learn: 590.7361461  total: 812ms    remaining: 1.67s
327:    learn: 590.5746580  total: 814ms    remaining: 1.67s
328:    learn: 590.3592059  total: 816ms    remaining: 1.66s
329:    learn: 590.0970030  total: 818ms    remaining: 1.66s
330:    learn: 589.7806566  total: 820ms    remaining: 1.66s
331:    learn: 589.4718848  total: 822ms    remaining: 1.65s
332:    learn: 589.1563902  total: 825ms    remaining: 1.65s
333:    learn: 588.9317969  total: 827ms    remaining: 1.65s
334:    learn: 588.7296474  total: 829ms    remaining: 1.65s
335:    learn: 587.7589074  total: 832ms    remaining: 1.64s
336:    learn: 587.5975729  total: 834ms    remaining: 1.64s
337:    learn: 587.3413552  total: 837ms    remaining: 1.64s
338:    learn: 586.9598913  total: 839ms    remaining: 1.64s
339:    learn: 586.7175582  total: 841ms    remaining: 1.63s
340:    learn: 586.4226159  total: 844ms    remaining: 1.63s
341:    learn: 586.0984237  total: 846ms    remaining: 1.63s
342:    learn: 585.8953903  total: 848ms    remaining: 1.62s
343:    learn: 585.6519211  total: 850ms    remaining: 1.62s
344:    learn: 585.5056370  total: 852ms    remaining: 1.62s
345:    learn: 585.2581405  total: 854ms    remaining: 1.61s
346:    learn: 585.0345839  total: 857ms    remaining: 1.61s
347:    learn: 584.7947318  total: 860ms    remaining: 1.61s
348:    learn: 584.4872220  total: 862ms    remaining: 1.61s
349:    learn: 584.1479525  total: 864ms    remaining: 1.6s
350:    learn: 583.8723501  total: 866ms    remaining: 1.6s
351:    learn: 583.7335825  total: 869ms    remaining: 1.6s
352:    learn: 583.6079403  total: 871ms    remaining: 1.6s
353:    learn: 583.4262240  total: 874ms    remaining: 1.59s
354:    learn: 583.1629209  total: 876ms    remaining: 1.59s
355:    learn: 582.9480755  total: 879ms    remaining: 1.59s
356:    learn: 582.7242100  total: 882ms    remaining: 1.59s
357:    learn: 582.4101801  total: 884ms    remaining: 1.59s
358:    learn: 582.2616204  total: 889ms    remaining: 1.59s
359:    learn: 581.9785383  total: 892ms    remaining: 1.59s
360:    learn: 581.8215863  total: 895ms    remaining: 1.58s
361:    learn: 581.5637389  total: 898ms    remaining: 1.58s
362:    learn: 581.3701255  total: 901ms    remaining: 1.58s
363:    learn: 581.0248250  total: 904ms    remaining: 1.58s
364:    learn: 580.8927280  total: 907ms    remaining: 1.58s
365:    learn: 580.4333521  total: 915ms    remaining: 1.58s
366:    learn: 580.2812866  total: 918ms    remaining: 1.58s
367:    learn: 580.0403555  total: 921ms    remaining: 1.58s
368:    learn: 579.8684145  total: 925ms    remaining: 1.58s
369:    learn: 579.5748364  total: 928ms    remaining: 1.58s
370:    learn: 579.4543422  total: 932ms    remaining: 1.58s
371:    learn: 579.2959383  total: 936ms    remaining: 1.58s
372:    learn: 579.1030492  total: 939ms    remaining: 1.58s
373:    learn: 578.8815230  total: 942ms    remaining: 1.58s
374:    learn: 578.6572433  total: 945ms    remaining: 1.57s
375:    learn: 578.2361314  total: 948ms    remaining: 1.57s
376:    learn: 578.0756022  total: 950ms    remaining: 1.57s
377:    learn: 577.9121363  total: 952ms    remaining: 1.57s
378:    learn: 577.6526313  total: 954ms    remaining: 1.56s
379:    learn: 577.4736539  total: 956ms    remaining: 1.56s
380:    learn: 577.2209077  total: 959ms    remaining: 1.56s
381:    learn: 576.4212816  total: 961ms    remaining: 1.55s
382:    learn: 576.1519396  total: 963ms    remaining: 1.55s
383:    learn: 575.8131374  total: 966ms    remaining: 1.55s
384:    learn: 575.6380111  total: 968ms    remaining: 1.55s
385:    learn: 575.3449592  total: 970ms    remaining: 1.54s
386:    learn: 575.1414046  total: 972ms    remaining: 1.54s
387:    learn: 574.8453200  total: 975ms    remaining: 1.54s
388:    learn: 574.7387000  total: 977ms    remaining: 1.53s
389:    learn: 574.3750389  total: 979ms    remaining: 1.53s
390:    learn: 574.1955702  total: 981ms    remaining: 1.53s
391:    learn: 573.8714440  total: 983ms    remaining: 1.52s
392:    learn: 573.3177821  total: 986ms    remaining: 1.52s
393:    learn: 573.1018099  total: 988ms    remaining: 1.52s
394:    learn: 572.9042370  total: 990ms    remaining: 1.52s
395:    learn: 572.7418305  total: 993ms    remaining: 1.51s
396:    learn: 572.5857385  total: 995ms    remaining: 1.51s
397:    learn: 572.3362517  total: 997ms    remaining: 1.51s
398:    learn: 572.1306072  total: 999ms    remaining: 1.5s
399:    learn: 571.9994109  total: 1s   remaining: 1.5s
400:    learn: 571.7591756  total: 1s   remaining: 1.5s
401:    learn: 571.2477204  total: 1.01s    remaining: 1.5s
402:    learn: 570.9782345  total: 1.01s    remaining: 1.49s
403:    learn: 570.7298575  total: 1.01s    remaining: 1.49s
404:    learn: 570.5961137  total: 1.01s    remaining: 1.49s
405:    learn: 570.3995710  total: 1.01s    remaining: 1.49s
406:    learn: 570.1127636  total: 1.02s    remaining: 1.48s
407:    learn: 569.8778037  total: 1.02s    remaining: 1.48s
408:    learn: 569.7097154  total: 1.02s    remaining: 1.48s
409:    learn: 569.4962157  total: 1.02s    remaining: 1.47s
410:    learn: 569.1144233  total: 1.03s    remaining: 1.47s
411:    learn: 568.8829725  total: 1.03s    remaining: 1.47s
412:    learn: 568.7786172  total: 1.03s    remaining: 1.47s
413:    learn: 568.5826783  total: 1.03s    remaining: 1.46s
414:    learn: 568.3253291  total: 1.03s    remaining: 1.46s
415:    learn: 568.0775673  total: 1.04s    remaining: 1.46s
416:    learn: 567.8132920  total: 1.04s    remaining: 1.45s
417:    learn: 567.6689372  total: 1.04s    remaining: 1.45s
418:    learn: 567.3448434  total: 1.04s    remaining: 1.45s
419:    learn: 566.8672732  total: 1.05s    remaining: 1.45s
420:    learn: 566.5995558  total: 1.05s    remaining: 1.44s
421:    learn: 566.3802277  total: 1.05s    remaining: 1.44s
422:    learn: 566.1652096  total: 1.05s    remaining: 1.44s
423:    learn: 565.9975281  total: 1.06s    remaining: 1.44s
424:    learn: 565.8110275  total: 1.06s    remaining: 1.43s
425:    learn: 565.5590368  total: 1.06s    remaining: 1.43s
426:    learn: 565.3511613  total: 1.06s    remaining: 1.43s
427:    learn: 565.0508696  total: 1.07s    remaining: 1.42s
428:    learn: 564.8992256  total: 1.07s    remaining: 1.42s
429:    learn: 564.7530224  total: 1.07s    remaining: 1.42s
430:    learn: 564.3657104  total: 1.07s    remaining: 1.42s
431:    learn: 564.2237376  total: 1.07s    remaining: 1.41s
432:    learn: 563.9297914  total: 1.08s    remaining: 1.41s
433:    learn: 563.6508639  total: 1.08s    remaining: 1.41s
434:    learn: 563.4473301  total: 1.08s    remaining: 1.41s
435:    learn: 563.1967697  total: 1.08s    remaining: 1.4s
436:    learn: 563.0763763  total: 1.09s    remaining: 1.4s
437:    learn: 562.9039498  total: 1.09s    remaining: 1.4s
438:    learn: 562.7290142  total: 1.09s    remaining: 1.4s
439:    learn: 562.5934772  total: 1.09s    remaining: 1.39s
440:    learn: 562.3428103  total: 1.1s remaining: 1.39s
441:    learn: 562.0866288  total: 1.1s remaining: 1.39s
442:    learn: 561.9281947  total: 1.1s remaining: 1.38s
443:    learn: 561.2720734  total: 1.1s remaining: 1.38s
444:    learn: 561.0997061  total: 1.1s remaining: 1.38s
445:    learn: 560.9584664  total: 1.11s    remaining: 1.38s
446:    learn: 560.8538909  total: 1.11s    remaining: 1.37s
447:    learn: 560.6680263  total: 1.11s    remaining: 1.37s
448:    learn: 560.5056933  total: 1.11s    remaining: 1.37s
449:    learn: 560.4127724  total: 1.12s    remaining: 1.36s
450:    learn: 560.2108717  total: 1.12s    remaining: 1.36s
451:    learn: 560.0462773  total: 1.12s    remaining: 1.36s
452:    learn: 559.7753038  total: 1.12s    remaining: 1.35s
453:    learn: 559.6169718  total: 1.13s    remaining: 1.35s
454:    learn: 559.4609338  total: 1.13s    remaining: 1.35s
455:    learn: 559.1911076  total: 1.13s    remaining: 1.35s
456:    learn: 558.9663213  total: 1.13s    remaining: 1.34s
457:    learn: 558.7305134  total: 1.13s    remaining: 1.34s
458:    learn: 558.5396793  total: 1.14s    remaining: 1.34s
459:    learn: 558.3702899  total: 1.14s    remaining: 1.33s
460:    learn: 558.2216860  total: 1.14s    remaining: 1.33s
461:    learn: 557.8626403  total: 1.14s    remaining: 1.33s
462:    learn: 557.7097341  total: 1.14s    remaining: 1.33s
463:    learn: 557.5537952  total: 1.15s    remaining: 1.32s
464:    learn: 557.3755080  total: 1.15s    remaining: 1.32s
465:    learn: 557.2533368  total: 1.15s    remaining: 1.32s
466:    learn: 557.1117023  total: 1.15s    remaining: 1.32s
467:    learn: 556.8440606  total: 1.16s    remaining: 1.31s
468:    learn: 556.6281167  total: 1.16s    remaining: 1.31s
469:    learn: 556.3626259  total: 1.16s    remaining: 1.31s
470:    learn: 556.2003095  total: 1.16s    remaining: 1.3s
471:    learn: 556.0037534  total: 1.16s    remaining: 1.3s
472:    learn: 555.9048519  total: 1.17s    remaining: 1.3s
473:    learn: 555.7104591  total: 1.17s    remaining: 1.3s
474:    learn: 555.5048414  total: 1.17s    remaining: 1.29s
475:    learn: 555.3814071  total: 1.17s    remaining: 1.29s
476:    learn: 555.2405967  total: 1.18s    remaining: 1.29s
477:    learn: 555.1159769  total: 1.18s    remaining: 1.29s
478:    learn: 554.9350304  total: 1.18s    remaining: 1.28s
479:    learn: 554.6983355  total: 1.18s    remaining: 1.28s
480:    learn: 554.5006678  total: 1.18s    remaining: 1.28s
481:    learn: 554.3198925  total: 1.19s    remaining: 1.27s
482:    learn: 554.1967344  total: 1.19s    remaining: 1.27s
483:    learn: 554.0320868  total: 1.19s    remaining: 1.27s
484:    learn: 553.8461498  total: 1.19s    remaining: 1.27s
485:    learn: 553.7266873  total: 1.2s remaining: 1.26s
486:    learn: 553.5558754  total: 1.2s remaining: 1.26s
487:    learn: 553.4442811  total: 1.2s remaining: 1.26s
488:    learn: 553.3237903  total: 1.2s remaining: 1.25s
489:    learn: 553.1639335  total: 1.2s remaining: 1.25s
490:    learn: 552.8168395  total: 1.21s    remaining: 1.25s
491:    learn: 552.7121695  total: 1.21s    remaining: 1.25s
492:    learn: 552.5496014  total: 1.21s    remaining: 1.24s
493:    learn: 552.3691229  total: 1.21s    remaining: 1.24s
494:    learn: 552.0662909  total: 1.21s    remaining: 1.24s
495:    learn: 551.8901477  total: 1.22s    remaining: 1.24s
496:    learn: 551.7326754  total: 1.22s    remaining: 1.23s
497:    learn: 551.6727091  total: 1.22s    remaining: 1.23s
498:    learn: 551.4951239  total: 1.22s    remaining: 1.23s
499:    learn: 551.3200132  total: 1.22s    remaining: 1.22s
500:    learn: 551.1022679  total: 1.23s    remaining: 1.22s
501:    learn: 550.9438905  total: 1.23s    remaining: 1.22s
502:    learn: 550.6452747  total: 1.23s    remaining: 1.22s
503:    learn: 550.5549264  total: 1.23s    remaining: 1.21s
504:    learn: 550.3756748  total: 1.24s    remaining: 1.21s
505:    learn: 550.2739093  total: 1.24s    remaining: 1.21s
506:    learn: 550.1857830  total: 1.24s    remaining: 1.21s
507:    learn: 549.9457312  total: 1.24s    remaining: 1.2s
508:    learn: 549.6901330  total: 1.24s    remaining: 1.2s
509:    learn: 549.5750095  total: 1.25s    remaining: 1.2s
510:    learn: 549.4518763  total: 1.25s    remaining: 1.2s
511:    learn: 549.2927659  total: 1.25s    remaining: 1.19s
512:    learn: 549.1358229  total: 1.25s    remaining: 1.19s
513:    learn: 548.8830091  total: 1.26s    remaining: 1.19s
514:    learn: 548.6854729  total: 1.26s    remaining: 1.19s
515:    learn: 548.4520229  total: 1.26s    remaining: 1.18s
516:    learn: 548.3317628  total: 1.26s    remaining: 1.18s
517:    learn: 548.1524607  total: 1.26s    remaining: 1.18s
518:    learn: 547.9951307  total: 1.27s    remaining: 1.17s
519:    learn: 547.7490502  total: 1.27s    remaining: 1.17s
520:    learn: 547.5458386  total: 1.27s    remaining: 1.17s
521:    learn: 547.3516469  total: 1.27s    remaining: 1.17s
522:    learn: 547.1473626  total: 1.28s    remaining: 1.16s
523:    learn: 547.0331886  total: 1.28s    remaining: 1.16s
524:    learn: 546.9336382  total: 1.28s    remaining: 1.16s
525:    learn: 546.8160313  total: 1.28s    remaining: 1.16s
526:    learn: 546.6817702  total: 1.28s    remaining: 1.15s
527:    learn: 546.4061889  total: 1.29s    remaining: 1.15s
528:    learn: 546.1696304  total: 1.29s    remaining: 1.15s
529:    learn: 546.0703164  total: 1.29s    remaining: 1.15s
530:    learn: 545.8784671  total: 1.29s    remaining: 1.14s
531:    learn: 545.7647239  total: 1.3s remaining: 1.14s
532:    learn: 545.6346273  total: 1.3s remaining: 1.14s
533:    learn: 545.4770621  total: 1.3s remaining: 1.13s
534:    learn: 545.3169183  total: 1.3s remaining: 1.13s
535:    learn: 545.0862590  total: 1.3s remaining: 1.13s
536:    learn: 544.9399937  total: 1.31s    remaining: 1.13s
537:    learn: 544.7391680  total: 1.31s    remaining: 1.12s
538:    learn: 544.6389602  total: 1.31s    remaining: 1.12s
539:    learn: 544.5097458  total: 1.31s    remaining: 1.12s
540:    learn: 544.2925686  total: 1.31s    remaining: 1.11s
541:    learn: 544.2366310  total: 1.32s    remaining: 1.11s
542:    learn: 544.0508262  total: 1.32s    remaining: 1.11s
543:    learn: 543.7573555  total: 1.32s    remaining: 1.11s
544:    learn: 543.5853220  total: 1.32s    remaining: 1.1s
545:    learn: 543.3068011  total: 1.32s    remaining: 1.1s
546:    learn: 543.2148080  total: 1.33s    remaining: 1.1s
547:    learn: 543.0795170  total: 1.33s    remaining: 1.1s
548:    learn: 542.8772563  total: 1.33s    remaining: 1.09s
549:    learn: 542.6559445  total: 1.33s    remaining: 1.09s
550:    learn: 542.5554030  total: 1.33s    remaining: 1.09s
551:    learn: 542.3743271  total: 1.34s    remaining: 1.08s
552:    learn: 542.2003005  total: 1.34s    remaining: 1.08s
553:    learn: 542.0194398  total: 1.34s    remaining: 1.08s
554:    learn: 541.8820463  total: 1.34s    remaining: 1.08s
555:    learn: 541.7669767  total: 1.34s    remaining: 1.07s
556:    learn: 541.6731352  total: 1.35s    remaining: 1.07s
557:    learn: 541.4146224  total: 1.35s    remaining: 1.07s
558:    learn: 541.1686726  total: 1.35s    remaining: 1.07s
559:    learn: 541.1424077  total: 1.35s    remaining: 1.06s
560:    learn: 540.9102586  total: 1.36s    remaining: 1.06s
561:    learn: 540.8130175  total: 1.36s    remaining: 1.06s
562:    learn: 540.7545335  total: 1.36s    remaining: 1.05s
563:    learn: 540.5821807  total: 1.36s    remaining: 1.05s
564:    learn: 540.4117969  total: 1.36s    remaining: 1.05s
565:    learn: 540.3183525  total: 1.37s    remaining: 1.05s
566:    learn: 540.2328623  total: 1.37s    remaining: 1.04s
567:    learn: 540.0691364  total: 1.37s    remaining: 1.04s
568:    learn: 539.9097169  total: 1.37s    remaining: 1.04s
569:    learn: 539.7859858  total: 1.37s    remaining: 1.04s
570:    learn: 539.6200428  total: 1.38s    remaining: 1.03s
571:    learn: 539.3773313  total: 1.38s    remaining: 1.03s
572:    learn: 539.2013104  total: 1.38s    remaining: 1.03s
573:    learn: 538.9914407  total: 1.38s    remaining: 1.03s
574:    learn: 538.9068841  total: 1.38s    remaining: 1.02s
575:    learn: 538.8792072  total: 1.39s    remaining: 1.02s
576:    learn: 538.6168336  total: 1.39s    remaining: 1.02s
577:    learn: 538.4686057  total: 1.39s    remaining: 1.01s
578:    learn: 538.4049822  total: 1.39s    remaining: 1.01s
579:    learn: 538.2278002  total: 1.4s remaining: 1.01s
580:    learn: 537.8914637  total: 1.4s remaining: 1.01s
581:    learn: 537.7458084  total: 1.4s remaining: 1s
582:    learn: 537.5006601  total: 1.4s remaining: 1s
583:    learn: 537.3826339  total: 1.4s remaining: 1s
584:    learn: 537.2528010  total: 1.41s    remaining: 998ms
585:    learn: 537.0104292  total: 1.41s    remaining: 995ms
586:    learn: 536.8910525  total: 1.41s    remaining: 993ms
587:    learn: 536.7813619  total: 1.41s    remaining: 990ms
588:    learn: 536.6249869  total: 1.42s    remaining: 988ms
589:    learn: 536.4874017  total: 1.42s    remaining: 986ms
590:    learn: 536.3201201  total: 1.42s    remaining: 983ms
591:    learn: 536.2206090  total: 1.42s    remaining: 981ms
592:    learn: 536.1296891  total: 1.43s    remaining: 978ms
593:    learn: 535.9722204  total: 1.43s    remaining: 976ms
594:    learn: 535.7910238  total: 1.43s    remaining: 973ms
595:    learn: 535.4518120  total: 1.43s    remaining: 971ms
596:    learn: 535.4253429  total: 1.43s    remaining: 968ms
597:    learn: 535.2887650  total: 1.44s    remaining: 966ms
598:    learn: 535.0857118  total: 1.44s    remaining: 963ms
599:    learn: 534.9524409  total: 1.44s    remaining: 960ms
600:    learn: 534.8587581  total: 1.44s    remaining: 958ms
601:    learn: 534.7342764  total: 1.44s    remaining: 955ms
602:    learn: 534.4749348  total: 1.45s    remaining: 953ms
603:    learn: 534.3367433  total: 1.45s    remaining: 950ms
604:    learn: 534.1840584  total: 1.45s    remaining: 948ms
605:    learn: 534.0711207  total: 1.45s    remaining: 945ms
606:    learn: 533.9540584  total: 1.46s    remaining: 943ms
607:    learn: 533.8152003  total: 1.46s    remaining: 941ms
608:    learn: 533.6387981  total: 1.46s    remaining: 938ms
609:    learn: 533.4356738  total: 1.46s    remaining: 936ms
610:    learn: 533.3232609  total: 1.47s    remaining: 933ms
611:    learn: 533.2061680  total: 1.47s    remaining: 931ms
612:    learn: 533.1169776  total: 1.47s    remaining: 928ms
613:    learn: 533.0125759  total: 1.47s    remaining: 926ms
614:    learn: 532.9393123  total: 1.47s    remaining: 923ms
615:    learn: 532.8808699  total: 1.48s    remaining: 921ms
616:    learn: 532.7021964  total: 1.48s    remaining: 918ms
617:    learn: 532.3996223  total: 1.48s    remaining: 916ms
618:    learn: 532.2571209  total: 1.48s    remaining: 913ms
619:    learn: 532.1820923  total: 1.49s    remaining: 911ms
620:    learn: 531.9902458  total: 1.49s    remaining: 909ms
621:    learn: 531.7081642  total: 1.49s    remaining: 906ms
622:    learn: 531.6112498  total: 1.49s    remaining: 904ms
623:    learn: 531.4801016  total: 1.5s remaining: 901ms
624:    learn: 531.3262795  total: 1.5s remaining: 899ms
625:    learn: 531.1221095  total: 1.5s remaining: 896ms
626:    learn: 531.0345953  total: 1.5s remaining: 894ms
627:    learn: 530.8637706  total: 1.5s remaining: 891ms
628:    learn: 530.7531123  total: 1.51s    remaining: 889ms
629:    learn: 530.6673595  total: 1.51s    remaining: 886ms
630:    learn: 530.6252390  total: 1.51s    remaining: 883ms
631:    learn: 530.5159214  total: 1.51s    remaining: 881ms
632:    learn: 530.4163380  total: 1.51s    remaining: 879ms
633:    learn: 530.1622041  total: 1.52s    remaining: 876ms
634:    learn: 530.0662998  total: 1.52s    remaining: 874ms
635:    learn: 529.6275763  total: 1.52s    remaining: 872ms
636:    learn: 529.4637837  total: 1.52s    remaining: 869ms
637:    learn: 529.2882155  total: 1.53s    remaining: 866ms
638:    learn: 529.1966228  total: 1.53s    remaining: 864ms
639:    learn: 528.9986927  total: 1.53s    remaining: 862ms
640:    learn: 528.8689010  total: 1.53s    remaining: 860ms
641:    learn: 528.7097566  total: 1.54s    remaining: 857ms
642:    learn: 528.6215209  total: 1.54s    remaining: 855ms
643:    learn: 528.4939476  total: 1.54s    remaining: 852ms
644:    learn: 528.3865582  total: 1.54s    remaining: 850ms
645:    learn: 528.2873536  total: 1.55s    remaining: 847ms
646:    learn: 528.0833155  total: 1.55s    remaining: 845ms
647:    learn: 527.9474500  total: 1.55s    remaining: 843ms
648:    learn: 527.8476862  total: 1.55s    remaining: 841ms
649:    learn: 527.6969907  total: 1.56s    remaining: 839ms
650:    learn: 527.5436170  total: 1.56s    remaining: 837ms
651:    learn: 527.4145138  total: 1.56s    remaining: 834ms
652:    learn: 527.2262398  total: 1.56s    remaining: 832ms
653:    learn: 527.1346573  total: 1.57s    remaining: 829ms
654:    learn: 527.0254108  total: 1.57s    remaining: 827ms
655:    learn: 526.8785115  total: 1.57s    remaining: 824ms
656:    learn: 526.8031994  total: 1.57s    remaining: 821ms
657:    learn: 526.6321973  total: 1.57s    remaining: 819ms
658:    learn: 526.5532345  total: 1.58s    remaining: 816ms
659:    learn: 526.4351721  total: 1.58s    remaining: 814ms
660:    learn: 526.2213321  total: 1.58s    remaining: 811ms
661:    learn: 526.0697722  total: 1.58s    remaining: 809ms
662:    learn: 525.9501630  total: 1.59s    remaining: 806ms
663:    learn: 525.8608621  total: 1.59s    remaining: 804ms
664:    learn: 525.7994312  total: 1.59s    remaining: 801ms
665:    learn: 525.7088954  total: 1.59s    remaining: 799ms
666:    learn: 525.5457798  total: 1.59s    remaining: 796ms
667:    learn: 525.2763282  total: 1.6s remaining: 793ms
668:    learn: 525.1700617  total: 1.6s remaining: 791ms
669:    learn: 525.0788747  total: 1.6s remaining: 788ms
670:    learn: 524.9996921  total: 1.6s remaining: 786ms
671:    learn: 524.8365406  total: 1.6s remaining: 783ms
672:    learn: 524.6610043  total: 1.61s    remaining: 781ms
673:    learn: 524.5896222  total: 1.61s    remaining: 778ms
674:    learn: 524.4415991  total: 1.61s    remaining: 776ms
675:    learn: 524.2941224  total: 1.61s    remaining: 773ms
676:    learn: 524.1594212  total: 1.61s    remaining: 771ms
677:    learn: 523.9583002  total: 1.62s    remaining: 768ms
678:    learn: 523.8124411  total: 1.62s    remaining: 766ms
679:    learn: 523.6739125  total: 1.62s    remaining: 763ms
680:    learn: 523.5492431  total: 1.62s    remaining: 761ms
681:    learn: 523.4277567  total: 1.63s    remaining: 758ms
682:    learn: 523.2870650  total: 1.63s    remaining: 756ms
683:    learn: 523.1908801  total: 1.63s    remaining: 753ms
684:    learn: 523.0669271  total: 1.63s    remaining: 751ms
685:    learn: 522.9469754  total: 1.64s    remaining: 748ms
686:    learn: 522.8157924  total: 1.64s    remaining: 746ms
687:    learn: 522.6706685  total: 1.64s    remaining: 743ms
688:    learn: 522.5152316  total: 1.64s    remaining: 741ms
689:    learn: 522.4890117  total: 1.64s    remaining: 738ms
690:    learn: 522.3869837  total: 1.65s    remaining: 736ms
691:    learn: 522.3042520  total: 1.65s    remaining: 733ms
692:    learn: 522.1095536  total: 1.65s    remaining: 731ms
693:    learn: 522.0005065  total: 1.65s    remaining: 728ms
694:    learn: 521.8910600  total: 1.65s    remaining: 726ms
695:    learn: 521.7850845  total: 1.66s    remaining: 724ms
696:    learn: 521.6415118  total: 1.66s    remaining: 721ms
697:    learn: 521.5396683  total: 1.66s    remaining: 719ms
698:    learn: 521.3694467  total: 1.66s    remaining: 716ms
699:    learn: 521.2393582  total: 1.67s    remaining: 714ms
700:    learn: 521.1577259  total: 1.67s    remaining: 711ms
701:    learn: 520.9441070  total: 1.67s    remaining: 709ms
702:    learn: 520.8842175  total: 1.67s    remaining: 707ms
703:    learn: 520.7700178  total: 1.68s    remaining: 705ms
704:    learn: 520.6700518  total: 1.68s    remaining: 702ms
705:    learn: 520.6115305  total: 1.68s    remaining: 700ms
706:    learn: 520.3839362  total: 1.68s    remaining: 697ms
707:    learn: 520.2342766  total: 1.68s    remaining: 695ms
708:    learn: 519.9751869  total: 1.69s    remaining: 692ms
709:    learn: 519.7699733  total: 1.69s    remaining: 690ms
710:    learn: 519.6766105  total: 1.69s    remaining: 687ms
711:    learn: 519.5406351  total: 1.69s    remaining: 685ms
712:    learn: 519.4514031  total: 1.7s remaining: 682ms
713:    learn: 519.3757620  total: 1.7s remaining: 680ms
714:    learn: 519.2883764  total: 1.7s remaining: 677ms
715:    learn: 519.2049909  total: 1.7s remaining: 675ms
716:    learn: 519.1197801  total: 1.7s remaining: 672ms
717:    learn: 519.0411549  total: 1.71s    remaining: 670ms
718:    learn: 518.9136261  total: 1.71s    remaining: 667ms
719:    learn: 518.7677347  total: 1.71s    remaining: 665ms
720:    learn: 518.6025023  total: 1.71s    remaining: 663ms
721:    learn: 518.5534189  total: 1.71s    remaining: 660ms
722:    learn: 518.4337238  total: 1.72s    remaining: 658ms
723:    learn: 518.1916127  total: 1.72s    remaining: 655ms
724:    learn: 518.0265616  total: 1.72s    remaining: 653ms
725:    learn: 517.9182885  total: 1.72s    remaining: 650ms
726:    learn: 517.6485972  total: 1.73s    remaining: 648ms
727:    learn: 517.4276000  total: 1.73s    remaining: 645ms
728:    learn: 517.2711582  total: 1.73s    remaining: 643ms
729:    learn: 517.1383808  total: 1.73s    remaining: 641ms
730:    learn: 517.0456848  total: 1.73s    remaining: 638ms
731:    learn: 516.8117127  total: 1.74s    remaining: 636ms
732:    learn: 516.7650988  total: 1.74s    remaining: 633ms
733:    learn: 516.6285479  total: 1.74s    remaining: 631ms
734:    learn: 516.4851835  total: 1.74s    remaining: 628ms
735:    learn: 516.2895232  total: 1.74s    remaining: 626ms
736:    learn: 516.1772633  total: 1.75s    remaining: 623ms
737:    learn: 516.0814294  total: 1.75s    remaining: 621ms
738:    learn: 515.9479966  total: 1.75s    remaining: 619ms
739:    learn: 515.8488899  total: 1.75s    remaining: 616ms
740:    learn: 515.7051441  total: 1.76s    remaining: 614ms
741:    learn: 515.4773012  total: 1.76s    remaining: 612ms
742:    learn: 515.3254842  total: 1.76s    remaining: 609ms
743:    learn: 515.0704484  total: 1.76s    remaining: 607ms
744:    learn: 514.9635714  total: 1.76s    remaining: 604ms
745:    learn: 514.7446841  total: 1.77s    remaining: 602ms
746:    learn: 514.6484419  total: 1.77s    remaining: 599ms
747:    learn: 514.5352812  total: 1.77s    remaining: 597ms
748:    learn: 514.4321182  total: 1.77s    remaining: 594ms
749:    learn: 514.3365995  total: 1.78s    remaining: 592ms
750:    learn: 514.2025810  total: 1.78s    remaining: 590ms
751:    learn: 514.1409615  total: 1.78s    remaining: 587ms
752:    learn: 514.0385219  total: 1.78s    remaining: 585ms
753:    learn: 513.9101235  total: 1.78s    remaining: 582ms
754:    learn: 513.7520577  total: 1.79s    remaining: 580ms
755:    learn: 513.6038786  total: 1.79s    remaining: 577ms
756:    learn: 513.4347320  total: 1.79s    remaining: 575ms
757:    learn: 513.3290570  total: 1.79s    remaining: 573ms
758:    learn: 513.2514825  total: 1.79s    remaining: 570ms
759:    learn: 513.1110577  total: 1.8s remaining: 568ms
760:    learn: 512.9855976  total: 1.8s remaining: 565ms
761:    learn: 512.8674225  total: 1.8s remaining: 563ms
762:    learn: 512.7558335  total: 1.8s remaining: 560ms
763:    learn: 512.5684583  total: 1.8s remaining: 558ms
764:    learn: 512.5023233  total: 1.81s    remaining: 555ms
765:    learn: 512.4242141  total: 1.81s    remaining: 553ms
766:    learn: 512.2330277  total: 1.81s    remaining: 550ms
767:    learn: 512.0909299  total: 1.81s    remaining: 548ms
768:    learn: 511.9783229  total: 1.82s    remaining: 546ms
769:    learn: 511.8962510  total: 1.82s    remaining: 543ms
770:    learn: 511.7875427  total: 1.82s    remaining: 541ms
771:    learn: 511.5603337  total: 1.82s    remaining: 538ms
772:    learn: 511.4530450  total: 1.82s    remaining: 536ms
773:    learn: 511.3632334  total: 1.83s    remaining: 533ms
774:    learn: 511.3316336  total: 1.83s    remaining: 531ms
775:    learn: 511.2742318  total: 1.83s    remaining: 528ms
776:    learn: 511.1311269  total: 1.83s    remaining: 526ms
777:    learn: 511.0497168  total: 1.83s    remaining: 524ms
778:    learn: 510.9112398  total: 1.84s    remaining: 521ms
779:    learn: 510.7187820  total: 1.84s    remaining: 519ms
780:    learn: 510.6510580  total: 1.84s    remaining: 516ms
781:    learn: 510.5108226  total: 1.84s    remaining: 514ms
782:    learn: 510.3621348  total: 1.84s    remaining: 512ms
783:    learn: 510.2561143  total: 1.85s    remaining: 509ms
784:    learn: 510.1320993  total: 1.85s    remaining: 507ms
785:    learn: 509.9399881  total: 1.85s    remaining: 504ms
786:    learn: 509.9144341  total: 1.85s    remaining: 502ms
787:    learn: 509.8342705  total: 1.86s    remaining: 499ms
788:    learn: 509.6523125  total: 1.86s    remaining: 497ms
789:    learn: 509.5562097  total: 1.86s    remaining: 495ms
790:    learn: 509.5005207  total: 1.86s    remaining: 492ms
791:    learn: 509.4249281  total: 1.86s    remaining: 490ms
792:    learn: 509.2553087  total: 1.87s    remaining: 487ms
793:    learn: 509.1093322  total: 1.87s    remaining: 485ms
794:    learn: 509.0545543  total: 1.87s    remaining: 483ms
795:    learn: 508.9321118  total: 1.87s    remaining: 480ms
796:    learn: 508.7836108  total: 1.88s    remaining: 478ms
797:    learn: 508.6878202  total: 1.88s    remaining: 476ms
798:    learn: 508.5319959  total: 1.88s    remaining: 473ms
799:    learn: 508.4053670  total: 1.88s    remaining: 471ms
800:    learn: 508.3103136  total: 1.89s    remaining: 468ms
801:    learn: 508.2001758  total: 1.89s    remaining: 466ms
802:    learn: 508.0682288  total: 1.89s    remaining: 464ms
803:    learn: 507.9373060  total: 1.89s    remaining: 461ms
804:    learn: 507.7959306  total: 1.89s    remaining: 459ms
805:    learn: 507.7081465  total: 1.9s remaining: 456ms
806:    learn: 507.6602424  total: 1.9s remaining: 454ms
807:    learn: 507.5452401  total: 1.9s remaining: 452ms
808:    learn: 507.4049697  total: 1.9s remaining: 449ms
809:    learn: 507.2816934  total: 1.9s remaining: 447ms
810:    learn: 507.0849742  total: 1.91s    remaining: 444ms
811:    learn: 506.9487878  total: 1.91s    remaining: 442ms
812:    learn: 506.8849078  total: 1.91s    remaining: 440ms
813:    learn: 506.7943990  total: 1.91s    remaining: 437ms
814:    learn: 506.6159120  total: 1.92s    remaining: 435ms
815:    learn: 506.6134951  total: 1.92s    remaining: 432ms
816:    learn: 506.3329607  total: 1.92s    remaining: 430ms
817:    learn: 506.2802629  total: 1.92s    remaining: 428ms
818:    learn: 506.0523114  total: 1.92s    remaining: 425ms
819:    learn: 505.8164035  total: 1.93s    remaining: 423ms
820:    learn: 505.7502739  total: 1.93s    remaining: 421ms
821:    learn: 505.6978183  total: 1.93s    remaining: 418ms
822:    learn: 505.6145216  total: 1.93s    remaining: 416ms
823:    learn: 505.5423505  total: 1.94s    remaining: 413ms
824:    learn: 505.5400994  total: 1.94s    remaining: 411ms
825:    learn: 505.3650239  total: 1.94s    remaining: 408ms
826:    learn: 505.2550546  total: 1.94s    remaining: 406ms
827:    learn: 505.1865735  total: 1.94s    remaining: 404ms
828:    learn: 504.9980850  total: 1.95s    remaining: 401ms
829:    learn: 504.8848006  total: 1.95s    remaining: 399ms
830:    learn: 504.8124410  total: 1.95s    remaining: 397ms
831:    learn: 504.6986167  total: 1.95s    remaining: 394ms
832:    learn: 504.6412136  total: 1.95s    remaining: 392ms
833:    learn: 504.5521240  total: 1.96s    remaining: 389ms
834:    learn: 504.4894507  total: 1.96s    remaining: 387ms
835:    learn: 504.3442401  total: 1.96s    remaining: 385ms
836:    learn: 504.3422772  total: 1.96s    remaining: 382ms
837:    learn: 504.2885371  total: 1.96s    remaining: 380ms
838:    learn: 504.2177810  total: 1.97s    remaining: 377ms
839:    learn: 504.1468503  total: 1.97s    remaining: 375ms
840:    learn: 504.0240131  total: 1.97s    remaining: 373ms
841:    learn: 503.8664046  total: 1.97s    remaining: 370ms
842:    learn: 503.7794625  total: 1.98s    remaining: 368ms
843:    learn: 503.7041739  total: 1.98s    remaining: 366ms
844:    learn: 503.5907588  total: 1.98s    remaining: 363ms
845:    learn: 503.5011592  total: 1.98s    remaining: 361ms
846:    learn: 503.3192184  total: 1.98s    remaining: 358ms
847:    learn: 503.1753922  total: 1.99s    remaining: 356ms
848:    learn: 503.0742324  total: 1.99s    remaining: 354ms
849:    learn: 502.9666828  total: 1.99s    remaining: 351ms
850:    learn: 502.8585069  total: 1.99s    remaining: 349ms
851:    learn: 502.7273855  total: 2s   remaining: 347ms
852:    learn: 502.4738048  total: 2s   remaining: 344ms
853:    learn: 502.3680369  total: 2s   remaining: 342ms
854:    learn: 502.2494684  total: 2s   remaining: 339ms
855:    learn: 502.1347191  total: 2s   remaining: 337ms
856:    learn: 501.9727226  total: 2s   remaining: 335ms
857:    learn: 501.8530779  total: 2.01s    remaining: 332ms
858:    learn: 501.7794885  total: 2.01s    remaining: 330ms
859:    learn: 501.6964351  total: 2.01s    remaining: 327ms
860:    learn: 501.5349599  total: 2.01s    remaining: 325ms
861:    learn: 501.4129758  total: 2.02s    remaining: 323ms
862:    learn: 501.1428815  total: 2.02s    remaining: 320ms
863:    learn: 501.0896396  total: 2.02s    remaining: 318ms
864:    learn: 500.9920366  total: 2.02s    remaining: 316ms
865:    learn: 500.9085099  total: 2.02s    remaining: 313ms
866:    learn: 500.6490380  total: 2.03s    remaining: 311ms
867:    learn: 500.5352246  total: 2.03s    remaining: 309ms
868:    learn: 500.3830536  total: 2.03s    remaining: 306ms
869:    learn: 500.2216151  total: 2.03s    remaining: 304ms
870:    learn: 500.1481111  total: 2.04s    remaining: 302ms
871:    learn: 500.0355530  total: 2.04s    remaining: 299ms
872:    learn: 499.9161132  total: 2.04s    remaining: 297ms
873:    learn: 499.8657985  total: 2.04s    remaining: 295ms
874:    learn: 499.7751729  total: 2.04s    remaining: 292ms
875:    learn: 499.6064252  total: 2.05s    remaining: 290ms
876:    learn: 499.4991910  total: 2.05s    remaining: 287ms
877:    learn: 499.4484886  total: 2.05s    remaining: 285ms
878:    learn: 499.3559012  total: 2.05s    remaining: 283ms
879:    learn: 499.2282418  total: 2.06s    remaining: 280ms
880:    learn: 499.1489176  total: 2.06s    remaining: 278ms
881:    learn: 499.0439877  total: 2.06s    remaining: 276ms
882:    learn: 498.9594406  total: 2.06s    remaining: 273ms
883:    learn: 498.8645477  total: 2.06s    remaining: 271ms
884:    learn: 498.6144750  total: 2.07s    remaining: 269ms
885:    learn: 498.5085597  total: 2.07s    remaining: 266ms
886:    learn: 498.4206897  total: 2.07s    remaining: 264ms
887:    learn: 498.3426337  total: 2.08s    remaining: 262ms
888:    learn: 498.2729182  total: 2.08s    remaining: 259ms
889:    learn: 498.2065214  total: 2.08s    remaining: 257ms
890:    learn: 498.2019997  total: 2.08s    remaining: 255ms
891:    learn: 498.1634012  total: 2.08s    remaining: 252ms
892:    learn: 498.0654167  total: 2.09s    remaining: 250ms
893:    learn: 497.9034720  total: 2.09s    remaining: 248ms
894:    learn: 497.7936668  total: 2.09s    remaining: 245ms
895:    learn: 497.7057435  total: 2.09s    remaining: 243ms
896:    learn: 497.5943953  total: 2.09s    remaining: 241ms
897:    learn: 497.4206283  total: 2.1s remaining: 238ms
898:    learn: 497.3392990  total: 2.1s remaining: 236ms
899:    learn: 497.2882259  total: 2.1s remaining: 233ms
900:    learn: 497.2143931  total: 2.1s remaining: 231ms
901:    learn: 497.1244577  total: 2.1s remaining: 229ms
902:    learn: 497.0071904  total: 2.11s    remaining: 226ms
903:    learn: 496.8358332  total: 2.11s    remaining: 224ms
904:    learn: 496.6116264  total: 2.11s    remaining: 222ms
905:    learn: 496.5261307  total: 2.11s    remaining: 219ms
906:    learn: 496.4404981  total: 2.12s    remaining: 217ms
907:    learn: 496.3700924  total: 2.12s    remaining: 215ms
908:    learn: 496.3103320  total: 2.12s    remaining: 212ms
909:    learn: 496.2021257  total: 2.12s    remaining: 210ms
910:    learn: 496.0336032  total: 2.13s    remaining: 208ms
911:    learn: 495.9585698  total: 2.13s    remaining: 205ms
912:    learn: 495.8675856  total: 2.13s    remaining: 203ms
913:    learn: 495.7963611  total: 2.13s    remaining: 201ms
914:    learn: 495.6790907  total: 2.13s    remaining: 198ms
915:    learn: 495.5645964  total: 2.14s    remaining: 196ms
916:    learn: 495.5249118  total: 2.14s    remaining: 194ms
917:    learn: 495.3524990  total: 2.14s    remaining: 191ms
918:    learn: 495.3095751  total: 2.14s    remaining: 189ms
919:    learn: 495.1298763  total: 2.15s    remaining: 187ms
920:    learn: 495.0364207  total: 2.15s    remaining: 184ms
921:    learn: 495.0182049  total: 2.15s    remaining: 182ms
922:    learn: 494.9428983  total: 2.15s    remaining: 179ms
923:    learn: 494.8171806  total: 2.15s    remaining: 177ms
924:    learn: 494.7513666  total: 2.15s    remaining: 175ms
925:    learn: 494.6220012  total: 2.16s    remaining: 172ms
926:    learn: 494.5683026  total: 2.16s    remaining: 170ms
927:    learn: 494.5101978  total: 2.16s    remaining: 168ms
928:    learn: 494.4270436  total: 2.16s    remaining: 165ms
929:    learn: 494.3151983  total: 2.17s    remaining: 163ms
930:    learn: 494.2463475  total: 2.17s    remaining: 161ms
931:    learn: 494.0234830  total: 2.17s    remaining: 158ms
932:    learn: 493.8442750  total: 2.17s    remaining: 156ms
933:    learn: 493.7922745  total: 2.18s    remaining: 154ms
934:    learn: 493.7910478  total: 2.18s    remaining: 151ms
935:    learn: 493.6564822  total: 2.18s    remaining: 149ms
936:    learn: 493.5665440  total: 2.18s    remaining: 147ms
937:    learn: 493.3844649  total: 2.18s    remaining: 144ms
938:    learn: 493.2560045  total: 2.19s    remaining: 142ms
939:    learn: 493.1921490  total: 2.19s    remaining: 140ms
940:    learn: 493.1538235  total: 2.19s    remaining: 137ms
941:    learn: 493.0353804  total: 2.19s    remaining: 135ms
942:    learn: 492.9518626  total: 2.19s    remaining: 133ms
943:    learn: 492.8604120  total: 2.2s remaining: 130ms
944:    learn: 492.7092861  total: 2.2s remaining: 128ms
945:    learn: 492.6428526  total: 2.2s remaining: 126ms
946:    learn: 492.4626642  total: 2.2s remaining: 123ms
947:    learn: 492.3318744  total: 2.21s    remaining: 121ms
948:    learn: 492.2354908  total: 2.21s    remaining: 119ms
949:    learn: 492.1235840  total: 2.21s    remaining: 116ms
950:    learn: 492.0227615  total: 2.21s    remaining: 114ms
951:    learn: 491.9216161  total: 2.22s    remaining: 112ms
952:    learn: 491.8903720  total: 2.22s    remaining: 109ms
953:    learn: 491.7262974  total: 2.22s    remaining: 107ms
954:    learn: 491.5683484  total: 2.22s    remaining: 105ms
955:    learn: 491.4867563  total: 2.22s    remaining: 102ms
956:    learn: 491.4025285  total: 2.23s    remaining: 100ms
957:    learn: 491.3178738  total: 2.23s    remaining: 97.7ms
958:    learn: 491.1489234  total: 2.23s    remaining: 95.4ms
959:    learn: 491.0374658  total: 2.23s    remaining: 93.1ms
960:    learn: 490.9661428  total: 2.23s    remaining: 90.7ms
961:    learn: 490.8339451  total: 2.24s    remaining: 88.4ms
962:    learn: 490.6714575  total: 2.24s    remaining: 86.1ms
963:    learn: 490.5574924  total: 2.24s    remaining: 83.7ms
964:    learn: 490.4481202  total: 2.24s    remaining: 81.4ms
965:    learn: 490.4298569  total: 2.25s    remaining: 79.1ms
966:    learn: 490.3506635  total: 2.25s    remaining: 76.8ms
967:    learn: 490.3062266  total: 2.25s    remaining: 74.4ms
968:    learn: 490.3046101  total: 2.25s    remaining: 72.1ms
969:    learn: 490.1956861  total: 2.25s    remaining: 69.8ms
970:    learn: 490.1172947  total: 2.26s    remaining: 67.4ms
971:    learn: 490.0298815  total: 2.26s    remaining: 65.1ms
972:    learn: 489.9001194  total: 2.26s    remaining: 62.8ms
973:    learn: 489.7972213  total: 2.26s    remaining: 60.5ms
974:    learn: 489.5993117  total: 2.27s    remaining: 58.1ms
975:    learn: 489.5186491  total: 2.27s    remaining: 55.8ms
976:    learn: 489.3226170  total: 2.27s    remaining: 53.5ms
977:    learn: 489.2613789  total: 2.27s    remaining: 51.1ms
978:    learn: 489.2112069  total: 2.28s    remaining: 48.8ms
979:    learn: 489.1146417  total: 2.28s    remaining: 46.5ms
980:    learn: 489.0189508  total: 2.28s    remaining: 44.2ms
981:    learn: 488.9725587  total: 2.28s    remaining: 41.8ms
982:    learn: 488.8969277  total: 2.29s    remaining: 39.5ms
983:    learn: 488.7294821  total: 2.29s    remaining: 37.2ms
984:    learn: 488.5812483  total: 2.29s    remaining: 34.9ms
985:    learn: 488.4636470  total: 2.29s    remaining: 32.5ms
986:    learn: 488.3010768  total: 2.29s    remaining: 30.2ms
987:    learn: 488.2156558  total: 2.3s remaining: 27.9ms
988:    learn: 488.1398226  total: 2.3s remaining: 25.6ms
989:    learn: 488.0962481  total: 2.3s remaining: 23.2ms
990:    learn: 487.9375249  total: 2.3s remaining: 20.9ms
991:    learn: 487.8585027  total: 2.31s    remaining: 18.6ms
992:    learn: 487.7102474  total: 2.31s    remaining: 16.3ms
993:    learn: 487.6072158  total: 2.31s    remaining: 13.9ms
994:    learn: 487.5273675  total: 2.31s    remaining: 11.6ms
995:    learn: 487.4724819  total: 2.31s    remaining: 9.29ms
996:    learn: 487.4106652  total: 2.32s    remaining: 6.97ms
997:    learn: 487.2940494  total: 2.32s    remaining: 4.65ms
998:    learn: 487.0983350  total: 2.32s    remaining: 2.32ms
999:    learn: 486.9631666  total: 2.32s    remaining: 0us
0.8082862256837121</code></pre>
</div>
</div>
<div class="cell" data-execution_count="155">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val)</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> y_pred.astype(<span class="bu">int</span>)</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.score(X_val, y_val)), <span class="bu">print</span>(r2_score(y_pred, model.predict(X_val)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.6951043846410805
0.9999995968937097</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="155">
<pre><code>(None, None)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="156">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'Actual'</span>: y_val, <span class="st">'Predicted'</span>:y_pred})</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="156">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Actual</th>
<th data-quarto-table-cell-role="th">Predicted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">52462</td>
<td>5144.927536</td>
<td>4239</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21852</td>
<td>3500.000000</td>
<td>3091</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">58450</td>
<td>3181.818182</td>
<td>3276</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7890</td>
<td>1895.348837</td>
<td>2294</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46464</td>
<td>2095.238095</td>
<td>2012</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6733</td>
<td>5021.739130</td>
<td>4620</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31658</td>
<td>3103.703704</td>
<td>3869</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5513</td>
<td>2480.769231</td>
<td>2426</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27117</td>
<td>2333.333333</td>
<td>2201</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28832</td>
<td>2476.635514</td>
<td>2784</td>
</tr>
</tbody>
</table>

<p>5615 rows × 2 columns</p>
</div>
</div>
</div>
<p>Predict on test set</p>
<div class="cell" data-execution_count="157">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>y_final <span class="op">=</span> model.predict(X_test)</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>y_final <span class="op">=</span> y_final.astype(<span class="bu">int</span>)</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.score(X_test, y_test)), <span class="bu">print</span>(r2_score(y_test, model.predict(X_test)))</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.6663419021126527
0.6663419021126527</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="157">
<pre><code>(None, None)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="158">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'Actual'</span>: y_test, <span class="st">'Predicted'</span>:y_final})</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="158">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Actual</th>
<th data-quarto-table-cell-role="th">Predicted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>3833.333333</td>
<td>3906</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">105</td>
<td>3545.454545</td>
<td>2846</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">128</td>
<td>2622.377622</td>
<td>2716</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">132</td>
<td>4444.444444</td>
<td>3492</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">136</td>
<td>2857.142857</td>
<td>2398</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">60836</td>
<td>3266.666667</td>
<td>2658</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">60838</td>
<td>5000.000000</td>
<td>3860</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">60840</td>
<td>4618.750000</td>
<td>4024</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">60879</td>
<td>3260.869565</td>
<td>3225</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">60927</td>
<td>5285.714286</td>
<td>2678</td>
</tr>
</tbody>
</table>

<p>4788 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="159">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_selector</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="160">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> HistGradientBoostingRegressor</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>one_hot_encoder <span class="op">=</span> make_column_transformer(</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>        OneHotEncoder(sparse<span class="op">=</span><span class="va">False</span>, handle_unknown<span class="op">=</span><span class="st">"ignore"</span>),</span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>        make_column_selector(dtype_include<span class="op">=</span><span class="st">"category"</span>),</span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"passthrough"</span>,</span>
<span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-12"><a href="#cb220-12" aria-hidden="true" tabindex="-1"></a>hist_one_hot <span class="op">=</span> make_pipeline(</span>
<span id="cb220-13"><a href="#cb220-13" aria-hidden="true" tabindex="-1"></a>    one_hot_encoder, HistGradientBoostingRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb220-14"><a href="#cb220-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb220-15"><a href="#cb220-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-16"><a href="#cb220-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train.shape)</span>
<span id="cb220-17"><a href="#cb220-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train.shape)</span>
<span id="cb220-18"><a href="#cb220-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-19"><a href="#cb220-19" aria-hidden="true" tabindex="-1"></a>X_trainbis <span class="op">=</span> X_train[categorical_features<span class="op">+</span>numerical_features]</span>
<span id="cb220-20"><a href="#cb220-20" aria-hidden="true" tabindex="-1"></a>X_trainbis[categorical_features] <span class="op">=</span> X_trainbis[categorical_features].astype(<span class="st">"category"</span>)</span>
<span id="cb220-21"><a href="#cb220-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-22"><a href="#cb220-22" aria-hidden="true" tabindex="-1"></a>n_categorical_features <span class="op">=</span> X_trainbis.select_dtypes(include<span class="op">=</span><span class="st">"category"</span>).shape[<span class="dv">1</span>]</span>
<span id="cb220-23"><a href="#cb220-23" aria-hidden="true" tabindex="-1"></a>n_numerical_features <span class="op">=</span> X_trainbis.select_dtypes(include<span class="op">=</span><span class="st">"number"</span>).shape[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(50526, 31)
(50526,)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/qb/99v_gzds7j7725jspcz_ch9w0000gn/T/ipykernel_18736/2514078607.py:20: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="161">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBRegressor</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>hist_one_hot_xgb <span class="op">=</span> make_pipeline(</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>    one_hot_encoder, XGBRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>xgb <span class="op">=</span> hist_one_hot_xgb.fit(X_trainbis, y_train)</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Scikit pipeline way, difficult to exctract features</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/sklearn/preprocessing/_encoders.py:975: FutureWarning:

`sparse` was renamed to `sparse_output` in version 1.2 and will be removed in 1.4. `sparse_output` is ignored unless you leave `sparse` to its default value.

/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/xgboost/data.py:440: FutureWarning:

is_sparse is deprecated and will be removed in a future version. Check `isinstance(dtype, pd.SparseDtype)` instead.
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="162">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>xgb <span class="op">=</span> XGBRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>X_trainbis_transform <span class="op">=</span> one_hot_encoder.fit_transform(X_trainbis)</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>xgb.fit(X_trainbis_transform, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/sklearn/preprocessing/_encoders.py:975: FutureWarning:

`sparse` was renamed to `sparse_output` in version 1.2 and will be removed in 1.4. `sparse_output` is ignored unless you leave `sparse` to its default value.

/Users/louisolive/miniconda3/envs/teaching-python/lib/python3.10/site-packages/xgboost/data.py:440: FutureWarning:

is_sparse is deprecated and will be removed in a future version. Check `isinstance(dtype, pd.SparseDtype)` instead.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="162">
<style>#sk-container-id-2 {color: black;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBRegressor(base_score=None, booster=None, callbacks=None,
             colsample_bylevel=None, colsample_bynode=None,
             colsample_bytree=None, early_stopping_rounds=None,
             enable_categorical=False, eval_metric=None, feature_types=None,
             gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
             interaction_constraints=None, learning_rate=None, max_bin=None,
             max_cat_threshold=None, max_cat_to_onehot=None,
             max_delta_step=None, max_depth=None, max_leaves=None,
             min_child_weight=None, missing=nan, monotone_constraints=None,
             n_estimators=100, n_jobs=None, num_parallel_tree=None,
             predictor=None, random_state=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" checked=""><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">XGBRegressor</label><div class="sk-toggleable__content"><pre>XGBRegressor(base_score=None, booster=None, callbacks=None,
             colsample_bylevel=None, colsample_bynode=None,
             colsample_bytree=None, early_stopping_rounds=None,
             enable_categorical=False, eval_metric=None, feature_types=None,
             gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
             interaction_constraints=None, learning_rate=None, max_bin=None,
             max_cat_threshold=None, max_cat_to_onehot=None,
             max_delta_step=None, max_depth=None, max_leaves=None,
             min_child_weight=None, missing=nan, monotone_constraints=None,
             n_estimators=100, n_jobs=None, num_parallel_tree=None,
             predictor=None, random_state=None, ...)</pre></div></div></div></div></div>
</div>
</div>
<div class="cell" data-execution_count="163">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>X_trainbis_transform</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> one_hot_encoder.get_feature_names_out(X_trainbis.columns)</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>features_clean <span class="op">=</span> [s.replace(<span class="st">'onehotencoder__'</span> , <span class="st">''</span>) <span class="cf">for</span> s <span class="kw">in</span> features]</span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>features_clean <span class="op">=</span> np.array([s.replace(<span class="st">'remainder__'</span> , <span class="st">''</span>) <span class="cf">for</span> s <span class="kw">in</span> features_clean])</span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>sorted_idx <span class="op">=</span> xgb.feature_importances_.argsort()</span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>sorted_30 <span class="op">=</span> sorted_idx[<span class="dv">0</span>:<span class="dv">30</span>]</span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a>plt.barh(features_clean[sorted_30 ], xgb.feature_importances_[sorted_30 ])</span>
<span id="cb227-10"><a href="#cb227-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Xgboost Feature Importance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="163">
<pre><code>Text(0.5, 0, 'Xgboost Feature Importance')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="03_real_estate_eda_files/figure-html/cell-154-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="164">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>xgb.feature_names <span class="op">=</span> features_clean.tolist()</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>xgboost.plot_importance(xgb, max_num_features <span class="op">=</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="164">
<pre><code>&lt;Axes: title={'center': 'Feature importance'}, xlabel='F score', ylabel='Features'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="03_real_estate_eda_files/figure-html/cell-155-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="165">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shap</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(xgb)</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>shap_values <span class="op">=</span> explainer.shap_values(X_trainbis_transform)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="166">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values, X_trainbis_transform, feature_names<span class="op">=</span>features_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03_real_estate_eda_files/figure-html/cell-157-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="167">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt </span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate shap_values</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values, X_trainbis_transform, feature_names<span class="op">=</span>features_clean, show<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.gca()</span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a><span class="co"># You can change the min and max value of xaxis by changing the arguments of:</span></span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="op">-</span><span class="dv">2500</span>, <span class="dv">2500</span>) </span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03_real_estate_eda_files/figure-html/cell-158-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Variable importance analysis https://shap.readthedocs.io/en/latest/example_notebooks/tabular_examples/tree_based_models/Catboost%20tutorial.html</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>